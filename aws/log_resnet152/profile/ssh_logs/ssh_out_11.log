Parent process ID: 7022 node: 172.31.19.171
16 per stage
32 servers!
Config:
ranks: range(11, 12)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=11 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 11
USED MODULES
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
11 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 2.0
1 6592.767953872681 7495.296001434326 259.99999791383743 37398118.4 401408
2 6290.431976318359 4156.010786692302 297.3119974136352 47782707.2 802816
3 4438.271999359131 10035.007953643797 498.25279712677 56677683.2 1204224
4 4249.087929725647 6193.26388835907 587.6639783382416 67442790.4 1605632
5 4550.656000773111 7112.885475158692 567.4986640612285 76738662.4 2007040
6 4203.519980112712 6472.320079803466 639.955198764801 86032896.0 2408448
7 10340.863704681395 6253.119945526124 662.9439989725748 97798144.0 2809856
8 4410.880088806152 9797.845204671225 702.3119926452637 106793881.6 3211264
9 22566.400527954105 10266.096115112305 835.5280160903931 116165120.0 3612672
10 4251.647949218749 7350.0800132751465 797.8159934282303 130193203.2 4014080
11 4227.584004402161 6445.9041357040405 1059.7440004348755 139763916.8 4415488
12 13103.10411453247 6330.549240112306 873.4506766001383 150927974.4 4816896
13 4154.111981391908 9008.17584991455 918.1568026542664 158203187.2 5218304
14 9416.704177856445 8879.31203842163 1011.6672039031984 168058572.8 5619712
15 4378.623962402344 7836.938858032227 1058.1546624501548 180004659.2 6021120
16 13093.888282775879 9740.720272064209 1148.112028837204 190125670.4 6422528
17 15507.455825805664 8521.29602432251 1424.6613184611 201883033.6 6823936
18 4238.677342732747 6962.904095649719 1426.4959891637168 210435276.8 7225344
19 11427.840232849121 6467.520078023275 1274.7359871864319 218795417.6 7626752
20 9207.807540893555 8645.15209197998 1883.4240436553955 231208550.4 8028160
21 15878.14426422119 9963.423728942871 1333.9520295461018 240045260.8 8429568
22 4205.909252166747 6984.080076217651 1361.7119789123535 249377792.0 8830976
23 19353.08837890625 6545.077164967855 1550.5920052528381 260898406.4 9232384
24 4363.263924916586 9094.97594833374 1595.5199956893916 267845324.8 9633792
25 18430.719852447506 7041.194597880046 1621.610641479492 280525209.6 10035200
26 16819.20051574707 6111.669381459554 1930.239975452423 287131750.4 10436608
27 12962.815761566162 10877.087593078613 1635.6053352355957 297940684.8 10838016
28 4570.794582366943 8224.448204040527 2415.5840078989663 310025420.8 11239424
29 14366.378784179688 6641.215920448303 1714.1120036443074 318723788.8 11640832
30 9431.039810180664 7818.336009979249 1759.6799929936726 329824665.6 12042240
31 9473.024368286133 5836.234728495279 1842.6800072193146 338633216.0 12443648
32 5636.096000671387 8493.663787841797 2176.1599779129024 348650700.8 12845056
33 11611.647605895996 6430.512070655823 1939.7760033607483 358807244.8 13246464
34 16038.400173187258 10971.183776855467 2745.9359169006348 370409984.0 13647872
35 24937.47138977051 13166.8643951416 2135.3493531545005 379236352.0 14049280
36 16001.02424621582 6821.888128916424 2343.176007270813 388710092.8 14450688
37 14453.07731628418 6653.815984725952 2137.6559734344482 398761164.8 14852096
38 26144.767761230465 7398.048162460327 2435.1893266042075 418651852.8 15253504
39 15493.632316589355 6295.541286468506 3672.880053520203 428512870.4 15654912
40 13555.20009994507 7413.327932357788 2318.4213638305664 439169536.0 16056320
41 14931.626637776691 6779.957294464111 2264.4479870796204 450014924.8 16457728
42 4631.551901499431 9152.607917785645 6911.263942718506 458456268.8 16859136
43 10158.080101013184 6261.264085769653 24983.840942382812 468376064.0 17260544
44 13064.191818237305 9098.911762237549 2586.303949356079 479334400.0 17661952
45 11202.560424804688 6770.951986312865 22249.311447143555 488738508.8 18063360
46 9352.191925048828 7458.096027374268 43088.06228637695 499518668.8 18464768
47 25797.120094299316 6892.511844635009 2580.5919766426086 507847987.2 18866176
pre-alr mem 11691008
All reduce times
32 [0.0, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
