Parent process ID: 7375 node: 172.31.30.133
16 per stage
32 servers!
Config:
ranks: range(19, 20)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=19 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 19
USED MODULES
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
19 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 16.0
1 4054.0161132812505 5580.496072769165 225.7813364267349 44759347.2 401408
2 3115.349372227987 5825.088024139405 329.8560008406639 51751219.2 802816
3 4083.7119817733765 10770.655632019043 373.9920035004616 53404364.8 1204224
4 4087.807973225912 5800.234635670979 467.8400009870529 57765785.6 1605632
5 4140.031973520915 6216.74664815267 524.3200063705444 62352076.8 2007040
6 10291.199684143066 6432.927846908569 639.1360014677049 66519756.8 2408448
7 6844.41614151001 19091.343879699707 650.7679969072342 72710860.8 2809856
8 11892.735958099365 7315.47737121582 680.345606803894 78763520.0 3211264
9 3893.930753072103 8563.807964324951 899.5680063962936 84720742.4 3612672
10 7539.711952209473 10226.207733154297 749.6479898691177 91426713.6 4014080
11 4049.2374102274575 11934.06899770101 827.5199979543685 97633792.0 4415488
12 9151.487827301025 5899.413426717123 1071.9786882400513 104219340.8 4816896
13 4176.213264465332 6742.303967475891 5927.072048187257 110985113.6 5218304
14 4106.240113576254 6031.592011451721 1218.7200387318928 115547238.4 5619712
15 3969.5360660552974 5818.858623504638 1558.847963809967 122689843.2 6021120
16 3546.624004840851 5858.487963676452 1070.967972278595 130007654.4 6422528
17 6459.392070770264 6511.1119747161865 1077.3839950561523 136365772.8 6823936
18 11125.760078430176 8999.711990356445 1125.8000135421753 140988313.6 7225344
19 18814.97573852539 5883.271932601929 1226.9013325373332 147965440.0 7626752
20 9092.096328735352 6210.73591709137 1498.6799955368042 155809280.0 8028160
21 3617.7919705708823 6107.242584228516 1259.5946788787842 158878003.2 8429568
22 8399.871826171875 5835.701306660971 1325.432002544403 165547929.6 8830976
23 3936.5973472595215 5902.047952016194 1825.9199857711792 173900492.8 9232384
24 4113.152086734772 6086.922645568848 1541.2240326404572 179249868.8 9633792
25 11192.319869995117 6232.311964035034 1678.9440512657163 188873216.0 10035200
26 3997.440040111542 6171.823978424072 6772.672176361084 191194009.6 10436608
27 4027.733405431112 6304.784059524536 1809.4319999217987 197736755.2 10838016
28 4735.658486684163 6543.13600063324 2022.1973260243735 205501952.0 11239424
29 17665.535926818848 5976.04258855184 1757.8800022602081 210357350.4 11640832
30 3734.1866493225093 14723.551750183105 1744.0479993820188 215479808.0 12042240
31 6589.439868927002 6394.368052482604 1775.6400108337402 222055526.4 12443648
32 7311.359882354736 9058.943748474121 1800.583988428116 229529088.0 12845056
33 11198.464393615723 6098.2959270477295 1936.1279904842377 236736409.6 13246464
34 3472.0427195231114 6148.535966873168 1892.298698425293 242452787.2 13647872
35 12239.359855651855 6630.037307739259 2560.8320236206055 247175475.2 14049280
36 3972.778638203938 5927.6479085286455 2130.1279664039616 253970739.2 14450688
37 3915.0933424631758 8537.407875061035 3737.663984298706 259148083.2 14852096
38 16879.616737365723 7464.000225067139 2257.9280138015747 267618611.2 15253504
39 8708.09555053711 7689.760208129883 2621.056032180786 272067276.8 15654912
40 5721.08793258667 6336.744070053101 2472.7599620819087 280221184.0 16056320
41 15670.271873474123 6126.768112182617 2541.1680340766907 287072972.8 16457728
42 16113.664627075193 6042.03200340271 2450.943946838379 289466675.2 16859136
43 4189.525286356608 6526.592016220093 2822.4128246307373 295688499.2 17260544
44 15292.415618896484 6355.8400472005205 2924.8321056365967 304292556.8 17661952
45 9884.672164916992 5911.946614583333 2840.4416084289546 308300083.2 18063360
46 4262.912034988403 5866.30392074585 3694.07993555069 317643059.2 18464768
47 4811.776161193848 6890.890757242839 3149.568021297455 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
