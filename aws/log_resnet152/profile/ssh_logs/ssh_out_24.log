Parent process ID: 6574 node: 172.31.28.16
16 per stage
32 servers!
Config:
ranks: range(24, 25)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=24 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 24
USED MODULES
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
24 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3190.783977508545 3867.7654266357413 243.9839988946915 44759347.2 401408
2 2816.341320673625 4187.9119873046875 316.9040083885193 51751219.2 802816
3 4846.0798263549805 6707.263946533203 423.5279932618141 53404364.8 1204224
4 5511.168003082275 6297.290643056233 629.2320191860199 57765785.6 1605632
5 4487.1679941813145 6028.010686238607 619.0293232599893 62352076.8 2007040
6 9284.607887268066 6592.9813385009775 767.9199874401093 66519756.8 2408448
7 4009.984095891317 6893.296003341674 761.343995730082 72710860.8 2809856
8 11348.992347717283 5919.562498728435 964.391991496086 78763520.0 3211264
9 4323.327859242757 9670.432090759277 966.8416023254393 84720742.4 3612672
10 4010.4960799217224 6043.008009592693 954.120010137558 91426713.6 4014080
11 11165.696144104004 7649.9199867248535 1212.1173143386839 97633792.0 4415488
12 4509.013334910074 6743.274847666423 1216.202656428019 104219340.8 4816896
13 14088.191986083984 10110.832214355467 1348.1706778208415 110985113.6 5218304
14 4382.037480672201 9296.95987701416 1220.271974802017 115547238.4 5619712
15 4385.791937510173 7861.663818359375 1328.1520009040833 122689843.2 6021120
16 15311.871528625488 10455.71231842041 1518.2560384273531 130007654.4 6422528
17 4401.151974995931 13132.736206054688 9184.367656707764 136365772.8 6823936
18 9876.480102539062 6173.60003789266 12630.815982818604 140988313.6 7225344
19 16105.472564697267 6052.064100901286 1621.743977069855 147965440.0 7626752
20 4123.135983943939 9304.608345031738 1495.743989944458 155809280.0 8028160
21 16615.423679351807 7612.053553263347 1846.07994556427 158878003.2 8429568
22 4387.157281239826 7764.8961544036865 2132.8959465026855 165547929.6 8830976
23 10146.81625366211 6781.728029251099 6441.215991973877 173900492.8 9232384
24 7133.18395614624 10999.9361038208 2068.8319206237793 179249868.8 9633792
25 5562.367916107178 6630.391955375672 1840.5760129292808 188873216.0 10035200
26 8176.639556884765 6642.944097518921 2472.5696086883545 191194009.6 10436608
27 15110.655784606934 10934.687614440918 1970.8799719810486 197736755.2 10838016
28 15045.632362365723 7450.592041015626 4449.888229370117 205501952.0 11239424
29 4914.8586591084795 6881.9840749104815 2591.7248249053955 210357350.4 11640832
30 10291.199684143066 7090.0373458862305 2930.464029312134 215479808.0 12042240
31 9965.567588806152 6729.621410369874 1996.7119395732877 222055526.4 12443648
32 3961.173295974732 6260.725339253744 2121.898651123047 229529088.0 12845056
33 19083.263397216797 10504.277229309084 2168.9493656158447 236736409.6 13246464
34 4126.037438710529 7282.848119735718 2348.192056020101 242452787.2 13647872
35 4655.104041099548 6543.327808380128 3215.359926223755 247175475.2 14049280
36 18824.19204711914 7203.882694244385 2258.9120070139566 253970739.2 14450688
37 7517.183780670166 7084.495902061462 3145.855963230133 259148083.2 14852096
38 12702.719688415527 6570.048173268637 3799.423933029175 267618611.2 15253504
39 8372.223854064941 6505.728085835774 3196.9919204711914 272067276.8 15654912
40 8210.432052612303 6463.018735249837 3416.9600009918213 280221184.0 16056320
41 4316.67196750641 6042.616009712218 3129.9626032511396 287072972.8 16457728
42 13934.592247009277 8421.759605407715 2723.189353942871 289466675.2 16859136
43 4602.880001068115 7121.968030929565 3457.40807056427 295688499.2 17260544
44 15833.599567413328 16591.455459594727 8289.85595703125 304292556.8 17661952
45 14750.720024108887 6176.576137542725 3199.536085128784 308300083.2 18063360
46 12913.663864135742 12902.303695678711 15779.775619506838 317643059.2 18464768
47 13201.408386230469 6108.8160276412955 3509.6960067749023 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
