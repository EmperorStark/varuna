Parent process ID: 5353 node: 172.31.26.140
16 per stage
32 servers!
Config:
ranks: range(22, 23)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=22 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 22
USED MODULES
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3225.2586682637534 5386.080026626587 240.04000052809712 44759347.2 401408
2 2944.3413416544595 6406.047821044922 299.8399958014488 51751219.2 802816
3 3016.3626670837407 4060.9493255615234 401.9968032836914 53404364.8 1204224
4 4038.9973322550454 6057.344118754068 538.6959910392761 57765785.6 1605632
5 3645.439942677816 5438.474655151367 610.1013422012329 62352076.8 2007040
6 7707.648118336995 5856.45604133606 627.0293196042379 66519756.8 2408448
7 6697.984218597412 6953.728199005127 682.9679906368256 72710860.8 2809856
8 3923.6266613006587 5767.232100168863 824.4479894638062 78763520.0 3211264
9 9148.415565490723 5796.2400913238525 762.0960175991058 84720742.4 3612672
10 7489.535808563232 5436.503887176515 834.6880078315735 91426713.6 4014080
11 4010.6667677561436 5535.295963287353 948.7600028514862 97633792.0 4415488
12 5422.080039978027 5868.362585703532 1023.0720043182373 104219340.8 4816896
13 3835.903962453207 7583.648204803466 931.5040111541749 110985113.6 5218304
14 7242.7520751953125 5667.680025100708 1225.5359490712483 115547238.4 5619712
15 3570.3465938568115 5300.919890403748 3045.952081680298 122689843.2 6021120
16 3963.9041423797607 5866.78393681844 1603.0399799346924 130007654.4 6422528
17 3968.34127108256 5807.487964630127 1289.3119752407074 136365772.8 6823936
18 13697.02434539795 6755.703926086426 1395.5039978027344 140988313.6 7225344
19 8398.847579956055 5495.9360758463545 1405.9999585151675 147965440.0 7626752
20 3588.4373188018803 5854.328036308289 1705.8453559875488 155809280.0 8028160
21 4007.253328959148 7455.679893493652 1328.5653193791707 158878003.2 8429568
22 3732.480049133301 6239.032030105591 1710.0160121917725 165547929.6 8830976
23 3739.989360173543 5716.586589813233 1749.6960163116455 173900492.8 9232384
24 3910.655975341797 6028.2639265060425 1703.9680480957031 179249868.8 9633792
25 3851.2640794118242 5426.677385965983 18821.279525756836 188873216.0 10035200
26 8648.191928863524 8988.351821899414 1703.8079897562661 191194009.6 10436608
27 3877.5466283162436 9358.416080474854 1662.4320149421692 197736755.2 10838016
28 4007.1679949760432 6268.200039863586 1906.4640402793884 205501952.0 11239424
29 5856.256008148193 5786.01598739624 1951.4720439910889 210357350.4 11640832
30 3806.7200183868413 5891.640067100525 2588.394641876221 215479808.0 12042240
31 7557.119846343994 5861.959934234619 1767.4880027770996 222055526.4 12443648
32 17989.63165283203 7048.906644185384 1882.1866512298586 229529088.0 12845056
33 21304.320017496746 6019.824028015137 1894.4959938526151 236736409.6 13246464
34 5944.320201873779 5628.968000411987 2374.208092689514 242452787.2 13647872
35 3644.7573502858477 6076.407909393311 3363.039970397949 247175475.2 14049280
36 3979.5200228691097 6751.599788665772 3385.024070739746 253970739.2 14450688
37 9341.952323913574 5662.328004837035 2075.626691182454 259148083.2 14852096
38 11863.03997039795 5305.376052856445 2119.178613026937 267618611.2 15253504
39 3852.800011634826 5629.631876945495 2821.7599391937256 272067276.8 15654912
40 3892.2239939371743 7374.815940856934 2339.605331420899 280221184.0 16056320
41 3968.682686487834 7025.936126708984 2560.176014900208 287072972.8 16457728
42 11987.968444824219 6665.472030639649 4923.647880554199 289466675.2 16859136
43 13408.255577087402 7104.533354441324 2890.9119367599487 295688499.2 17260544
44 3841.279983520508 5630.122820536296 2622.2559809684753 304292556.8 17661952
45 19966.976165771484 6266.479969024659 5980.063915252686 308300083.2 18063360
46 15805.440266927086 6041.880011558533 2472.326374053955 317643059.2 18464768
47 12821.50411605835 9028.287887573242 2744.32635307312 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
