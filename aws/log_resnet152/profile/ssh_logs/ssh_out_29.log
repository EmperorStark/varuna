Parent process ID: 4432 node: 172.31.30.89
16 per stage
32 servers!
Config:
ranks: range(29, 30)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=29 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 29
USED MODULES
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 4.0
1 4588.287949562073 6197.8559494018555 549.2479801177979 136542208.0 200704
2 2537.216007709503 3556.663990020752 179.86560165882113 150863462.4 401408
3 3370.495975017548 4551.288127899169 262.50879466533655 151558963.2 602112
4 3625.301361083985 5756.266593933105 300.67200064659124 152474009.6 802816
5 3650.559981664022 4682.8718185424805 353.6959946155548 154650624.0 1003520
6 3508.2240104675293 4898.197333017985 392.8255975246429 157933977.6 1204224
7 3626.751959323883 5228.528022766113 455.2079960703849 159849267.2 1404928
8 14731.264114379883 8490.799903869629 565.0399923324584 162012774.4 1605632
9 4759.893258412679 6938.848018646241 555.1280081272125 163614310.4 1806336
10 4490.922609965006 6887.320041656494 529.0159955620766 164581785.6 2007040
11 5146.9651858011875 6840.09599685669 627.8640031814575 169070592.0 2207744
12 17847.2957611084 6671.41592502594 610.3808045387269 173311590.4 2408448
13 6849.536180496215 6995.466709136963 642.0480012893677 178896896.0 2609152
14 4757.503986358642 7695.359826087952 763.10400168101 181121024.0 2809856
15 5024.768034617106 11887.104034423828 825.2906799316406 187551334.4 3010560
16 4316.842714945476 6985.919952392578 778.5760164260864 191602688.0 3211264
17 4999.850591023764 7156.5866470336905 847.031995654106 195647385.6 3411968
18 4795.392036437988 6883.831977844238 776.7679840326309 198591283.2 3612672
19 4674.560070037841 7358.549435933431 710.5600039164226 204042649.6 3813376
20 14333.439826965332 7560.256004333496 892.7360028028488 209597235.2 4014080
21 4526.335954666138 6802.026748657227 813.0799978971481 213197619.2 4214784
22 4466.943979263305 6768.810590108235 836.3968014717104 219314585.6 4415488
23 4740.0959730148315 6919.983983039856 900.8511900901794 225757286.4 4616192
24 5185.024023056031 6997.951825459797 909.3952059745789 228956672.0 4816896
25 4590.250651041666 9567.04044342041 1059.999942779541 234279014.4 5017600
26 20960.76774597168 8568.511962890625 921.8559861183168 238257868.8 5218304
27 5980.160236358643 10560.864448547363 1139.1519904136658 246309683.2 5419008
28 13489.664077758787 7587.552070617676 1087.5999927520752 248974643.2 5619712
29 17264.639854431152 6954.735994338989 1105.7600080966952 256635801.6 5820416
30 5001.215934753419 16612.5431060791 1017.5146659215293 261231001.6 6021120
31 4600.320100784302 6871.039986610412 1086.3552093505862 265124659.2 6221824
32 12072.959899902344 6663.551966349285 1198.2613404591877 272334950.4 6422528
33 17164.799690246582 7292.02143351237 1067.840039730072 276138905.6 6623232
34 10595.328330993652 7627.679983774821 1228.0533313751223 286314905.6 6823936
35 5176.83219909668 7521.008014678955 1186.8799924850464 287834624.0 7024640
36 4592.981338500977 7564.015984535217 1428.2159805297852 292738764.8 7225344
37 11466.752052307129 6773.183941841126 1164.1813119252524 300602777.6 7426048
38 7196.671962738037 8369.584083557129 1507.1119964122772 303867904.0 7626752
39 4435.967922210693 7283.2746505737305 1239.9786710739136 308404531.2 7827456
40 5658.112049102783 7464.848041534423 1895.7440257072449 315310182.4 8028160
41 10387.455940246582 6893.144011497498 1282.6133171717327 319662489.6 8228864
42 5468.160152435303 8973.920186360676 1372.6080060005188 323029504.0 8429568
43 11583.488464355469 6879.530588785807 1358.3840131759644 328565248.0 8630272
44 14623.744010925293 6688.693205515545 1389.1039788722992 335624192.0 8830976
45 4486.485322316488 7154.496192932128 1382.5999796390533 341530624.0 9031680
46 12759.039878845215 6922.794500986735 1621.0559904575348 346429132.8 9232384
47 8445.95193862915 6974.1333325703945 2403.1999111175537 351814553.6 9433088
pre-alr mem 43496448
All reduce times
32 [0.0, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
