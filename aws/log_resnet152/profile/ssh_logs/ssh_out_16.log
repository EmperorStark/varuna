Parent process ID: 7737 node: 172.31.19.112
16 per stage
32 servers!
Config:
ranks: range(16, 17)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=16 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 16
USED MODULES
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3479.5520305633545 5030.1759243011475 205.87732891241708 44759347.2 401408
2 2906.7946275075274 8532.095909118652 312.7679973840713 51751219.2 802816
3 4205.568075180054 5607.7117919921875 409.7519963979721 53404364.8 1204224
4 7846.911907196046 5714.840054512023 621.3653087615967 57765785.6 1605632
5 4197.717348734537 7911.263942718506 560.0106517473856 62352076.8 2007040
6 3688.703954219818 5915.818691253662 590.7600075006485 66519756.8 2408448
7 3937.621434529622 7731.904029846191 718.7626759211221 72710860.8 2809856
8 3821.2266763051352 10020.048141479492 700.1120001077652 78763520.0 3211264
9 7448.064088821411 6592.288017272949 728.1039953231812 84720742.4 3612672
10 3897.002696990967 7124.464035034179 796.7040141423544 91426713.6 4014080
11 4100.437323252361 5828.840136528014 2185.8561038970947 97633792.0 4415488
12 10056.703567504883 5758.389314015706 858.0863952636719 104219340.8 4816896
13 3814.65607881546 13579.952239990236 4178.49588394165 110985113.6 5218304
14 4105.89869817098 12782.912254333496 1163.6373202006023 115547238.4 5619712
15 5529.088020324707 5709.63191986084 1041.680008172989 122689843.2 6021120
16 5107.7117919921875 5644.551992416382 1075.4239956537883 130007654.4 6422528
17 3749.2052714029946 5806.4000606536865 1086.2720012664795 136365772.8 6823936
18 3734.8693211873374 5884.136080741881 1134.4533363978069 140988313.6 7225344
19 4151.6373952229815 8382.080078125 4824.831962585448 147965440.0 7626752
20 5342.207908630371 6612.906614939372 1447.552005449931 155809280.0 8028160
21 10643.968105316162 7418.015956878662 10588.99211883545 158878003.2 8429568
22 12777.983665466309 5857.4159145355225 1325.3888130187988 165547929.6 8830976
23 3889.151970545451 7001.5997886657715 1408.8319778442383 173900492.8 9232384
24 3700.223982334137 5963.98401260376 1762.3520493507385 179249868.8 9633792
25 4979.200124740601 5866.794745127359 1646.7440128326416 188873216.0 10035200
26 6176.767826080322 8110.688209533692 1553.109327952067 191194009.6 10436608
27 13104.127883911133 5774.623990058899 1670.6160008907318 197736755.2 10838016
28 4091.221332550049 9135.616302490234 1653.6000072956087 205501952.0 11239424
29 4399.103999137878 6641.8880224227905 2527.359962463379 210357350.4 11640832
30 3698.005358378093 5889.73593711853 1689.0000104904175 215479808.0 12042240
31 6235.647916793823 7288.1598472595215 1931.9200217723846 222055526.4 12443648
32 9464.832305908203 5919.455885887146 1894.51202750206 229529088.0 12845056
33 3503.1040310859685 6476.040005683898 1823.1679995854697 236736409.6 13246464
34 9125.376224517822 9461.055755615234 2305.397351582845 242452787.2 13647872
35 4203.5199999809265 5872.650623321533 2369.2906697591147 247175475.2 14049280
36 3782.997290293376 5734.047889709473 2466.7199452718096 253970739.2 14450688
37 15463.935852050783 5579.093297322591 2054.672002792359 259148083.2 14852096
38 3665.237347284953 5253.312110900879 2299.7226715087886 267618611.2 15253504
39 25820.159912109375 6704.480171203613 2190.4106934865317 272067276.8 15654912
40 10268.671989440918 5666.919946670531 2171.289587020874 280221184.0 16056320
41 3978.2399336496997 7346.303939819336 2363.495945930481 287072972.8 16457728
42 4183.040062586466 6119.688034057617 2918.560028076172 289466675.2 16859136
43 3965.951979160309 5741.226673126221 2535.7120037078857 295688499.2 17260544
44 4037.3759269714355 5958.191871643066 2481.3013076782227 304292556.8 17661952
45 9463.808059692383 10429.439544677734 2560.650666554769 308300083.2 18063360
46 11328.512191772461 5953.354676564534 2588.202714920044 317643059.2 18464768
47 16743.935585021973 5817.255973815917 39141.56723022461 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
