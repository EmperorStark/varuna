Parent process ID: 7480 node: 172.31.16.5
16 per stage
32 servers!
Config:
ranks: range(6, 7)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=6 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 6
USED MODULES
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
6 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
1 2194.4319009780884 3618.079980214437 399.40479993820185 13273907.2 802816
2 6160.384178161621 4120.400071144104 593.824028968811 23155097.6 1605632
3 2758.6560249328613 2727.1466255187984 694.0266688664755 32588185.6 2408448
4 1963.3493423461914 3597.4080562591553 857.927992939949 42021273.6 3211264
5 1926.1439740657806 3229.845364888509 908.7840020656586 52583321.6 4014080
6 7361.536026000977 3238.4213606516523 830.1013509432474 60887449.6 4816896
7 2030.5920044581092 4330.9760093688965 1451.2319564819336 70320537.6 5619712
8 1886.7200016975403 3929.9678802490234 1052.1360039710999 79753625.6 6422528
9 1950.378656387329 3919.304013252258 1691.1200284957886 90257817.6 7225344
10 2116.2666877110796 3744.2879676818848 1429.680049419403 99160473.6 8028160
11 2034.4319641590118 11205.935955047607 2104.048013687134 108052889.6 8830976
12 1905.1520228385923 12680.176258087156 19735.85605621338 118026649.6 9633792
13 1952.4266322453818 3619.488000869751 1513.5680039723716 127312281.6 10436608
14 3150.847911834717 3365.6213283538814 2069.5040225982666 138121625.6 11239424
15 3856.384038925171 3255.072057247162 2376.304030418396 146866585.6 12042240
16 2122.2400069236755 3909.3225797017412 2297.3679900169373 155218329.6 12845056
17 2065.7493273417153 3695.9359645843506 3649.4081020355225 166824345.6 13647872
18 2085.887998342514 4558.495998382568 2334.7413539886475 175690137.6 14450688
19 2005.6746800740564 3514.719963073731 2116.725365320842 186368409.6 15253504
20 2050.8160293102264 3267.6586310068765 2499.4640350341797 194392473.6 16056320
21 2856.9600582122803 3542.7680015563965 2327.4986743927007 202383769.6 16859136
22 1993.7280019124348 2970.9653059641523 2663.78402709961 212799897.6 17661952
23 2014.890750249227 4773.535966873169 2607.7280044555664 225581465.6 18464768
24 2012.8426551818848 3712.4160130818686 2618.1760430336 231453081.6 19267584
25 2034.3466599782307 4067.6586627960205 2758.3920359611507 244660633.6 20070400
26 2248.4479546546936 5175.19998550415 2815.200010935465 250630553.6 20873216
27 7780.3521156311035 3169.802665710449 4065.034707387289 261046681.6 21676032
28 2158.5920453071594 4382.1120262146 3522.584021091461 270184857.6 22478848
29 2345.301389694214 3635.264039039612 45024.27101135253 278790553.6 23281664
30 2155.2640199661255 3345.1840082804365 3213.8559818267827 288018841.6 24084480
31 2079.487979412079 3679.200013478597 3674.5119094848633 299360665.6 24887296
32 2046.2079644203188 3891.071955362956 3951.9439339637756 309293465.6 25690112
33 2175.3173669179278 3709.5839977264404 4353.9838790893555 317890969.6 26492928
34 4897.791862487793 4009.6160173416138 11592.672348022461 326545817.6 27295744
35 2242.048025131225 3103.690703709921 11252.879619598389 336355737.6 28098560
36 2768.8961029052734 4947.872161865234 58494.70520019531 348238233.6 28901376
37 2200.0640034675594 3682.8373273213706 43776.2565612793 354103705.6 29704192
38 13073.920249938965 3287.338654200236 4894.720077514648 365785497.6 30507008
39 7402.495861053467 3463.2800221443176 3974.581400553386 373506457.6 31309824
40 2313.898642857869 3689.7120475769048 4866.677284240723 383971737.6 32112640
41 11009.024143218994 3806.7840933799744 5019.1359519958505 393441689.6 32915456
42 2328.2346725463867 4007.519841194153 6013.535976409912 400478617.6 33718272
43 2352.8107007344565 3570.912003517151 4915.224075317383 410403225.6 34521088
44 2240.2560710906982 3627.992033958435 4551.904042561849 423063961.6 35323904
45 2245.290676752726 4214.2239809036255 4816.375970840454 428945817.6 36126720
46 2318.848013877869 5034.783840179443 4711.936116218567 440668569.6 36929536
47 11655.168056488037 3169.0239906311035 4909.0800285339365 447791513.6 37732352
pre-alr mem 1686528
All reduce times
32 [0.0, 77082.90100097656, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2587.420701980591, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 3260.885000228882, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 7401.375770568848, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 41642.83752441406, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 195635.6201171875, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
