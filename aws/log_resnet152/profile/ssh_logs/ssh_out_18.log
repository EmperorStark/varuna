Parent process ID: 5903 node: 172.31.24.191
16 per stage
32 servers!
Config:
ranks: range(18, 19)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=18 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 18
USED MODULES
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
18 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3708.9279890060425 8778.97596359253 237.7520017325878 44759347.2 401408
2 2943.317413330078 8715.728282928469 318.38719844818115 51751219.2 802816
3 3675.647974014282 7602.65588760376 409.4720035791397 53404364.8 1204224
4 3897.3440329233813 6538.048028945923 454.2912006378173 57765785.6 1605632
5 8259.584426879883 6423.663854598999 523.2480019330978 62352076.8 2007040
6 3644.074598948161 24985.66436767578 601.5360116958618 66519756.8 2408448
7 3589.4614060719805 5801.429271697999 666.4533217748008 72710860.8 2809856
8 8917.503833770752 6956.336021423339 736.1599802970886 78763520.0 3211264
9 7468.031883239746 8066.431999206543 812.2799992561339 84720742.4 3612672
10 3737.3440265655518 6182.1333567301435 810.5343818664551 91426713.6 4014080
11 9786.368370056152 6027.925332387289 1060.6639981269836 97633792.0 4415488
12 8446.293195088705 6276.383996009827 1030.623972415924 104219340.8 4816896
13 14957.568168640137 6262.186845143636 6585.728168487549 110985113.6 5218304
14 18744.319915771484 9294.624328613281 1050.151988863945 115547238.4 5619712
15 9260.031700134277 10780.048370361328 1121.5839982032776 122689843.2 6021120
16 3851.264059543609 8055.999755859374 1244.7440028190613 130007654.4 6422528
17 30307.327270507812 22872.336387634277 5413.034756978353 136365772.8 6823936
18 12597.248077392578 5608.021259307861 1405.344009399414 140988313.6 7225344
19 3648.170709609985 6126.240015029907 1249.621351559957 147965440.0 7626752
20 12059.647560119629 7168.768167495728 1449.2160081863403 155809280.0 8028160
21 8828.927993774414 7326.879978179932 1350.5066633224487 158878003.2 8429568
22 3987.7120256423955 7568.480014801025 24151.071548461914 165547929.6 8830976
23 3986.431996027628 5697.215914726256 1540.1151895523071 173900492.8 9232384
24 3929.4293721516924 7003.887891769408 20794.09090677897 179249868.8 9633792
25 3833.1732749938965 6121.450742085775 1529.3839871883395 188873216.0 10035200
26 3825.407922267914 5758.2879066467285 1553.2480001449585 191194009.6 10436608
27 3938.645362854004 6057.397365570069 1622.4192142486575 197736755.2 10838016
28 4150.272071361542 6220.328092575073 1999.221324920654 205501952.0 11239424
29 3886.3359689712524 6329.14400100708 1694.7306791941326 210357350.4 11640832
30 3855.359971523285 10251.968383789062 1796.7760264873505 215479808.0 12042240
31 3917.1412785847983 5856.751918792725 1875.3279924392702 222055526.4 12443648
32 14380.032062530516 5916.455984115601 1864.5333449045816 229529088.0 12845056
33 12511.232376098633 6112.208008766174 2224.757353464762 236736409.6 13246464
34 7610.367774963379 6144.248008728027 3605.760097503662 242452787.2 13647872
35 3923.6266613006587 6478.3360958099365 2043.1199669837954 247175475.2 14049280
36 3988.223969936371 6278.512001037598 2367.8080240885415 253970739.2 14450688
37 4056.576013565063 11644.778569539387 2327.648003896077 259148083.2 14852096
38 5884.928226470947 9404.304027557371 2081.2586148579912 267618611.2 15253504
39 4273.49328994751 12059.679985046387 2364.9919827779136 272067276.8 15654912
40 3952.6399970054626 5894.560019175213 2253.290732701619 280221184.0 16056320
41 14313.471794128418 5952.138741811116 2324.0319887797036 287072972.8 16457728
42 16765.269597371418 10323.488235473633 39575.056076049805 289466675.2 16859136
43 15895.551681518555 6275.5279541015625 2614.192008972168 295688499.2 17260544
44 17992.704391479492 6088.970661163331 2568.8560009002686 304292556.8 17661952
45 13762.55989074707 5531.488060951233 2492.4319982528687 308300083.2 18063360
46 3570.6879297892256 6296.032110850016 38055.67932128906 317643059.2 18464768
47 5426.176071166992 5847.640037536622 2604.5279502868652 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
