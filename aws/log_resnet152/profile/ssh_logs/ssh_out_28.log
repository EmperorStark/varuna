Parent process ID: 4364 node: 172.31.27.21
16 per stage
32 servers!
Config:
ranks: range(28, 29)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=28 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 28
USED MODULES
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
28 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3227.136015892029 4701.584100723267 251.48160159587866 44759347.2 401408
2 2872.5759983062744 8441.471894582113 301.0752022266388 51751219.2 802816
3 4716.544151306152 5028.554598490397 413.89866669972736 53404364.8 1204224
4 14603.264331817627 5537.056128184001 474.82666373252863 57765785.6 1605632
5 7939.072132110595 5698.858578999838 583.6719870567322 62352076.8 2007040
6 9151.488304138184 5432.776093482971 545.8880066871643 66519756.8 2408448
7 10893.824100494385 6368.554592132568 761.0453168551127 72710860.8 2809856
8 3974.82681274414 6024.405320485434 4143.167972564697 78763520.0 3211264
9 13430.784225463867 5404.295921325684 746.1887955665588 84720742.4 3612672
10 3704.5760154724117 5412.7360582351685 1658.30397605896 91426713.6 4014080
11 10407.936096191406 5543.050765991211 1222.5599884986877 97633792.0 4415488
12 7907.327969868978 5656.224012374879 865.6000047922134 104219340.8 4816896
13 8639.999866485596 5554.442564646403 5753.8721561431885 110985113.6 5218304
14 7602.175712585449 7205.8132489522295 939.5776033401489 115547238.4 5619712
15 3475.7972558339434 5205.23738861084 1425.279974937439 122689843.2 6021120
16 3478.5280227661133 5600.879907608031 1161.6719961166384 130007654.4 6422528
17 9042.943954467773 6039.893309275309 1695.0080394744873 136365772.8 6823936
18 3663.5306676228843 5431.648015975952 7875.199794769288 140988313.6 7225344
19 3497.9840119679766 5233.424067497253 1460.5440139770508 147965440.0 7626752
20 3696.8960165977483 5637.495994567871 1594.9440002441406 155809280.0 8028160
21 3536.639988422394 5624.312043190003 1310.247987508774 158878003.2 8429568
22 3889.1520500183105 5476.885318756103 1940.335988998413 165547929.6 8830976
23 4430.848121643066 6986.320018768311 1687.6479983329773 173900492.8 9232384
24 3771.391948064168 5926.719983418781 1408.341328303019 179249868.8 9633792
25 3827.9680013656616 5947.8559494018555 2152.0800590515137 188873216.0 10035200
26 15810.560703277586 8367.695808410645 1620.472013950348 191194009.6 10436608
27 3796.309391657511 5434.303998947144 1739.8826281229656 197736755.2 10838016
28 17318.400382995605 8376.00040435791 1602.4213631947837 205501952.0 11239424
29 4206.591844558716 6220.631957054138 12488.608360290527 210357350.4 11640832
30 3970.304012298583 7636.0321044921875 1912.4266703923545 215479808.0 12042240
31 7258.111953735352 5900.970617930095 1705.4186662038169 222055526.4 12443648
32 12088.319778442383 5923.210620880127 2694.272041320801 229529088.0 12845056
33 3578.8799921671543 6592.26655960083 1844.6186780929568 236736409.6 13246464
34 3459.07199382782 5990.18394947052 2904.1919708251953 242452787.2 13647872
35 9718.783855438232 5759.759902954102 1919.4240172704058 247175475.2 14049280
36 13573.1201171875 6393.952131271362 2050.9440104166665 253970739.2 14450688
37 15894.52838897705 5645.3226407368975 2447.7695941925053 259148083.2 14852096
38 12879.359722137451 5425.653298695882 2535.6799761454267 267618611.2 15253504
39 6685.696125030518 6338.271856307984 2133.73867670695 272067276.8 15654912
40 3758.3360075950623 6348.440051078796 2137.7727985382085 280221184.0 16056320
41 3813.034693400065 5704.405307769775 2691.797335942587 287072972.8 16457728
42 3761.1520290374756 5456.426620483398 8449.055671691895 289466675.2 16859136
43 16684.032440185547 6387.056112289429 2317.5253868103023 295688499.2 17260544
44 3915.093342463175 7326.784133911133 2934.432029724121 304292556.8 17661952
45 3733.1626415252686 5488.1999492645255 2625.8453528086347 308300083.2 18063360
46 3620.181322097779 5641.071915626525 42595.32928466797 317643059.2 18464768
47 19832.83233642578 5682.423949241637 2528.4639596939087 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
