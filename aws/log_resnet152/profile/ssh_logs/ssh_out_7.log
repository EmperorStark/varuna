Parent process ID: 7197 node: 172.31.16.100
16 per stage
32 servers!
Config:
ranks: range(7, 8)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=7 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 7
USED MODULES
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
7 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
1 1649.1519808769224 2815.018653869629 391.18399471044546 13273907.2 802816
2 6040.063858032227 2781.8667093912763 475.92000663280487 23155097.6 1605632
3 1846.0160195827484 8563.615798950195 694.8799937963486 32588185.6 2408448
4 1762.5599801540377 3331.663966178894 918.2506601015727 42021273.6 3211264
5 1940.9919679164886 3126.800060272217 1146.6559966405232 52583321.6 4014080
6 2748.415946960449 3518.391966819763 5331.840038299561 60887449.6 4816896
7 1965.7386938730874 4831.264019012451 919.4303989410399 70320537.6 5619712
8 2033.4080159664152 3202.0373344421387 1141.482671101888 79753625.6 6422528
9 1992.447942495346 3362.047990163167 1520.1173623402913 90257817.6 7225344
10 1941.5040016174314 3536.4639163017273 2764.6079063415527 99160473.6 8028160
11 1909.7599983215332 3505.845308303833 1928.7680387496948 108052889.6 8830976
12 1870.8479702472687 3477.2319793701176 1840.7679796218872 118026649.6 9633792
13 1914.879997571309 3790.613333384196 2067.9359436035156 127312281.6 10436608
14 1989.6320104599001 3538.9440854390464 1644.917329152425 138121625.6 11239424
15 2025.813380877177 6387.743949890137 2094.016035397847 146866585.6 12042240
16 2067.456066608429 4848.671913146973 2510.240077972412 155218329.6 12845056
17 2021.6320157051089 5761.407852172852 2217.5146738688154 166824345.6 13647872
18 1952.7680079142253 3322.335958480835 2561.0400438308716 175690137.6 14450688
19 2057.9840540885925 3972.4692503611245 2587.5840187072754 186368409.6 15253504
20 1958.229343096415 6426.559925079346 2587.6960754394527 194392473.6 16056320
21 1966.8479561805725 3600.392043590545 2401.2799859046936 202383769.6 16859136
22 1967.103997866313 3302.6000261306763 2491.8240308761597 212799897.6 17661952
23 2077.1839916706085 3619.7599172592163 2698.9999413490295 225581465.6 18464768
24 11006.976127624512 3000.2667109171553 2543.8079833984375 231453081.6 19267584
25 1979.6480238437653 3335.752010345459 2608.6080074310303 244660633.6 20070400
26 2071.2960064411163 3201.840043067932 3160.853306452433 250630553.6 20873216
27 1992.3627376556394 3266.0160064697266 5015.391826629639 261046681.6 21676032
28 2051.072001457215 3155.3760170936584 3081.237316131592 270184857.6 22478848
29 2001.9200146198275 4213.343858718872 6798.336029052734 278790553.6 23281664
30 2116.864025592804 3795.6053415934243 3375.424027442932 288018841.6 24084480
31 1999.8719692230225 3521.0452874501543 4070.0799624125157 299360665.6 24887296
32 2072.8319883346558 3264.631986618042 47041.91970825196 309293465.6 25690112
33 2116.0959899425507 3138.5679841041565 4135.887861251832 317890969.6 26492928
34 2094.0800309181213 3714.6773338317867 3492.569589614868 326545817.6 27295744
35 10950.655937194824 3134.8053614298506 66657.2799682617 336355737.6 28098560
36 2188.7999773025513 3570.8586374918623 71032.62329101561 348238233.6 28901376
37 2239.146629969279 3132.416009902954 4353.847980499268 354103705.6 29704192
38 11741.18423461914 4096.895933151246 4729.589303334554 365785497.6 30507008
39 2091.0079479217525 3554.6240011850996 5021.000146865846 373506457.6 31309824
40 2150.0586668650312 3456.565300623576 4100.821336110433 383971737.6 32112640
41 2192.896008491516 3642.1012878417973 5047.733306884766 393441689.6 32915456
42 7393.280029296875 3330.352008342743 4272.2240686416635 400478617.6 33718272
43 2205.6959867477417 3637.5519037246704 4269.990348815918 410403225.6 34521088
44 10736.127853393555 4265.791893005371 4392.448107401529 423063961.6 35323904
45 2168.576002120972 5773.872137069702 5896.864056587219 428945817.6 36126720
46 2273.6213207244873 3681.6639900207515 5208.015918731689 440668569.6 36929536
47 2207.4027061462407 4227.5519371032715 5604.616045951843 447791513.6 37732352
pre-alr mem 1686528
All reduce times
32 [0.0, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
