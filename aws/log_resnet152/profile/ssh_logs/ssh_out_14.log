Parent process ID: 6395 node: 172.31.21.45
16 per stage
32 servers!
Config:
ranks: range(14, 15)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=14 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 14
USED MODULES
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
14 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3195.904016494751 5225.40807723999 275.48800408840174 44759347.2 401408
2 2957.5679898262024 4079.4559121131897 300.48000216484076 51751219.2 802816
3 2927.9573758443194 4302.623907725016 399.3280008435249 53404364.8 1204224
4 4646.912097930908 6981.215953826904 454.8223972320557 57765785.6 1605632
5 4123.306751251221 7052.99186706543 620.3999817371368 62352076.8 2007040
6 8697.855949401855 7629.600048065186 543.6159968376161 66519756.8 2408448
7 3391.146659851074 7214.943885803223 631.5968036651611 72710860.8 2809856
8 7113.728046417236 19609.216690063477 752.128005027771 78763520.0 3211264
9 5094.399929046631 27785.343170166016 796.6399788856506 84720742.4 3612672
10 10691.583633422852 6487.9147211710615 773.0560064315796 91426713.6 4014080
11 4137.983798980713 5629.8720836639395 909.8160117864609 97633792.0 4415488
12 12789.247989654541 5988.183975219727 869.9920028448104 104219340.8 4816896
13 10974.207878112793 8016.992092132569 1151.1146624883015 110985113.6 5218304
14 3717.3759937286377 10329.535961151123 978.3439785242081 115547238.4 5619712
15 3574.1013685862226 7159.055948257445 994.1440105438231 122689843.2 6021120
16 3739.9893601735434 5591.983914375304 1162.4639987945557 130007654.4 6422528
17 3641.0880088806152 6578.783830006918 3835.71195602417 136365772.8 6823936
18 3997.951924800873 5989.04812335968 1335.2255821228025 140988313.6 7225344
19 3594.2400097846985 6090.421358744304 4286.431789398193 147965440.0 7626752
20 3787.434736887614 6692.416071891785 1263.4080052375793 155809280.0 8028160
21 14308.864116668701 14731.743812561035 1477.7759909629822 158878003.2 8429568
22 20838.39988708496 14682.624340057373 1356.1173280080159 165547929.6 8830976
23 10159.786860148111 6646.528085072836 2374.9759197235107 173900492.8 9232384
24 4697.08776473999 8159.7278118133545 1677.6560246944427 179249868.8 9633792
25 9516.031742095949 7049.034754435221 34865.79990386963 188873216.0 10035200
26 3944.4480737050376 5608.224074045817 1619.7866996129358 191194009.6 10436608
27 15934.464454650879 5774.279952049255 1841.1413033803303 197736755.2 10838016
28 9686.016082763672 6067.039966583252 1683.2639932632446 205501952.0 11239424
29 4126.0372797648115 6312.895933787028 19058.06446075439 210357350.4 11640832
30 3725.9946664174404 6331.648031870525 1685.8133474985757 215479808.0 12042240
31 13109.248161315918 8954.367637634277 1883.8933308919272 222055526.4 12443648
32 3632.1279207865396 5864.927927652995 1849.226673444112 229529088.0 12845056
33 3540.224015712738 6002.431869506836 1842.1760002772012 236736409.6 13246464
34 7792.640209197998 7330.431938171386 2506.9119930267334 242452787.2 13647872
35 13590.527534484863 5995.231946309408 2132.687985897064 247175475.2 14049280
36 3959.5519900321956 11093.40763092041 2443.5199896494546 253970739.2 14450688
37 12210.176467895508 8769.263744354248 2157.591998577118 259148083.2 14852096
38 4236.287832260133 6279.872179031372 2320.5440044403076 267618611.2 15253504
39 17035.776138305664 5518.840074539185 2377.1413962046304 272067276.8 15654912
40 4585.983991622925 7141.151905059814 3622.7519512176514 280221184.0 16056320
41 4082.6879342397056 10138.549168904621 2453.439998626709 287072972.8 16457728
42 3791.104018688202 8056.320190429688 2315.146684646606 289466675.2 16859136
43 9072.640419006348 8496.816158294678 2837.1200561523438 295688499.2 17260544
44 3957.2480320930486 5768.9759731292725 2541.5680408477783 304292556.8 17661952
45 4497.920036315918 7006.9122314453125 3609.407901763916 308300083.2 18063360
46 3745.1093196868896 5915.735960006714 2658.047914505005 317643059.2 18464768
47 3643.0506706237793 7794.6882247924805 2463.42396736145 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
