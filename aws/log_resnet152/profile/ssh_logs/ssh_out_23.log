Parent process ID: 5349 node: 172.31.28.143
16 per stage
32 servers!
Config:
ranks: range(23, 24)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=23 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 23
USED MODULES
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
23 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 2885.9733740488687 10731.279850006104 226.64960026741025 44759347.2 401408
2 3909.631967544556 5948.8959312438965 335.07999777793884 51751219.2 802816
3 5497.856140136719 10173.967838287354 340.88534116744995 53404364.8 1204224
4 3920.896053314209 9079.487800598145 510.8160078525543 57765785.6 1605632
5 4050.602595011394 5676.906744639078 554.4000029563904 62352076.8 2007040
6 5154.303789138794 6051.167964935304 566.1360025405885 66519756.8 2408448
7 14014.464378356934 12068.73607635498 649.0112066268922 72710860.8 2809856
8 3622.2292582194013 6291.530609130859 663.7200117111206 78763520.0 3211264
9 3571.029265721639 5620.1171875 712.320014834404 84720742.4 3612672
10 3723.5200405120845 6045.5360412597665 822.0928072929382 91426713.6 4014080
11 17973.247528076172 7804.992198944092 1032.960057258606 97633792.0 4415488
12 10094.079971313477 6231.626669565837 991.2853042284648 104219340.8 4816896
13 4086.4427884419765 6155.400037765503 6028.255939483643 110985113.6 5218304
14 4009.215950965881 5945.224046707152 1190.8159852027893 115547238.4 5619712
15 8802.303949991861 7941.919803619385 1780.1920175552368 122689843.2 6021120
16 3875.8400082588196 5410.175959269206 1156.448006629944 130007654.4 6422528
17 7097.343921661377 5666.391968727112 1085.096001625061 136365772.8 6823936
18 11581.439971923828 5967.679977416992 1193.5119926929474 140988313.6 7225344
19 3446.4426040649414 6006.709257761638 1226.0879874229431 147965440.0 7626752
20 6365.1838302612305 15330.623626708984 9764.927864074707 155809280.0 8028160
21 8704.000473022461 5763.855934143066 9258.048057556152 158878003.2 8429568
22 3879.9359798431396 7380.160093307496 11036.464214324951 165547929.6 8830976
23 14503.935813903809 9837.311744689941 6244.095802307129 173900492.8 9232384
24 3914.4106705983477 5891.029357910156 1477.8879880905151 179249868.8 9633792
25 3945.4720020294194 5892.599821090698 23044.336318969727 188873216.0 10035200
26 13967.35954284668 5292.760014533997 1571.5999901294708 191194009.6 10436608
27 3828.7359873453775 7621.223926544189 1692.791998386383 197736755.2 10838016
28 5423.103809356689 7274.282614390056 1637.4400059382122 205501952.0 11239424
29 6123.5198974609375 5532.863934834799 1936.832010746002 210357350.4 11640832
30 4055.5520057678223 6754.816055297851 1888.160020112991 215479808.0 12042240
31 4886.528015136719 6219.46394443512 1842.712014913559 222055526.4 12443648
32 9118.720054626465 6130.144119262695 2004.3946107228594 229529088.0 12845056
33 3505.8347384134927 10990.880012512207 1891.295999288559 236736409.6 13246464
34 10724.35188293457 7272.703886032104 1980.6239902973175 242452787.2 13647872
35 3773.4400431315103 5947.8479623794565 5523.903846740723 247175475.2 14049280
36 14609.408378601074 8002.176284790038 2220.6639647483826 253970739.2 14450688
37 3872.2559809684753 10342.30375289917 2095.871925354004 259148083.2 14852096
38 6939.648151397705 15781.199932098387 2157.3599576950073 267618611.2 15253504
39 4094.2934354146328 6214.122772216797 2328.703999519348 272067276.8 15654912
40 3899.7333844502764 8841.615676879883 2288.648009300232 280221184.0 16056320
41 14094.335556030273 13317.615985870363 2284.7920060157776 287072972.8 16457728
42 4166.314601898193 12783.072471618652 5369.088172912598 289466675.2 16859136
43 15628.288269042969 8161.727905273437 2902.400016784668 295688499.2 17260544
44 3845.1200326283774 5687.360127766927 2406.7903995513916 304292556.8 17661952
45 16216.064453125002 6005.52797317505 2499.8079538345337 308300083.2 18063360
46 11612.159729003906 6311.199982961019 2660.1920127868652 317643059.2 18464768
47 3593.216021855672 6114.59195613861 2531.4176082611084 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
