Parent process ID: 7647 node: 172.31.20.223
16 per stage
32 servers!
Config:
ranks: range(1, 2)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=1 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 1
USED MODULES
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 16.0
1 2672.9812622070312 4101.088047027588 519.7680070996284 21630259.2 1605632
2 2404.6934445699058 4882.559776306152 763.2000048955282 39883673.6 3211264
3 2848.76799583435 5252.831935882569 6523.808002471924 58549145.6 4816896
4 2721.1093902587886 4893.514633178712 1504.6719908714297 77443993.6 6422528
5 2634.495913982392 4076.7199993133545 1814.3280148506165 96730009.6 8028160
6 2477.824032306671 3967.7839279174805 5171.487808227539 114873241.6 9633792
7 2479.4453779856367 3741.1440014839172 2028.3999443054197 135482265.6 11239424
8 2498.560031255086 3713.184038798014 14413.087844848633 153711513.6 12845056
9 2415.95729192098 5014.384031295777 2180.12801806132 172868505.6 14450688
10 4175.871849060059 4415.9040451049805 12137.08782196045 190960537.6 16056320
11 2639.360010623932 5116.405328114827 3111.4479899406433 208855961.6 17661952
12 2672.896027565002 4049.543976783753 30002.74149576823 226636697.6 19267584
13 2651.1361002922063 6032.351970672607 24951.50375366211 246545305.6 20873216
14 2539.520025253296 4340.144038200378 50717.64755249024 266269593.6 22478848
15 2428.4160137176514 3791.50931040446 52705.375671386726 283763609.6 24084480
16 2606.7627271016436 13067.808151245117 4548.117160797118 304575385.6 25690112
17 4427.775859832764 3550.671935081482 53499.00817871094 320291737.6 27295744
18 2671.95733388265 3793.2479977607727 35282.97424316406 343380889.6 28901376
19 8396.80004119873 5923.8080978393555 38755.13458251953 357491609.6 30507008
20 2730.666716893514 3846.8266328175864 91481.15539550781 380695449.6 32112640
21 2854.4000387191772 6706.208229064941 81601.42517089844 394691481.6 33718272
22 5024.767875671387 4304.431915283202 5226.182365417481 416142233.6 35323904
23 2888.7040019035344 4446.730613708497 5915.647983551025 433343385.6 36929536
24 8760.319709777832 4362.133344014486 6337.3122215271 452424601.6 38535168
25 2742.784023284912 9271.146774291992 38655.23147583008 470209433.6 40140800
26 2809.8560174306235 4068.042755126954 22565.85693359375 489722777.6 41746432
27 2886.143982410431 4426.912069320679 5895.799994468689 507040665.6 43352064
28 2878.4639835357666 4039.6159489949546 80485.79406738281 525972377.6 44957696
29 2859.264016151428 4225.015997886658 6243.704080581666 543916953.6 46563328
30 2930.6880235671997 4252.20000743866 33420.63903808594 564138905.6 48168960
31 2997.5040555000305 5787.007808685303 94579.23126220703 581813145.6 49774592
32 13239.295959472656 4991.680026054382 6864.330768585205 603091865.6 51380224
33 2996.2239265441895 4660.351912180583 125116.43727620445 621462425.6 52985856
34 3090.431928634644 4682.687997817993 28623.647689819336 639071129.6 54591488
35 3073.7919807434077 4932.586669921875 15493.855953216551 660698009.6 56197120
36 11198.464393615723 4983.704090118408 128828.38821411133 677720985.6 57802752
37 3124.565283457438 4996.767997741698 16547.935485839844 696447897.6 59408384
38 3163.9040112495427 5183.647990226746 16195.87230682373 712127385.6 61014016
39 3279.5306046803794 5573.8773345947275 109834.99908447266 733160345.6 62619648
40 3297.6214090983076 13283.583641052246 83190.3076171875 752972697.6 64225280
41 3264.512062072754 5686.11204624176 172608.00170898438 770823065.6 65830912
42 3324.4159817695613 5704.663991928101 95694.88016764323 786666393.6 67436544
43 3233.7919871012373 5815.328001976013 108786.46087646484 806642585.6 69042176
44 3356.6720485687256 5868.328094482422 164339.17744954425 826569625.6 70647808
45 15335.424423217773 11576.799869537354 147364.92919921875 843256729.6 72253440
46 3256.6614151000977 6184.800028800964 123368.84307861328 861197209.6 73859072
47 7932.415962219238 6234.442710876465 23663.711547851562 880624537.6 75464704
pre-alr mem 458240
All reduce times
32 [0.0, 41495.91827392578, 50330.03234863281, 62953.43017578125, 58574.08905029297, 51340.58380126953, 77082.90100097656, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 730.5145263671875, 1173.7877130508423, 1353.144645690918, 1874.9078512191772, 2139.5022869110107, 2587.420701980591, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 1084.3276977539062, 1589.6161794662476, 2002.7358531951904, 2686.0716342926025, 2933.0122470855713, 3260.885000228882, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 2967.238426208496, 4118.363380432129, 5012.969017028809, 6158.940315246582, 6564.140319824219, 7401.375770568848, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 22296.031951904297, 30873.565673828125, 33199.310302734375, 38945.6901550293, 39667.26303100586, 41642.83752441406, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 99849.15161132812, 144229.40063476562, 170375.9307861328, 189126.7852783203, 191303.84826660156, 195635.6201171875, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
