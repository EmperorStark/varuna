Parent process ID: 7539 node: 172.31.27.216
16 per stage
32 servers!
Config:
ranks: range(3, 4)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=3 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 3
USED MODULES
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
3 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 64.0
1 2156.5440495808916 3538.048028945923 573.7151920795441 21175500.8 1605632
2 1930.240035057068 3683.887958526612 812.1066689491273 39020134.4 3211264
3 1965.0559425354002 4685.344219207764 1052.9440045356748 57284198.4 4816896
4 2264.0640139579777 3820.10406255722 1263.888031244278 75594137.6 6422528
5 5773.3118534088135 3905.2267074584956 2076.7040252685547 95293030.4 8028160
6 1955.8399915695188 3233.943998813629 10486.36786142985 112174694.4 9633792
7 1982.4640154838562 3694.6667035420733 1825.2053260803223 132540006.4 11239424
8 2142.4639821052556 4477.4720668792725 1978.218634923299 149866086.4 12845056
9 2096.1279869079585 4422.559976577759 1992.3306306203208 168474214.4 14450688
10 1988.3520007133484 3722.400029500325 2212.3999595642094 185882214.4 16056320
11 2137.600004673004 3163.320004940033 2413.74929745992 204709478.4 17661952
12 1956.352025270462 4085.6320858001714 4594.944000244141 221988454.4 19267584
13 2109.0986728668213 11292.960166931152 4543.712139129639 240907878.4 20873216
14 2469.546635945638 3528.064012527466 3553.4826119740806 259958374.4 22478848
15 18204.67185974121 3392.799973487854 3103.946685791015 277681766.4 24084480
16 2106.368064880371 3623.520056406657 3703.6479711532593 298092134.4 25690112
17 8757.247924804688 6870.368003845215 5679.200172424316 313407078.4 27295744
18 2276.608049869538 4073.1520652770996 4430.208047231039 335804006.4 28901376
19 2437.8027121225996 3475.9919643402104 5474.143981933594 349804134.4 30507008
20 2283.519983291626 4109.72797870636 4243.573506673177 372516454.4 32112640
21 2494.208037853241 3639.3759846687317 5861.555290222168 386201190.4 33718272
22 2477.824032306671 3840.6160473823547 6157.919883728028 407250534.4 35323904
23 13048.831939697266 8482.5279712677 5205.567995707194 423429734.4 36929536
24 2521.0880041122437 6866.24002456665 5848.2558727264395 442730086.4 38535168
25 3044.3520545959473 5720.448017120361 6470.325311024983 460113510.4 40140800
26 2283.520062764486 3429.0559887886047 6082.808017730713 479225446.4 41746432
27 2988.032102584839 7463.615894317627 5793.016076087952 496141926.4 43352064
28 3356.6720485687256 6489.743947982789 6593.648076057434 514672230.4 44957696
29 2397.6959586143494 8749.024391174316 5841.162681579589 532215398.4 46563328
30 13150.720119476318 3806.9226741790776 7084.842681884765 552035942.4 48168960
31 7396.3518142700195 4085.9519243240347 6533.776044845582 569308774.4 49774592
32 2980.8640480041504 4006.0159365336094 7446.3759660720825 590186086.4 51380224
33 2442.4960017204285 4327.871799468994 8094.282786051432 608155238.4 52985856
34 2834.9440097808833 4375.648021697998 17824.86343383789 625362534.4 54591488
35 2557.6106707255044 11559.871673583984 119583.8851928711 646588006.4 56197120
36 2585.3439569473267 4351.434707641602 91206.27212524414 663209574.4 57802752
37 2634.2400312423706 7471.711874008179 96927.93273925781 681535078.4 59408384
38 2798.5920906066895 4616.392016410828 87221.91619873047 696813158.4 61014016
39 2852.181275685628 6323.552131652832 76604.57611083984 717444710.4 62619648
40 2703.7013371785483 11267.647743225098 148047.26409912112 736134758.4 64225280
41 2714.624007542928 4954.8373222351065 112701.8025716146 753985126.4 65830912
42 2607.445319493612 4943.360010782878 115493.1983947754 769746534.4 67436544
43 2860.2879643440247 5228.4692128499355 116615.54209391277 789321318.4 69042176
44 2641.1520242691035 5254.536151885986 134315.92305501303 808846950.4 70647808
45 2961.749315261841 5310.005187988281 137679.65189615884 825132646.4 72253440
46 2927.616039911906 18305.44090270996 184208.43505859375 842671718.4 73859072
47 3119.104027748108 5813.525358835856 132585.54077148438 861697638.4 75464704
pre-alr mem 429056
All reduce times
32 [0.0, 62953.43017578125, 58574.08905029297, 51340.58380126953, 77082.90100097656, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 1353.144645690918, 1874.9078512191772, 2139.5022869110107, 2587.420701980591, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 2002.7358531951904, 2686.0716342926025, 2933.0122470855713, 3260.885000228882, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 5012.969017028809, 6158.940315246582, 6564.140319824219, 7401.375770568848, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 33199.310302734375, 38945.6901550293, 39667.26303100586, 41642.83752441406, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 170375.9307861328, 189126.7852783203, 191303.84826660156, 195635.6201171875, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
