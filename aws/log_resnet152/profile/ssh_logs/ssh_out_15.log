Parent process ID: 8008 node: 172.31.21.109
16 per stage
32 servers!
Config:
ranks: range(15, 16)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=15 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 15
USED MODULES
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
15 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3476.480007171631 5558.880011240642 246.5984016656876 44759347.2 401408
2 2853.205362955729 8876.864433288574 307.5039982795716 51751219.2 802816
3 2848.0853239695234 4001.3440251350403 397.71519899368286 53404364.8 1204224
4 6168.576002120972 5748.9999532699585 470.8159938454628 57765785.6 1605632
5 21787.647247314453 6046.976089477539 519.6800157427789 62352076.8 2007040
6 3694.933334986369 9073.792457580566 567.4719959497452 66519756.8 2408448
7 3710.4640007019043 7557.119846343994 700.5120068788527 72710860.8 2809856
8 3821.056008338928 5780.981222788493 694.7968006134033 78763520.0 3211264
9 8368.639945983885 5594.855904579162 784.7840040922165 84720742.4 3612672
10 3660.45864423116 5766.095995903015 962.5920057296754 91426713.6 4014080
11 6796.800136566161 7911.9893709818525 831.8159878253936 97633792.0 4415488
12 5989.376068115234 5847.114562988281 3568.4800148010254 104219340.8 4816896
13 8361.984252929688 6017.685254414876 1195.4399943351746 110985113.6 5218304
14 7248.38399887085 6160.554726918539 1098.3039736747742 115547238.4 5619712
15 3708.6719274520874 5286.903977394104 1068.9759850502014 122689843.2 6021120
16 4716.544151306152 9304.672241210938 1281.3760042190552 130007654.4 6422528
17 3580.586671829223 5572.575887044271 1525.8879661560059 136365772.8 6823936
18 3725.653330485026 8169.440031051635 1171.5839703877766 140988313.6 7225344
19 3609.941323598226 5908.528089523315 1220.0533548990884 147965440.0 7626752
20 3629.3973128000894 6920.6719398498535 1570.8800554275513 155809280.0 8028160
21 3785.9840393066406 5726.965268452962 1924.3733088175456 158878003.2 8429568
22 11053.05576324463 6114.04816309611 14797.183990478517 165547929.6 8830976
23 3895.9786891937256 8540.703773498535 6765.696048736572 173900492.8 9232384
24 4167.4240827560425 8746.111869812012 1821.3226397832234 179249868.8 9633792
25 4008.192002773285 5259.786605834961 1685.0026448567708 188873216.0 10035200
26 3983.701229095459 5885.3759765625 1791.0720109939575 191194009.6 10436608
27 7811.583995819092 5792.407989501953 1572.486424446106 197736755.2 10838016
28 4113.408009211222 5472.842693328857 1660.2240006128945 205501952.0 11239424
29 7292.928218841553 5764.575958251953 1704.7599852085116 210357350.4 11640832
30 4113.919973373413 5740.256150563558 2144.245386123657 215479808.0 12042240
31 10447.360038757322 7070.240020751953 2073.386669158935 222055526.4 12443648
32 3666.1760807037354 5624.704043070476 2070.543944835663 229529088.0 12845056
33 6778.8801193237305 6306.096076965332 2267.1360969543457 236736409.6 13246464
34 7591.936111450195 5770.9200382232675 2277.9093583424888 242452787.2 13647872
35 15141.887664794922 22645.21598815918 28755.359649658203 247175475.2 14049280
36 12215.295791625977 6723.1680154800415 1972.106655438741 253970739.2 14450688
37 18480.640411376953 5894.872069358825 2829.909324645996 259148083.2 14852096
38 3898.8800048828125 8796.51165008545 2300.4560470581055 267618611.2 15253504
39 18294.272422790524 5523.743947347005 2223.9893277486162 272067276.8 15654912
40 4038.6559963226323 6033.727884292602 3154.9439430236816 280221184.0 16056320
41 4017.1520113945003 6406.736135482788 4946.335792541504 287072972.8 16457728
42 8796.159744262695 7024.735927581787 4334.752082824707 289466675.2 16859136
43 24724.99179840088 5923.743883768718 39236.385345458984 295688499.2 17260544
44 13400.064468383789 6080.936074256897 2372.864055633545 304292556.8 17661952
45 15205.376148223877 5641.136050224303 21648.176193237305 308300083.2 18063360
46 3618.816057840983 5671.887993812561 2741.27999941508 317643059.2 18464768
47 6728.70397567749 6534.38401222229 2523.856043815613 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
