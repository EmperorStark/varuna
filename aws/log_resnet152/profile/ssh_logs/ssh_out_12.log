Parent process ID: 6645 node: 172.31.17.44
16 per stage
32 servers!
Config:
ranks: range(12, 13)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=12 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 12
USED MODULES
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
12 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 4079.1041254997253 5569.478511810303 292.7199974656105 44759347.2 401408
2 4153.856039047241 6172.0640659332275 336.3647997379303 51751219.2 802816
3 4149.248123168945 6106.304168701172 357.32267300287884 53404364.8 1204224
4 3921.9199419021606 6916.959762573242 533.1520065665245 57765785.6 1605632
5 8218.624114990233 6178.056001663208 738.7840151786804 62352076.8 2007040
6 4325.37603378296 4440.320014953613 673.0239788691204 66519756.8 2408448
7 9037.823677062988 10990.943908691406 706.9120009740194 72710860.8 2809856
8 9209.856033325195 8452.92806625366 846.6559946537018 78763520.0 3211264
9 4090.538660685221 6354.151964187623 783.2159996032716 84720742.4 3612672
10 4119.296014308929 9568.592071533203 871.5440034866333 91426713.6 4014080
11 10361.855983734133 15786.128520965576 875.5648016929625 97633792.0 4415488
12 19202.55947113037 7485.487937927245 939.903994401296 104219340.8 4816896
13 6598.656177520752 6050.506750742595 994.0608024597169 110985113.6 5218304
14 9580.544471740723 6276.695966720581 982.7306866645813 115547238.4 5619712
15 4143.872022628785 5883.128046989442 1187.1199905872345 122689843.2 6021120
16 3774.805307388305 7233.61611366272 1302.7733167012532 130007654.4 6422528
17 4874.239921569824 6347.455978393555 1198.5040307044983 136365772.8 6823936
18 10159.103870391846 6414.704084396361 1529.8559665679932 140988313.6 7225344
19 12336.639881134033 8470.111846923828 9458.623886108398 147965440.0 7626752
20 7419.9042320251465 6799.466609954834 1573.8240480422974 155809280.0 8028160
21 31267.32730865478 5787.029266357421 1366.8053150177004 158878003.2 8429568
22 14690.303802490234 7492.991924285889 1544.0640151500702 165547929.6 8830976
23 4155.392169952393 6663.936138153076 6348.031997680664 173900492.8 9232384
24 4442.111968994141 6489.535808563232 1660.9119772911072 179249868.8 9633792
25 11498.496055603027 9733.280181884766 2047.8720664978025 188873216.0 10035200
26 4059.135913848877 6961.728096008302 2426.111936569214 191194009.6 10436608
27 11673.600196838379 6580.880165100098 2045.408010482788 197736755.2 10838016
28 13765.631675720215 6132.170677185059 1737.3679876327515 205501952.0 11239424
29 5389.311790466309 8906.559944152832 1791.6640043258667 210357350.4 11640832
30 8228.863716125488 8342.559814453125 2332.7680230140686 215479808.0 12042240
31 17220.60775756836 7959.599971771241 1934.9279999732971 222055526.4 12443648
32 3918.5067017873125 8243.903875350952 2211.0656261444087 229529088.0 12845056
33 15028.223991394043 6553.589344024659 2184.8320364952087 236736409.6 13246464
34 11188.735961914062 6498.432000478109 2330.6400179862976 242452787.2 13647872
35 9402.36759185791 7049.784064292908 2174.762725830078 247175475.2 14049280
36 16074.752807617186 15701.375484466555 2230.08793592453 253970739.2 14450688
37 4225.706656773886 6471.01604938507 2474.7711658477783 259148083.2 14852096
38 7046.144008636475 6251.957257588705 2847.4879264831543 267618611.2 15253504
39 4057.770729064942 5867.061297098796 2246.784031391144 272067276.8 15654912
40 4235.9466552734375 6354.999899864197 2478.9567947387695 280221184.0 16056320
41 18380.800247192383 6254.783987998962 4682.080030441285 287072972.8 16457728
42 13690.880139668785 6433.824062347412 3536.736011505127 289466675.2 16859136
43 12187.135696411131 7237.519979476929 3146.048069000244 295688499.2 17260544
44 18478.59287261963 6359.936078389486 2775.4133542378745 304292556.8 17661952
45 9730.048179626465 6422.823905944824 2674.773375193278 308300083.2 18063360
46 12560.383796691895 6775.040030479431 2788.703997929891 317643059.2 18464768
47 3786.7519855499263 6257.08794593811 2886.3440155982967 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
