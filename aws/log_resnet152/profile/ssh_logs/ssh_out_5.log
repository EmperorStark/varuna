Parent process ID: 7491 node: 172.31.30.99
16 per stage
32 servers!
Config:
ranks: range(5, 6)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=5 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 5
USED MODULES
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
1 2198.527932167053 3223.637342453003 435.87199449539185 13273907.2 802816
2 2033.9199602603915 3021.205345789592 567.3813422520956 23155097.6 1605632
3 3906.559944152832 3149.944007396698 646.696001291275 32588185.6 2408448
4 2003.28532854716 3022.026618321737 1028.9386510849 42021273.6 3211264
5 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 64.0
5 2078.9759755134583 3742.9040074348454 757.0773363113403 52135219.2 4014080
6 2040.4906272888184 3775.65860748291 1194.1919922828674 60887449.6 4816896
7 5936.640024185181 5634.943962097168 1165.3013229370117 70320537.6 5619712
8 2078.7200331687927 3924.0319728851314 1155.5626789728801 79753625.6 6422528
9 2066.6880309581757 5386.079788208008 1314.314643541972 90257817.6 7225344
10 2247.1679449081425 3822.464108467102 10250.207901000977 99160473.6 8028160
11 2207.7440023422237 3372.479995091757 1823.087990283966 108052889.6 8830976
12 2473.9840030670166 3345.416009426117 1991.8400049209595 118026649.6 9633792
13 9746.432304382324 3766.287982463837 1588.8533194859822 127312281.6 10436608
14 2346.6667334238687 9774.703979492188 2099.712014198303 138121625.6 11239424
15 1983.1467072168982 3759.562730789185 2758.3199739456177 146866585.6 12042240
16 2094.5920348167415 3581.0640454292297 16457.87239074707 155218329.6 12845056
17 2094.0800507863364 6289.696216583252 2489.3759489059444 166824345.6 13647872
18 2054.1439851125083 5863.071918487549 2154.23995256424 175690137.6 14450688
19 2560.5119466781616 4802.058696746825 2598.9599823951717 186368409.6 15253504
20 7019.519805908203 4497.663974761963 2332.480013370514 194392473.6 16056320
21 2073.0879902839665 6167.712211608887 4674.816131591797 202383769.6 16859136
22 2067.2000348567963 3854.4960021972656 2706.015984217326 212799897.6 17661952
23 2046.7200279235842 3827.487945556641 2566.0906632741294 225581465.6 18464768
24 2100.480020046234 4139.072020848592 2753.237326939901 231453081.6 19267584
25 2000.1280307769775 3860.9679937362666 3043.193578720093 244660633.6 20070400
26 5630.97620010376 3581.5146764119468 3115.504026412964 250630553.6 20873216
27 2187.5199675559998 3583.159983158111 3654.927968978882 261046681.6 21676032
28 13010.94404856364 4017.802635828654 3165.615975856781 270184857.6 22478848
29 9028.608322143555 5443.808078765869 3759.775996208191 278790553.6 23281664
30 2200.32000541687 3657.2479605674744 3525.536000728607 288018841.6 24084480
31 2159.1039896011353 3979.8932075500493 3646.4319825172424 299360665.6 24887296
32 2144.512057304382 6144.959926605225 3622.111976146698 309293465.6 25690112
33 2276.8640518188477 3331.242640813192 3990.5599594116215 317890969.6 26492928
34 2692.0959154764814 7729.568004608154 5220.320224761963 326545817.6 27295744
35 2232.8319549560547 4267.4560546875 3955.5626710255947 336355737.6 28098560
36 2238.1227016448975 4153.258641560873 4081.9733937581373 348238233.6 28901376
37 11406.335830688477 3798.4213829040523 5317.311763763428 354103705.6 29704192
38 2229.589303334554 3921.9733874003095 5239.253362019857 365785497.6 30507008
39 2208.7680498758955 3590.8053716023765 4467.328071594238 373506457.6 31309824
40 2253.5680532455444 3641.0773595174155 4392.576098442078 383971737.6 32112640
41 10726.400375366211 3364.8959795633955 4839.500808715819 393441689.6 32915456
42 2274.645328521729 3664.208054542542 5207.0506413777675 400478617.6 33718272
43 10895.359992980957 4014.0639543533325 4631.464123725891 410403225.6 34521088
44 2315.2639865875244 3495.7333405812583 4891.520023345947 423063961.6 35323904
45 2381.141265233358 3903.7333329518633 4890.384078025818 428945817.6 36126720
46 2337.535977363587 3375.221331914266 5487.91036605835 440668569.6 36929536
47 11909.119606018066 4115.520000457764 5111.32800579071 447791513.6 37732352
pre-alr mem 1686528
All reduce times
32 [0.0, 51340.58380126953, 77082.90100097656, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2139.5022869110107, 2587.420701980591, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 2933.0122470855713, 3260.885000228882, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 6564.140319824219, 7401.375770568848, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 39667.26303100586, 41642.83752441406, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 191303.84826660156, 195635.6201171875, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
