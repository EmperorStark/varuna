Parent process ID: 7386 node: 172.31.23.137
16 per stage
32 servers!
Config:
ranks: range(20, 21)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=20 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 20
USED MODULES
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
20 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 16.0
1 4088.832020759582 4821.311950683594 236.76800231138867 44759347.2 401408
2 2844.3306287129717 8571.584065755209 314.5999908447265 51751219.2 802816
3 3866.624116897583 5531.408071517944 406.68799728155136 53404364.8 1204224
4 7031.807899475098 6158.447980880737 488.1855905056 57765785.6 1605632
5 9139.541308085123 6713.482697804769 579.1039864222208 62352076.8 2007040
6 3848.8747278849287 6282.2825113932295 654.2800068855286 66519756.8 2408448
7 3721.5573787689204 8252.927780151367 758.4533294041953 72710860.8 2809856
8 4348.416090011596 5972.6613362630205 745.4463958740234 78763520.0 3211264
9 3920.896053314209 7705.008029937744 814.2400085926055 84720742.4 3612672
10 3994.965235392253 6839.759945869446 828.3007979393005 91426713.6 4014080
11 8769.536018371582 8398.367881774902 921.0800230503082 97633792.0 4415488
12 4193.536043167115 6324.583888053894 943.6416149139405 104219340.8 4816896
13 9779.199600219727 8161.151885986328 1110.7679605484007 110985113.6 5218304
14 17148.927688598633 7227.0933787028 6514.784097671509 115547238.4 5619712
15 7975.935935974121 6245.7759380340585 1077.1600008010864 122689843.2 6021120
16 3915.264010429383 6740.6721115112305 1460.2240324020386 130007654.4 6422528
17 4129.791895548503 7005.311965942383 1199.338674545288 136365772.8 6823936
18 4329.983949661255 6217.5893783569345 1498.047947883606 140988313.6 7225344
19 10849.792003631592 5925.418694814046 1301.8079996109009 147965440.0 7626752
20 4002.133369445801 6123.039960861206 1395.9146738052368 155809280.0 8028160
21 3852.7999520301823 6055.19998073578 1347.6639688014984 158878003.2 8429568
22 4256.767908732096 6603.432059288025 2286.9439125061035 165547929.6 8830976
23 4101.375937461853 6244.928002357483 1511.1759901046753 173900492.8 9232384
24 4082.0053418477373 6688.408017158508 1558.568000793457 179249868.8 9633792
25 4160.51204999288 6294.352054595948 4165.215969085693 188873216.0 10035200
26 8431.615829467773 7611.605326334636 1658.9013735453289 191194009.6 10436608
27 4385.450681050618 6300.680041313171 1853.875207901001 197736755.2 10838016
28 4201.98392868042 9930.432319641113 1744.3733612696328 205501952.0 11239424
29 4334.933280944824 6444.560050964356 1725.9947061538696 210357350.4 11640832
30 15196.671962738037 9271.072387695312 1781.7760109901428 215479808.0 12042240
31 15583.231925964355 9291.415929794312 2139.9466196695967 222055526.4 12443648
32 12827.135562896729 5815.2639865875235 1887.1039946873984 229529088.0 12845056
33 3700.4799246788025 6447.351932525635 1995.283222198486 236736409.6 13246464
34 12425.215721130371 6470.232009887695 1961.9280099868777 242452787.2 13647872
35 3967.231988906861 10843.8720703125 2060.8799457550044 247175475.2 14049280
36 8726.52816772461 6238.4480237960815 2045.674641927083 253970739.2 14450688
37 17725.439071655273 6348.28794002533 3666.5279865264893 259148083.2 14852096
38 4101.119836171469 6631.184101104735 2333.3120346069336 267618611.2 15253504
39 13308.9280128479 5916.277249654135 2796.288013458252 272067276.8 15654912
40 13750.783920288086 5926.560044288635 2252.2773742675777 280221184.0 16056320
41 4191.573301951091 6378.581364949544 2318.6079859733586 287072972.8 16457728
42 3974.1439819335938 6143.815875053406 2425.0239531199136 289466675.2 16859136
43 9271.296024322512 6027.024030685426 2850.5493005116787 295688499.2 17260544
44 4275.541305541992 6690.144062042236 2647.1280455589294 304292556.8 17661952
45 7927.807807922363 6710.079987843832 3525.1306692759194 308300083.2 18063360
46 3738.6240164438886 6027.239918708801 2603.015959262848 317643059.2 18464768
47 3947.861353556316 6572.832107543945 3109.375953674317 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
