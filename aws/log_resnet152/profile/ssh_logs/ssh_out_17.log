Parent process ID: 6091 node: 172.31.21.254
16 per stage
32 servers!
Config:
ranks: range(17, 18)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=17 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 17
USED MODULES
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
17 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 16.0
1 2961.9199633598323 4826.730728149413 233.41867327690125 44759347.2 401408
2 3284.9919795989995 4689.688086509705 312.768004834652 51751219.2 802816
3 3609.0880632400513 9965.439796447754 435.7866744200388 53404364.8 1204224
4 5281.792163848877 6436.511993408203 462.1279910206795 57765785.6 1605632
5 4529.151916503906 5334.133307139079 494.570662577947 62352076.8 2007040
6 8828.927993774414 5833.975911140442 602.6666760444642 66519756.8 2408448
7 5450.751781463623 5865.216016769409 647.0080018043518 72710860.8 2809856
8 4963.327884674072 5720.55196762085 2014.2080783843992 78763520.0 3211264
9 5980.1599979400635 5987.46665318807 780.3413271903993 84720742.4 3612672
10 3570.688009262085 5684.864163398743 820.8960145711899 91426713.6 4014080
11 11638.784408569336 6104.085286458334 894.4213390350342 97633792.0 4415488
12 8265.727996826172 13226.271629333496 914.1056060791017 104219340.8 4816896
13 10379.776000976562 7496.239900588989 949.2266575495402 110985113.6 5218304
14 8573.440074920654 6211.434682210286 6606.400012969971 115547238.4 5619712
15 3580.586671829224 5428.864002227783 1336.7040157318115 122689843.2 6021120
16 3532.7999591827393 5450.416088104248 1210.247993469238 130007654.4 6422528
17 3808.2560300827026 5674.383997917176 1285.423994064331 136365772.8 6823936
18 4218.111991882324 5185.674667358398 1485.0240349769592 140988313.6 7225344
19 9358.336448669434 6909.375985463461 26828.895568847656 147965440.0 7626752
20 3625.984013080597 5867.400050163269 1311.3200068473816 155809280.0 8028160
21 10291.199684143066 5690.703988075256 1381.173332532247 158878003.2 8429568
22 7753.727912902832 5707.690715789794 9748.970667521158 165547929.6 8830976
23 8950.783729553224 6924.448013305664 14397.248268127441 173900492.8 9232384
24 3895.295937856038 5504.511992136637 10282.560348510742 179249868.8 9633792
25 11493.375778198242 6919.1999435424805 1914.6026770273843 188873216.0 10035200
26 4308.30939610799 6986.080010732015 2033.6720049381256 191194009.6 10436608
27 8219.648361206055 6138.08000087738 1569.9903964996338 197736755.2 10838016
28 11566.080093383789 7005.45597076416 1632.3946317036944 205501952.0 11239424
29 3846.144040425618 5935.6266657511405 1686.6559684276579 210357350.4 11640832
30 13031.423568725586 7068.28784942627 1783.9759886264799 215479808.0 12042240
31 3823.6160278320317 6276.232004165649 2109.066645304362 222055526.4 12443648
32 6700.0322341918945 7383.519887924194 1817.255973815918 229529088.0 12845056
33 12110.848426818848 5802.346706390381 1898.5599994659422 236736409.6 13246464
34 10053.631782531738 5628.767967224121 2654.46400642395 242452787.2 13647872
35 3880.277315775553 5652.874628702801 13031.392097473145 247175475.2 14049280
36 4315.818627675373 6188.103914260864 2547.146638234456 253970739.2 14450688
37 3820.2026685078945 5783.608078956604 2267.319977283478 259148083.2 14852096
38 4955.135822296143 5464.362621307373 2692.352056503296 267618611.2 15253504
39 4080.6400775909433 6731.6586176554365 2675.384044647217 272067276.8 15654912
40 10047.48821258545 5802.255868911744 2278.2463550567627 280221184.0 16056320
41 8722.432136535645 6068.111896514893 2633.9199542999268 287072972.8 16457728
42 3896.6613610585523 5851.733366648356 2297.7199554443364 289466675.2 16859136
43 4023.808002471924 5555.287957191466 32497.40982055664 295688499.2 17260544
44 7017.471790313721 6256.416161855062 2851.9296646118164 304292556.8 17661952
45 7810.0481033325195 8646.75235748291 3854.640007019043 308300083.2 18063360
46 7041.024208068848 6155.375957489014 10788.000106811523 317643059.2 18464768
47 3588.096062342326 5414.186636606852 2506.0053666432696 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
