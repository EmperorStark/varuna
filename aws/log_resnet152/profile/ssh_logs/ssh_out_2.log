Parent process ID: 7606 node: 172.31.18.152
16 per stage
32 servers!
Config:
ranks: range(2, 3)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=2 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 2
USED MODULES
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
2 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 64.0
1 2398.7200856208797 3957.504034042358 528.5120010375977 21175500.8 1605632
2 1896.7893520991008 4092.159986495971 670.2160090208054 39020134.4 3211264
3 2072.5759863853455 3716.3840134938555 2067.647933959961 57284198.4 4816896
4 2410.4959368705754 7834.928035736084 1528.2400250434875 75594137.6 6422528
5 2102.272003889084 4599.008083343506 9668.895721435547 95293030.4 8028160
6 2164.394696553548 9910.847663879395 21732.255935668945 112174694.4 9633792
7 1996.8000253041585 3717.24796295166 2215.4879570007324 132540006.4 11239424
8 2153.7279784679413 4561.823844909668 2197.1200307210283 149866086.4 12845056
9 16167.936325073244 5687.071800231934 15533.21647644043 168474214.4 14450688
10 2032.6399803161617 3986.8692557017007 3013.6640071868896 185882214.4 16056320
11 7582.719802856445 3226.304054260254 25963.327407836914 204709478.4 17661952
12 2087.4240100383754 4239.488124847412 3691.3280487060547 221988454.4 19267584
13 2417.9200530052185 4619.6160316467285 6393.184185028076 240907878.4 20873216
14 2231.2960624694824 4161.4400545756025 4390.832185745239 259958374.4 22478848
15 2056.5333366394043 3760.3280544281 4248.496055603026 277681766.4 24084480
16 2303.658644358317 3693.7386989593506 12359.519958496094 298092134.4 25690112
17 2490.6240105628967 4994.463920593262 23492.895126342773 313407078.4 27295744
18 10928.128242492676 3871.6479937235517 4258.5601806640625 335804006.4 28901376
19 2373.2906182607016 4290.41600227356 26091.74346923828 349804134.4 30507008
20 10718.208312988281 4782.384157180786 56760.36834716797 372516454.4 32112640
21 2486.2719774246216 3375.4480481147766 5744.319915771484 386201190.4 33718272
22 2454.528033733368 4114.453315734863 5659.8238945007315 407250534.4 35323904
23 2644.3093617757163 3328.746716181437 5980.29867808024 423429734.4 36929536
24 2469.12008523941 3570.160031318665 6691.850662231445 442730086.4 38535168
25 2375.1680254936214 3543.0400371551514 6068.9598719278965 460113510.4 40140800
26 11560.448169708252 9866.928100585938 5728.857517242433 479225446.4 41746432
27 2526.8906752268476 3760.927975177765 7130.032062530518 496141926.4 43352064
28 2324.992060661316 3518.2400345802307 7425.685405731201 514672230.4 44957696
29 2563.072025775909 5557.248115539551 6833.43207836151 532215398.4 46563328
30 2515.4560208320618 3892.4160003662105 6509.205341339111 552035942.4 48168960
31 2464.426676432291 3874.72003698349 6866.540718078613 569308774.4 49774592
32 2607.360005378723 4089.9520516395573 8127.135872840881 590186086.4 51380224
33 2608.128011226654 4393.386522928874 7604.80797290802 608155238.4 52985856
34 2600.2773443857827 4158.351957798004 7071.712017059326 625362534.4 54591488
35 2928.128004074096 4260.725498199464 8482.272148132324 646588006.4 56197120
36 2696.1919466654463 4400.495886802673 9242.223978042603 663209574.4 57802752
37 2609.920024871826 4481.194655100505 8810.250918070475 681535078.4 59408384
38 2713.599920272827 18876.437505086265 9557.045618693035 696813158.4 61014016
39 2595.5839753150935 4686.087965965272 9611.040115356443 717444710.4 62619648
40 2711.8079662323 6689.359903335571 18593.568801879883 736134758.4 64225280
41 3421.1840629577637 19812.576293945312 9493.631680806478 753985126.4 65830912
42 2837.2479677200313 5036.3413492838545 9083.584308624268 769746534.4 67436544
43 3152.384042739868 5122.80527750651 11605.504035949705 789321318.4 69042176
44 3630.079984664917 5174.794673919678 14804.63981628418 808846950.4 70647808
45 2870.9546724955244 5384.927908579508 12495.765686035156 825132646.4 72253440
46 2810.5386098225913 5440.592050552369 19202.272415161133 842671718.4 73859072
47 3818.495988845825 5550.4746437072745 23564.992904663086 861697638.4 75464704
pre-alr mem 429056
All reduce times
32 [0.0, 50330.03234863281, 62953.43017578125, 58574.08905029297, 51340.58380126953, 77082.90100097656, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 1173.7877130508423, 1353.144645690918, 1874.9078512191772, 2139.5022869110107, 2587.420701980591, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 1589.6161794662476, 2002.7358531951904, 2686.0716342926025, 2933.0122470855713, 3260.885000228882, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 4118.363380432129, 5012.969017028809, 6158.940315246582, 6564.140319824219, 7401.375770568848, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 30873.565673828125, 33199.310302734375, 38945.6901550293, 39667.26303100586, 41642.83752441406, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 144229.40063476562, 170375.9307861328, 189126.7852783203, 191303.84826660156, 195635.6201171875, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
