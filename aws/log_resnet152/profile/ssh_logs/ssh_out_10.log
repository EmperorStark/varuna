Parent process ID: 8999 node: 172.31.31.40
16 per stage
32 servers!
Config:
ranks: range(10, 11)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=10 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 10
USED MODULES
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
10 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
1 3932.1601390838623 3294.6987152099605 350.58132807413733 13273907.2 802816
2 2283.178647359212 4144.661267598471 558.6048126220703 23155097.6 1605632
3 1968.4693415959678 3369.674603144328 691.3439929485321 32588185.6 2408448
4 3413.5040044784546 3736.7359797159834 670.6560105085373 42021273.6 3211264
5 2058.495998382568 3568.7999725341792 1154.3359756469727 52583321.6 4014080
6 2118.655999501546 3693.295955657959 897.5439965724945 60887449.6 4816896
7 8766.464233398438 4332.256078720093 1011.5413069725035 70320537.6 5619712
8 2042.197306950887 3405.2239656448364 1065.5103921890259 79753625.6 6422528
9 2070.186694463094 5030.176162719727 1549.9135971069338 90257817.6 7225344
10 2062.8480315208435 3664.0800237655644 2165.855884552002 99160473.6 8028160
11 2058.5813522338867 4027.4026393890385 1436.4479780197144 108052889.6 8830976
12 2105.34397761027 3339.9893442789717 1497.8000223636627 118026649.6 9633792
13 14234.623908996582 6495.232105255127 1500.5919635295868 127312281.6 10436608
14 2105.087995529175 3551.2160062789917 1701.9626696904502 138121625.6 11239424
15 13857.791900634766 3276.9493261973066 2209.0559601783752 146866585.6 12042240
16 2028.5439888636272 3356.234629948934 2094.6719646453853 155218329.6 12845056
17 3750.9119510650635 7851.520061492919 2142.7093346913657 166824345.6 13647872
18 2077.354669570923 3915.167967478434 3724.7040271759033 175690137.6 14450688
19 5783.552169799805 3722.815990447998 3376.0321140289307 186368409.6 15253504
20 3946.49600982666 4728.672027587891 2586.9599580764775 194392473.6 16056320
21 2086.400032043457 3333.279967308044 3859.6479892730713 202383769.6 16859136
22 2042.3680543899536 3859.6960306167603 12607.328414916992 212799897.6 17661952
23 2030.0800204277039 5536.207914352417 2708.117405573527 225581465.6 18464768
24 2011.136015256246 3332.4587345123296 6972.944021224976 231453081.6 19267584
25 11769.855976104736 4094.383955001831 2838.2186094919834 244660633.6 20070400
26 2141.866683959961 4072.533289591471 3296.98395729065 250630553.6 20873216
27 2093.0560429890947 3544.3519751230874 25120.73516845703 261046681.6 21676032
28 2154.49595451355 4693.615913391112 5268.5441970825195 270184857.6 22478848
29 14493.696212768555 3834.1440359751386 3704.6294212341304 278790553.6 23281664
30 2197.5039839744563 4445.024013519287 3847.599983215332 288018841.6 24084480
31 2059.9466959635415 3753.647923469543 3084.479999542236 299360665.6 24887296
32 2215.167999267578 4814.688205718994 4756.736040115356 309293465.6 25690112
33 14009.344100952148 7028.991937637329 19815.616607666016 317890969.6 26492928
34 13745.152473449707 8000.175952911377 5972.383975982666 326545817.6 27295744
35 2242.8159713745117 3335.888028144837 5079.775810241699 336355737.6 28098560
36 2306.7305882771807 3644.906679789225 4523.050626118978 348238233.6 28901376
37 2240.768015384674 3982.5040102005005 4147.637367248535 354103705.6 29704192
38 2859.0080738067627 3713.205337524414 3919.6480512619023 365785497.6 30507008
39 2349.0560054779053 3806.165297826131 5127.4237632751465 373506457.6 31309824
40 2507.775942484538 4416.096210479736 5185.343980789185 383971737.6 32112640
41 7674.880027770996 3706.2079906463623 5885.759949684143 393441689.6 32915456
42 2291.200041770935 4077.199935913086 4803.496003150941 400478617.6 33718272
43 2315.264046192169 3688.6399586995444 7117.152214050293 410403225.6 34521088
44 4674.560070037842 3682.7039718627934 4584.128061930339 423063961.6 35323904
45 2426.8800417582192 4854.7680377960205 5194.201564788818 428945817.6 36126720
46 12369.408130645754 4077.8773625691733 10731.040000915527 440668569.6 36929536
47 2693.120002746582 4065.9039020538326 6210.079987843831 447791513.6 37732352
pre-alr mem 1686528
All reduce times
32 [0.0, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
