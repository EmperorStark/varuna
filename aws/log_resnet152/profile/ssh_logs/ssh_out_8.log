Parent process ID: 9105 node: 172.31.22.229
16 per stage
32 servers!
Config:
ranks: range(8, 9)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=8 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 8
USED MODULES
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
8 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
1 3385.3440284729004 3960.4906241099043 327.9919922351837 13273907.2 802816
2 2696.1920261383057 2825.6320158640547 570.4319924116136 23155097.6 1605632
3 2236.9279861450195 2945.813337961833 662.8720015287399 32588185.6 2408448
4 2107.904016971588 6631.840229034424 960.6826504071553 42021273.6 3211264
5 7719.935894012451 4502.655982971191 752.6879906654358 52583321.6 4014080
6 3050.4961013793945 4274.5600938797 844.6826934814453 60887449.6 4816896
7 2046.463996171951 4511.370499928793 1024.3999809026718 70320537.6 5619712
8 5501.952171325684 3323.5519528388977 9851.263999938965 79753625.6 6422528
9 1853.440006573995 3524.351954460144 1131.3120126724243 90257817.6 7225344
10 2679.8079013824463 3303.647994995117 1251.6266504923503 99160473.6 8028160
11 1893.7173287073772 3388.9706134796143 20567.77572631836 108052889.6 8830976
12 5155.839920043945 3330.6239446004233 1383.669336636861 118026649.6 9633792
13 9606.143951416016 7009.696006774903 1908.7572892506917 127312281.6 10436608
14 2250.7519721984863 3735.031962394715 2222.975969314575 138121625.6 11239424
15 2669.0560579299927 3554.256021976471 16963.199615478516 146866585.6 12042240
16 2122.7519114812217 3097.9839960734053 39541.11862182617 155218329.6 12845056
17 2184.1920018196106 3853.615880012512 2336.1918926239014 166824345.6 13647872
18 1949.013312657674 5187.551975250244 2902.448058128357 175690137.6 14450688
19 2306.3892920811973 5330.75189590454 2146.7947165171304 186368409.6 15253504
20 1945.0879991054537 3340.480009714762 2227.114677429199 194392473.6 16056320
21 2240.5120134353638 4263.701279958089 2318.22935740153 202383769.6 16859136
22 2313.215970993042 4451.776027679443 3250.159978866577 212799897.6 17661952
23 1989.9733066558842 3514.5599842071533 2836.6880416870117 225581465.6 18464768
24 2105.0880253314976 3725.0720262527466 3513.685305913289 231453081.6 19267584
25 1995.7760274410246 3892.8638696670537 3062.3199939727783 244660633.6 20070400
26 1978.6240160465243 3435.144007205963 2668.6800122261047 250630553.6 20873216
27 6201.344013214111 3310.5706373850503 2935.2512359619145 261046681.6 21676032
28 2013.866662979126 3850.6239652633667 3010.3600621223445 270184857.6 22478848
29 2465.2799367904663 4606.7678928375235 63857.486724853516 278790553.6 23281664
30 8027.647972106934 7189.919948577881 48611.968994140625 288018841.6 24084480
31 17147.903442382812 8952.128410339355 3809.424042701721 299360665.6 24887296
32 2184.191942214966 3481.322685877482 18597.856521606445 309293465.6 25690112
33 2179.4133186340337 3396.607995033264 3791.216015815735 317890969.6 26492928
34 2091.2640690803532 3185.482660929362 3742.015997568766 326545817.6 27295744
35 2263.2959485054016 3611.407995223999 4523.983955383301 336355737.6 28098560
36 2150.656044483185 3650.688052177429 3633.871972560883 348238233.6 28901376
37 2084.0960144996643 3558.911959330241 4406.944155693055 354103705.6 29704192
38 2186.752021312714 5050.943851470947 4366.31989479065 365785497.6 30507008
39 12950.528144836428 3685.9840154647827 4070.5727577209473 373506457.6 31309824
40 2180.8640360832214 3709.8560333251953 5184.915256500245 383971737.6 32112640
41 2245.290676752726 3637.333393096924 5383.347225189209 393441689.6 32915456
42 2218.239963054657 4244.607925415039 5562.9119873046875 400478617.6 33718272
43 2303.231954574585 3526.3119935989384 4420.096039772034 410403225.6 34521088
44 6648.831844329834 7759.26399230957 6023.535966873169 423063961.6 35323904
45 11250.175952911375 3926.7680048942566 4820.650736490885 428945817.6 36126720
46 2362.1119260787964 3486.90136273702 5357.529544830322 440668569.6 36929536
47 12353.535652160645 4039.87193107605 6100.096225738525 447791513.6 37732352
pre-alr mem 1686528
All reduce times
32 [0.0, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
