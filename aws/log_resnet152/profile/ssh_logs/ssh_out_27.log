Parent process ID: 4644 node: 172.31.29.147
16 per stage
32 servers!
Config:
ranks: range(27, 28)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=27 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 27
USED MODULES
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
27 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 2722.815990447998 6932.640075683594 273.5520005226136 44759347.2 401408
2 3017.7279710769653 5682.261308034262 319.6160018444061 51751219.2 802816
3 3730.4320335388184 6248.415946960449 417.19679832458496 53404364.8 1204224
4 3873.791933059692 11408.127784729004 514.2143905162811 57765785.6 1605632
5 3960.8321189880376 9500.624179840086 533.4656000137329 62352076.8 2007040
6 12262.911796569826 5911.615967750549 621.939206123352 66519756.8 2408448
7 5968.89591217041 5983.304023742676 650.4079997539519 72710860.8 2809856
8 3806.208074092865 7581.674575805664 723.8399982452393 78763520.0 3211264
9 14276.60846710205 5738.250732421876 776.0640084743501 84720742.4 3612672
10 3842.048009236654 6049.07989501953 1020.0746854146321 91426713.6 4014080
11 4023.978630701701 5844.9201583862305 874.7919946908951 97633792.0 4415488
12 7226.367950439453 5968.191941579183 900.2346595128377 104219340.8 4816896
13 6591.487884521484 9452.41641998291 990.5344009399415 110985113.6 5218304
14 15796.565691630047 10372.239589691162 1215.5840396881104 115547238.4 5619712
15 3778.560002644857 5871.895909309386 1232.053319613139 122689843.2 6021120
16 3785.386562347412 6273.055911064147 1202.424019575119 130007654.4 6422528
17 8324.095726013184 6789.168119430542 10161.343574523926 136365772.8 6823936
18 5863.423824310303 5632.776021957398 3545.599937438965 140988313.6 7225344
19 9832.44800567627 6042.519927024842 1362.8159761428833 147965440.0 7626752
20 13462.528228759766 10805.503845214844 7723.008155822754 155809280.0 8028160
21 15751.168251037596 5869.791984558106 1352.5503873825073 158878003.2 8429568
22 4057.770649592082 6856.495976448058 6164.480209350586 165547929.6 8830976
23 6877.18391418457 6122.759938240051 1624.5973507563272 173900492.8 9232384
24 4044.117450714112 6420.199990272522 1758.8800191879272 179249868.8 9633792
25 4079.1040062904362 5678.304036458334 1895.695984363556 188873216.0 10035200
26 4046.1653868357344 8688.703536987305 1978.250702222188 191194009.6 10436608
27 11844.608306884766 8994.016170501709 1906.7519903182983 197736755.2 10838016
28 4047.8719870249433 5857.226530710856 1776.4240503311157 205501952.0 11239424
29 4020.2240149180097 6033.751845359801 1794.944018125534 210357350.4 11640832
30 11159.551620483398 5762.087941169739 2665.40789604187 215479808.0 12042240
31 3949.2266972859697 6082.640051841736 1869.3040013313291 222055526.4 12443648
32 4025.6853103637695 6467.839837074279 2183.3039522171016 229529088.0 12845056
33 3826.176047325134 7748.298645019531 2109.8479628562927 236736409.6 13246464
34 3690.4960473378505 6236.136078834535 1940.856009721756 242452787.2 13647872
35 4050.6027539571123 6278.735995292664 2010.8266671498616 247175475.2 14049280
36 16403.45573425293 6753.76001993815 2330.951988697052 253970739.2 14450688
37 17148.927688598633 5840.469360351562 2270.2640295028687 259148083.2 14852096
38 10896.89588546753 6321.375966072083 2363.615989685058 267618611.2 15253504
39 4328.106721242269 10003.104209899902 2309.2053731282554 272067276.8 15654912
40 9290.752410888672 6324.405193328857 2836.6079926490784 280221184.0 16056320
41 4206.591963768005 6458.432038625082 2825.3227074941 287072972.8 16457728
42 4006.1439871788025 5905.984083811442 2354.0373643239336 289466675.2 16859136
43 4135.93594233195 6002.847989400228 2583.4400057792664 295688499.2 17260544
44 4010.2400779724126 5886.207938194275 2563.575983047486 304292556.8 17661952
45 3921.237309773763 5372.639973958334 2547.2511768341064 308300083.2 18063360
46 10610.687732696533 6078.440070152283 2541.3440068562827 317643059.2 18464768
47 3702.5279998779297 5478.5386721293125 2547.0560193061833 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
