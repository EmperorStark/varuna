Parent process ID: 4739 node: 172.31.24.82
16 per stage
32 servers!
Config:
ranks: range(26, 27)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=26 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 26
USED MODULES
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
26 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 2662.400007247925 3743.8826560974117 235.73600128293037 44759347.2 401408
2 3698.1760263442993 4495.402654012044 328.3120021224022 51751219.2 802816
3 3723.26397895813 6038.1920337677 427.6415944099427 53404364.8 1204224
4 4364.62926864624 7438.432216644287 562.6240015029907 57765785.6 1605632
5 4202.496051788331 5864.335894584656 567.6960051059722 62352076.8 2007040
6 3533.4827105204263 5844.853242238362 573.3013351758322 66519756.8 2408448
7 3706.538677215576 6070.768117904662 695.6992149353027 72710860.8 2809856
8 13881.343841552734 6954.567909240723 1002.1439790725709 78763520.0 3211264
9 8121.343612670898 7464.57576751709 732.0480048656464 84720742.4 3612672
10 3726.6773382822676 7450.592041015625 804.0639758110046 91426713.6 4014080
11 3958.7840239206953 5586.623986562092 1148.9280462265015 97633792.0 4415488
12 8520.19214630127 6082.0560455322275 936.7786844571433 104219340.8 4816896
13 11120.63980102539 6961.568117141723 936.9471788406372 110985113.6 5218304
14 5905.407905578613 5642.901420593261 1047.0799803733826 115547238.4 5619712
15 7001.600027084351 6051.975965499878 982.7946623166403 122689843.2 6021120
16 11108.351707458496 14818.9115524292 1114.0373547871907 130007654.4 6422528
17 15624.703884124756 5678.783893585206 1167.160004377365 136365772.8 6823936
18 4165.632009506226 6511.082808176676 1456.928014755249 140988313.6 7225344
19 3481.8560481071468 5089.57600593567 1640.074650446574 147965440.0 7626752
20 21641.216278076172 6170.85854212443 1189.8239850997923 155809280.0 8028160
21 6681.600093841553 6119.733492533366 1607.375979423523 158878003.2 8429568
22 3846.1439609527583 6674.282709757486 1431.744009256363 165547929.6 8830976
23 3810.55998802185 5724.519968032837 1414.6640002727509 173900492.8 9232384
24 3767.296016216278 7265.759944915771 10612.895965576172 179249868.8 9633792
25 3778.2187461853027 5540.815949440002 1718.8479900360107 188873216.0 10035200
26 3862.1866703033447 5483.07991027832 1862.608015537262 191194009.6 10436608
27 19196.24519348144 5756.266752878825 1742.048001289368 197736755.2 10838016
28 4238.591969013214 5973.152041435243 1913.5119915008547 205501952.0 11239424
29 4013.0559802055363 6100.693225860596 1899.8719851175942 210357350.4 11640832
30 3866.9653733571367 6352.202733357747 2310.3039264678955 215479808.0 12042240
31 3935.7439875602718 5619.381427764893 1909.4187021255493 222055526.4 12443648
32 4405.248165130615 9093.055725097656 2835.0400924682617 229529088.0 12845056
33 3579.9040198326115 11023.903846740724 1904.0799736976624 236736409.6 13246464
34 8402.94361114502 5730.391979217528 2673.504114151001 242452787.2 13647872
35 17184.256553649902 5551.925500233968 2232.288002967834 247175475.2 14049280
36 8968.192100524902 6219.071865081787 2228.000044822693 253970739.2 14450688
37 8485.888004302979 6280.352115631104 2039.9359703063965 259148083.2 14852096
38 14208.000183105469 8760.91194152832 2349.503993988037 267618611.2 15253504
39 3936.5120530128474 5796.287894248962 2231.6586176554365 272067276.8 15654912
40 12649.471759796143 5750.485420227051 2310.4639649391174 280221184.0 16056320
41 3819.86133257548 5605.32009601593 2244.639992713928 287072972.8 16457728
42 3999.0612665812173 5788.344025611877 2485.8133792877197 289466675.2 16859136
43 4080.9813340504966 6244.119882583617 2454.6880125999455 295688499.2 17260544
44 4125.013510386149 6354.762713114421 2506.0479640960693 304292556.8 17661952
45 9797.120094299318 5882.279992103577 3179.58402633667 308300083.2 18063360
46 12546.048164367676 6315.616011619568 2592.8533077239986 317643059.2 18464768
47 8707.072257995605 5740.856170654297 3123.7279176712036 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
