Parent process ID: 8121 node: 172.31.24.208
16 per stage
32 servers!
Config:
ranks: range(4, 5)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=4 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 4
USED MODULES
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
4 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 32.0
1 2817.70658493042 6144.864082336426 402.48320102691656 20096409.6 802816
2 2676.0533650716147 7886.528015136719 491.88798666000366 35354828.8 1605632
3 2444.2880153656006 3857.77598619461 617.8160011768341 50530508.8 2408448
4 2571.2640285491943 4227.63204574585 953.0666669209797 66755276.8 3211264
5 2502.997318903605 3869.930664698283 1103.8399934768677 83019878.4 4014080
6 12412.415981292725 4906.496047973633 902.9199928045273 96287436.8 4816896
7 2433.0240090688067 4614.62386449178 1038.3039911588032 111329996.8 5619712
8 2715.306679407755 5306.328058242798 1111.7520034313202 125590220.8 6422528
9 2722.0480442047124 9559.103965759277 1273.0880081653595 140532428.8 7225344
10 2491.127967834472 3626.05873743693 2563.551902770996 154916556.8 8028160
11 2998.272061347961 3962.602694829305 1560.9599947929385 168071372.8 8830976
12 2524.501323699951 4293.727874755859 1558.240016301473 184161996.8 9633792
13 2722.1333185831704 7367.775917053223 1657.920002937317 199340748.8 10436608
14 2652.160088221232 4882.62403011322 2137.984037399292 213859020.8 11239424
15 2454.527974128723 4070.0906912485757 2009.4933509826658 227920588.8 12042240
16 18985.300699869793 10563.455581665039 2055.2160143852234 242243276.8 12845056
17 12747.77603149414 5148.303985595703 2224.0799665451045 258991820.8 13647872
18 2741.759955883026 4680.3998947143555 2000.623971223831 273798860.8 14450688
19 2658.3039760589595 9365.119934082031 2085.480034351349 295978700.8 15253504
20 2633.7279478708906 6804.63981628418 2841.887950897217 302078668.8 16056320
21 14349.823951721191 7181.119918823242 7275.360107421875 315828940.8 16859136
22 2960.8960151672363 4178.773323694865 7092.592000961304 339196108.8 17661952
23 3904.5119285583496 4611.168066660564 33562.46566772461 357166796.8 18464768
24 2726.143956184387 4799.189408620199 4133.69607925415 360012492.8 19267584
25 2627.2427241007485 5039.733250935873 3247.904062271118 376465612.8 20070400
26 7221.248149871826 6624.415874481201 4375.391960144043 398096076.8 20873216
27 10829.824447631836 4225.232005119324 3397.2053527832027 413054668.8 21676032
28 2957.568049430847 9932.176113128662 33376.190185546875 427473100.8 22478848
29 3158.015966415405 4530.645370483398 42718.59359741211 440903884.8 23281664
30 2959.872007369995 4543.912053108215 3391.7920589447017 456366284.8 24084480
31 2808.1493377685542 5262.592077255249 28404.57534790039 471320780.8 24887296
32 3233.450730641683 6858.479976654053 12485.024452209473 485643980.8 25690112
33 5003.2639503479 5083.008050918579 5584.447860717773 500754124.8 26492928
34 2859.3494097391767 4681.69609705607 4628.351926803588 515184844.8 27295744
35 4244.480133056641 4485.546588897705 36719.31076049805 529762508.8 28098560
36 2885.2906227111816 7087.584018707275 70789.87121582031 544446668.8 28901376
37 14002.687931060791 4818.719863891602 53849.84016418457 560232140.8 29704192
38 3112.6186847686768 5087.680021921794 13483.360290527344 574920396.8 30507008
39 3059.9679946899414 5372.712016105652 4818.455934524536 588269260.8 31309824
40 3084.629376729329 5161.400079727173 4497.503916422525 604100812.8 32112640
41 9867.263793945312 5405.6479930877695 4446.432113647461 618043596.8 32915456
42 2999.295949935913 11981.344223022461 4773.036861419678 631896268.8 33718272
43 18719.2325592041 5406.890710194904 5657.855987548828 647579340.8 34521088
44 4129.792213439941 5888.3520762125645 4828.848123550416 663017164.8 35323904
45 3134.4640254974365 5833.943843841554 4955.498536427815 676427468.8 36126720
46 3301.376044750214 5746.2639808654785 22321.632385253906 690272460.8 36929536
47 3167.9999828338623 5917.199969291687 9309.215545654297 704988876.8 37732352
pre-alr mem 2285056
All reduce times
32 [0.0, 58574.08905029297, 51340.58380126953, 77082.90100097656, 64389.02282714844, 72040.46630859375, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 1874.9078512191772, 2139.5022869110107, 2587.420701980591, 2878.387689590454, 3031.827926635742, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 2686.0716342926025, 2933.0122470855713, 3260.885000228882, 3640.6915187835693, 3584.667682647705, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 6158.940315246582, 6564.140319824219, 7401.375770568848, 7937.630176544189, 8637.419700622559, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 38945.6901550293, 39667.26303100586, 41642.83752441406, 42123.68392944336, 42864.17007446289, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 189126.7852783203, 191303.84826660156, 195635.6201171875, 198259.90295410156, 205307.373046875, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
