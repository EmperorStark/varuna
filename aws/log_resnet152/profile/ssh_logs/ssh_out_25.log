Parent process ID: 6548 node: 172.31.17.209
16 per stage
32 servers!
Config:
ranks: range(25, 26)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=25 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 25
USED MODULES
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
25 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3605.504035949707 5339.530626932779 290.06399214267725 44759347.2 401408
2 3348.991990089416 4403.690656026205 327.6096045970917 51751219.2 802816
3 8748.031616210938 5762.154738108316 410.3759974241257 53404364.8 1204224
4 3873.109420140584 5706.144014994304 524.0639969706535 57765785.6 1605632
5 22287.359237670895 6227.311968803406 657.4239879846573 62352076.8 2007040
6 3627.007961273194 7272.287845611572 741.2799894809723 66519756.8 2408448
7 3833.8561058044434 5670.912106831869 706.6026528676351 72710860.8 2809856
8 5486.591815948486 7850.304126739501 793.4719920158386 78763520.0 3211264
9 11016.192436218262 6898.069222768148 763.6000066995622 84720742.4 3612672
10 3713.365316390991 5553.3199310302725 839.3040150403976 91426713.6 4014080
11 3865.856051445007 5545.098781585693 823.0319768190383 97633792.0 4415488
12 6627.327919006348 6830.336093902588 5802.602608998616 104219340.8 4816896
13 4102.826754252116 6028.712034225464 5951.9360065460205 110985113.6 5218304
14 3783.168017864227 5616.28802617391 1200.6720304489136 115547238.4 5619712
15 8189.9518966674805 5902.407884597779 983.144015073776 122689843.2 6021120
16 8684.54360961914 5513.359904289246 1164.7573312123618 130007654.4 6422528
17 3899.3918895721436 7069.536209106445 6220.287799835205 136365772.8 6823936
18 4044.458627700805 8221.759796142578 1390.8586502075195 140988313.6 7225344
19 18121.728897094727 5295.818646748861 1172.8959878285725 147965440.0 7626752
20 16293.888092041017 5497.399926185607 1486.7520332336424 155809280.0 8028160
21 6192.1281814575195 5550.231814384461 1336.7679913838706 158878003.2 8429568
22 3680.5973052978516 5740.472078323364 1882.431983947754 165547929.6 8830976
23 12584.959983825684 5565.51992893219 1395.17867565155 173900492.8 9232384
24 4618.239879608154 5921.90396785736 4649.663925170898 179249868.8 9633792
25 9201.663970947266 6034.090677897136 1587.7887725830076 188873216.0 10035200
26 3861.8453343709307 6563.37054570516 1521.487981081009 191194009.6 10436608
27 3759.786685307821 6210.064053535461 2045.7279682159426 197736755.2 10838016
28 3926.527976989746 5508.320013682047 1763.4080052375791 205501952.0 11239424
29 3937.0239973068233 5450.122833251952 2002.2507111231487 210357350.4 11640832
30 3642.709414164225 6017.656087875366 2434.4639778137207 215479808.0 12042240
31 3792.2132809956865 6635.3759765625 2615.5359745025635 222055526.4 12443648
32 21212.672233581547 8802.207946777344 2116.725444793701 229529088.0 12845056
33 17381.376266479496 5367.807865142822 2568.9173539479575 236736409.6 13246464
34 3930.453300476074 6375.416040420532 2222.3360538482666 242452787.2 13647872
35 3758.76259803772 6468.2722091674805 1944.3626801172893 247175475.2 14049280
36 9966.591835021973 5588.895956675211 2044.543981552124 253970739.2 14450688
37 11696.127891540526 5905.032038688659 2148.303985595703 259148083.2 14852096
38 3897.0026175181074 6464.879989624023 2327.9744148254395 267618611.2 15253504
39 5346.303939819336 7093.103885650635 2300.000011920929 272067276.8 15654912
40 4018.9440250396733 6247.168064117431 2634.1439882914224 280221184.0 16056320
41 3782.3999524116516 5531.903902689616 2191.1231994628906 287072972.8 16457728
42 4319.231986999512 6362.99192905426 2459.2533111572266 289466675.2 16859136
43 9231.36043548584 6432.170867919922 2524.127960205078 295688499.2 17260544
44 3853.3120155334473 5841.536045074463 2342.78404712677 304292556.8 17661952
45 18053.119659423828 6989.487886428833 2389.354705810547 308300083.2 18063360
46 3707.904020945231 5922.5759506225595 3016.454410552979 317643059.2 18464768
47 14275.58422088623 6039.25597667694 2609.7066402435303 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
