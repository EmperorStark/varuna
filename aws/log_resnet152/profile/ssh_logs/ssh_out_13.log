Parent process ID: 6712 node: 172.31.28.236
16 per stage
32 servers!
Config:
ranks: range(13, 14)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=13 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 13
USED MODULES
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 2793.8133080800376 4836.575984954834 234.69440340995786 44759347.2 401408
2 2948.096036911011 9596.719741821289 314.9759918451309 51751219.2 802816
3 3331.0720125834146 6561.802705128987 339.8826618989309 53404364.8 1204224
4 4475.221316019693 6526.2720584869385 506.04800134897243 57765785.6 1605632
5 8426.495552062988 5886.584043502808 527.4240016937256 62352076.8 2007040
6 3993.8559532165527 7227.67996788025 676.639997959137 66519756.8 2408448
7 3760.8106931050625 6774.767875671387 652.8960069020588 72710860.8 2809856
8 10196.991920471191 5860.567927360536 767.2159969806671 78763520.0 3211264
9 5227.519989013672 5885.4398727417 765.017604827881 84720742.4 3612672
10 3744.0853118896484 5703.413327534993 809.6447944641113 91426713.6 4014080
11 4039.680004119872 6203.376054763794 954.4063925743102 97633792.0 4415488
12 4223.317305246989 6490.615963935851 5425.1837730407715 104219340.8 4816896
13 4483.583927154542 12099.743843078613 1212.832013765971 110985113.6 5218304
14 3783.680041631063 11277.791976928711 1007.3152065277101 115547238.4 5619712
15 3687.423944473267 5967.199921607972 1011.3343834877014 122689843.2 6021120
16 9454.591751098633 6278.472185134888 1084.8239958286285 130007654.4 6422528
17 3819.86133257548 6687.904119491577 1188.1119906902313 136365772.8 6823936
18 5276.671886444092 5687.27461496989 1198.1520056724548 140988313.6 7225344
19 3954.3466567993164 15613.920211791992 12340.59190750122 147965440.0 7626752
20 12121.088027954102 5415.050824483236 1470.7760214805603 155809280.0 8028160
21 3668.6507066090903 5546.890576680501 1688.160002231598 158878003.2 8429568
22 3803.4772872924805 6718.767881393433 1561.9919896125793 165547929.6 8830976
23 8361.471891403198 5760.759949684143 1406.3253402709963 173900492.8 9232384
24 8190.976142883302 6294.575929641723 1468.6080217361452 179249868.8 9633792
25 3827.0293076833086 6632.512092590332 12132.12776184082 188873216.0 10035200
26 3818.23992729187 5532.693386077881 1519.2880034446716 191194009.6 10436608
27 9408.512115478516 6078.543901443481 1603.1807899475098 197736755.2 10838016
28 17181.18381500244 16004.064559936523 1896.2559998035433 205501952.0 11239424
29 5107.7117919921875 9480.89599609375 1776.3946851094565 210357350.4 11640832
30 13232.128143310547 6564.181327819825 2197.02410697937 215479808.0 12042240
31 18931.20002746582 9227.839946746824 2494.431972503662 222055526.4 12443648
32 3544.319987297058 5796.696066856384 1820.6959962844849 229529088.0 12845056
33 3615.402619043986 6119.722843170166 2208.6400985717773 236736409.6 13246464
34 3706.112027168274 6091.360092163086 2068.9173142115274 242452787.2 13647872
35 9824.25594329834 8560.192108154295 14705.663681030273 247175475.2 14049280
36 13558.783531188965 6444.504022598267 2077.78400182724 253970739.2 14450688
37 3918.16528638204 5775.050799051921 2081.544041633606 259148083.2 14852096
38 3794.2612965901694 6461.647987365723 2157.271981239319 267618611.2 15253504
39 15052.799701690674 7560.863971710205 2208.2943916320796 272067276.8 15654912
40 3956.394592920939 9600.031852722168 2760.0426673889156 280221184.0 16056320
41 6403.071880340576 6275.856018066406 3029.3520092964172 287072972.8 16457728
42 10819.583892822266 6109.359979629517 2341.6768550872803 289466675.2 16859136
43 7665.664196014404 6143.061319986979 2401.1200666427612 295688499.2 17260544
44 15194.623947143555 8341.055870056152 3021.0986137390137 304292556.8 17661952
45 5797.887802124023 6111.248016357422 2507.078456878662 308300083.2 18063360
46 3614.037354787191 6517.879962921143 2603.4560203552246 317643059.2 18464768
47 4073.9840269088745 6517.216086387634 3116.7199611663823 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
