Parent process ID: 8538 node: 172.31.22.165
16 per stage
32 servers!
Config:
ranks: range(9, 10)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=9 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 9
USED MODULES
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
9 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 128.0
1 4326.399803161621 3660.2496147155757 374.4799941778183 13273907.2 802816
2 2009.429335594177 3682.2400093078613 542.2293345133463 23155097.6 1605632
3 1990.4000461101532 3251.3200640678406 605.5199950933458 32588185.6 2408448
4 2035.7120831807451 4633.9521408081055 3657.056013743083 42021273.6 3211264
5 2041.8560504913328 3433.903992176056 811.1039996147156 52583321.6 4014080
6 9298.943996429443 3909.7280502319336 914.8266514142355 60887449.6 4816896
7 2032.2986046473184 5028.874715169271 3628.6399364471436 70320537.6 5619712
8 5301.248073577881 6149.472236633301 10193.887710571289 79753625.6 6422528
9 2127.104014158249 4068.335890769959 1360.2560361226401 90257817.6 7225344
10 2025.4720052083333 3381.5786838531494 1491.9359683990479 99160473.6 8028160
11 1989.6319707234702 4410.0799560546875 6832.608222961426 108052889.6 8830976
12 2093.0560429890947 3658.720016479492 1566.0053094228108 118026649.6 9633792
13 2027.7760326862333 4556.832075119019 15568.544387817383 127312281.6 10436608
14 2038.5280251502988 3942.287921905517 1751.5008211135864 138121625.6 11239424
15 2064.042647679647 3993.4720198313394 2236.960013707479 146866585.6 12042240
16 2276.693344116211 3778.0880331993103 2114.1247987747192 155218329.6 12845056
17 17225.215911865234 18219.200134277344 6839.00785446167 166824345.6 13647872
18 9185.279846191406 8879.039764404297 2030.8373371760051 175690137.6 14450688
19 2157.22664197286 5418.784141540527 30537.792205810547 186368409.6 15253504
20 5100.543975830078 4563.920021057129 2402.0720124244694 194392473.6 16056320
21 2124.7999668121333 3524.688005447388 3096.1920022964478 202383769.6 16859136
22 2128.895998001099 4159.91997718811 21347.488403320312 212799897.6 17661952
23 2048.0000376701355 3721.162637074789 2513.269344965617 225581465.6 18464768
24 2023.4240591526031 3374.943971633911 3036.5653038024902 231453081.6 19267584
25 2289.407968521118 9327.199935913086 4335.263967514038 244660633.6 20070400
26 2286.2506707509356 5793.536186218262 3156.3040018081665 250630553.6 20873216
27 2082.5599431991577 3608.0106894175215 3068.5359835624695 261046681.6 21676032
28 2183.1679940223694 3478.282690048218 3350.4384040832515 270184857.6 22478848
29 2133.6746215820312 7821.792125701905 3009.7199678421016 278790553.6 23281664
30 2168.4906482696533 3285.4293187459307 3244.168043136597 288018841.6 24084480
31 2095.103979110718 4484.917481740315 3182.0719838142395 299360665.6 24887296
32 2105.5999398231506 3525.11994043986 3752.908706665039 309293465.6 25690112
33 2107.3919932047525 4322.59202003479 4324.2000341415405 317890969.6 26492928
34 2176.767945289612 3592.527985572815 3768.2815551757812 326545817.6 27295744
35 2784.7679853439327 3745.296001434326 3859.5733642578125 336355737.6 28098560
36 2280.192017555237 3490.7999634742737 4051.240086555481 348238233.6 28901376
37 2232.661326726278 3671.2160110473633 4249.968051910401 354103705.6 29704192
38 2517.333348592122 4280.543804168701 5071.530818939209 365785497.6 30507008
39 2394.11195119222 5562.655925750732 4862.720012664795 373506457.6 31309824
40 2278.7412802378335 3761.7919445037837 4975.967884063721 383971737.6 32112640
41 2391.040027141571 3672.213315963745 4755.607962608337 393441689.6 32915456
42 13822.976112365723 3672.9519963264465 4738.816022872925 400478617.6 33718272
43 2289.1520261764526 3773.6880779266353 4430.375933647156 410403225.6 34521088
44 13131.775856018066 5504.064083099365 9485.28003692627 423063961.6 35323904
45 2277.717351913452 3768.6719894409184 5003.231883049011 428945817.6 36126720
46 2512.896001338959 11301.312446594238 5906.688054402669 440668569.6 36929536
47 2563.3280277252197 3659.7759723663326 6015.663981437683 447791513.6 37732352
pre-alr mem 1686528
All reduce times
32 [0.0, 70200.0503540039, 73812.33215332031, 72950.68359375, 79363.66271972656, 82667.86193847656, 84857.36083984375, 90473.78540039062, 90362.92266845703, 80933.3724975586, 95210.60943603516, 84149.01733398438, 83284.5458984375, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 3560.8372688293457, 3612.5328540802, 4060.5998039245605, 4248.973369598389, 4681.332111358643, 2544.482707977295, 5336.12060546875, 3131.838321685791, 3094.5892333984375, 2979.086399078369, 3054.396629333496, 2886.6965770721436, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 3947.321653366089, 4408.742427825928, 4757.451057434082, 4982.49626159668, 5353.008270263672, 5618.56746673584, 6123.57234954834, 6503.731727600098, 6668.9958572387695, 6846.683025360107, 7242.81120300293, 7489.129066467285, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 9417.867660522461, 10352.828979492188, 9369.109153747559, 10021.008491516113, 10439.566612243652, 10638.232231140137, 11410.057067871094, 11370.841026306152, 12471.035957336426, 12554.566383361816, 13501.421928405762, 13276.168823242188, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 43248.783111572266, 44736.85073852539, 42887.66098022461, 43847.843170166016, 44899.10125732422, 47743.865966796875, 44732.65075683594, 45101.192474365234, 45257.90786743164, 47829.70428466797, 51291.51153564453, 51040.435791015625, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 215730.9112548828, 207525.52795410156, 202740.72265625, 232631.591796875, 221873.0926513672, 226787.1551513672, 211804.62646484375, 217441.22314453125, 212259.09423828125, 222679.87060546875, 223272.43041992188, 219918.88427734375, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
