Parent process ID: 5380 node: 172.31.21.137
16 per stage
32 servers!
Config:
ranks: range(21, 22)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=21 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a resnet152 --varuna --lr 0.001 --epochs 100 --resume s3://spot-checkpoints/resnet-profile --profiling
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
Stages to profile: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]
factors [32, 16, 8, 4, 2, 1]
all reduce sizes [9536, 84544, 225344, 1444928, 13015104, 60192808]
STAGE 21
USED MODULES
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
21 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Gradient overflow.  Skipping step, loss scaler 0 reducing loss scale to 8.0
1 3935.2319240570073 4699.81598854065 260.383998354276 44759347.2 401408
2 2935.0399374961853 4000.9360313415527 298.25279712677 51751219.2 802816
3 3610.111951828003 5993.525346120199 389.09600675106043 53404364.8 1204224
4 7170.048236846924 6305.6480884552 424.01599138975143 57765785.6 1605632
5 3905.791938304901 9277.888298034668 519.5840001106261 62352076.8 2007040
6 4452.864170074462 7317.183971405029 615.7119870185852 66519756.8 2408448
7 3716.6079878807072 6334.167838096619 617.9967999458313 72710860.8 2809856
8 3730.0906976064052 5894.240061442058 694.7440057992935 78763520.0 3211264
9 6930.943965911864 5746.016025543213 885.418673356374 84720742.4 3612672
10 4446.2080001831055 8557.823657989502 816.0240054130554 91426713.6 4014080
11 4187.904000282288 5804.672002792358 1006.0159961382549 97633792.0 4415488
12 10311.67984008789 6241.631984710692 836.1066579818727 104219340.8 4816896
13 4146.687984466553 6173.800110816956 937.0453159014385 110985113.6 5218304
14 4973.567962646484 7735.8078956604 6282.448053359986 115547238.4 5619712
15 3690.496027469635 5430.869420369466 1098.0000048875809 122689843.2 6021120
16 3513.3439699808755 5582.240104675293 1208.0080211162567 130007654.4 6422528
17 3674.112021923065 9487.520217895508 1138.9546394348145 136365772.8 6823936
18 4169.216156005859 5898.872017860413 8014.863729476927 140988313.6 7225344
19 3797.674655914306 7756.304264068604 1255.8079957962036 147965440.0 7626752
20 12798.975944519043 6766.000032424927 1226.1013587315879 155809280.0 8028160
21 3850.239992141724 6220.319906870525 1491.1920130252838 158878003.2 8429568
22 20603.391647338867 5756.704012552897 1575.8239924907684 165547929.6 8830976
23 3824.6399561564126 5916.789372762045 1417.2880053520203 173900492.8 9232384
24 3958.4426879882812 6663.562615712483 10784.319877624512 179249868.8 9633792
25 3809.2799186706543 5704.298655192057 1440.1840269565582 188873216.0 10035200
26 3904.5120080312095 8387.58373260498 1825.4506985346477 191194009.6 10436608
27 8674.304008483887 6182.1333567301435 2850.048065185547 197736755.2 10838016
28 3856.725374857585 6074.120044708253 1615.72269598643 205501952.0 11239424
29 3908.6079597473145 6045.82417011261 1881.7599713802335 210357350.4 11640832
30 3920.896053314208 6019.968032836914 2545.85599899292 215479808.0 12042240
31 9948.160171508789 5488.949457804361 1790.1120185852049 222055526.4 12443648
32 3545.344054698944 5523.765405019125 2322.9973316192627 229529088.0 12845056
33 4564.9919509887695 5549.64272181193 1959.468793869019 236736409.6 13246464
34 3523.3280658721924 6054.442723592123 1998.5813299814859 242452787.2 13647872
35 3740.160048007965 5746.551990509033 8588.383674621582 247175475.2 14049280
36 18699.264526367188 6208.640098571777 2137.4079883098602 253970739.2 14450688
37 18936.32030487061 6022.295951843262 2117.738723754883 259148083.2 14852096
38 12299.263954162598 5360.138734181722 2184.127986431122 267618611.2 15253504
39 3832.832098007202 6076.522668202719 2195.5920457839966 272067276.8 15654912
40 4074.4959513346353 5926.410675048828 2298.0266412099204 280221184.0 16056320
41 13414.400100708008 6849.194526672364 2382.719993591308 287072972.8 16457728
42 3952.6400566101074 8071.296056111654 50966.447830200195 289466675.2 16859136
43 14656.511783599854 6712.768077850342 3069.9413617451983 295688499.2 17260544
44 4136.19202375412 8708.191871643066 34347.232818603516 304292556.8 17661952
45 4050.602595011394 5778.3253987630205 32868.86215209961 308300083.2 18063360
46 3922.943909962972 5749.301274617512 3187.0719591776533 317643059.2 18464768
47 6078.464031219482 7583.775997161866 3383.1919431686406 322523443.2 18866176
pre-alr mem 13423104
All reduce times
32 [0.0, 83633.28552246094, 97170.2880859375, 87522.83477783203, 89892.71545410156, 99097.12219238281, 141197.57080078125, 137296.49353027344, 85101.50146484375, 95595.67260742188, 137664.09301757812, 143959.7625732422]
16 [0.0, 2874.3133544921875, 2796.7710494995117, 2922.3461151123047, 2900.6447792053223, 2900.1083374023438, 6115.854740142822, 6103.990077972412, 2865.788698196411, 2874.363899230957, 6535.486698150635, 5174.301624298096]
8 [0.0, 7852.623462677002, 8621.109008789062, 8609.848976135254, 8988.049507141113, 9432.380676269531, 15466.872215270996, 15514.799118041992, 9998.52180480957, 10078.231811523438, 14485.084533691406, 15014.791488647461]
4 [0.0, 13466.818809509277, 14725.107192993164, 13820.611953735352, 14464.310646057129, 14579.147338867188, 29879.30679321289, 30614.017486572266, 16082.902908325195, 16689.470291137695, 25247.96485900879, 25975.866317749023]
2 [0.0, 48404.02603149414, 53898.529052734375, 46827.80075073242, 43836.39144897461, 48287.06359863281, 109485.38970947266, 109347.30529785156, 50960.243225097656, 46808.35723876953, 80494.86541748047, 85857.61260986328]
1 [0.0, 222329.60510253906, 225670.0897216797, 227435.36376953125, 244360.65673828125, 284490.6005859375, 441847.0764160156, 283447.1130371094, 219030.79223632812, 236278.30505371094, 355241.7907714844, 385381.5002441406]
Process done with return code 0
