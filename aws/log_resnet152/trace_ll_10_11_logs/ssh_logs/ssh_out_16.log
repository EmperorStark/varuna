Parent process ID: 26515 node: 172.31.19.112
32 cutpoints
Stages 1
Micro-bs 32 Max mem: 8675329024.0
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 4 0 222679.87060546875 0
End of simulation:  Mini-batch time (usec) = 1777661
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 201398, max long fwd 203682; min long bwd 184795, max long bwd 189299
Time taken by simulation: 44 microseconds

Stages 2
Micro-bs 32 Max mem: 5306506956.799999
Predicted microbatch size for 2: 32
comm size 6422528
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 8 0 42864.17007446289 339993.4039718803
End of simulation:  Mini-batch time (usec) = 2926179
Min send: 10000000, max send 0
Min long send: 340325, max long send 360040
Min fwd: 54106, max fwd 61226; min bwd 79729, max bwd 84071
Min long fwd: 142875, max long fwd 147087; min long bwd 100210, max long bwd 105674
Time taken by simulation: 161 microseconds

Stages 4
Micro-bs 32 Max mem: 3266000179.2
Predicted microbatch size for 4: 32
comm size 12845056
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 16 0 5012.969017028809 632152.0801385244
End of simulation:  Mini-batch time (usec) = 8186112
Min send: 10000000, max send 0
Min long send: 632289, max long send 656857
Min fwd: 22997, max fwd 85414; min bwd 32345, max bwd 55249
Min long fwd: 59874, max long fwd 66218; min long bwd 45265, max long bwd 54005
Time taken by simulation: 746 microseconds

Stages 8
Micro-bs 32 Max mem: 1980926361.6
Predicted microbatch size for 8: 32
comm size 12845056
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 32 0 1084.3276977539062 632152.0801385244
End of simulation:  Mini-batch time (usec) = 17887923
Min send: 10000000, max send 0
Min long send: 632168, max long send 660373
Min fwd: 5425, max fwd 48670; min bwd 12684, max bwd 35373
Min long fwd: 26803, max long fwd 34176; min long bwd 16127, max long bwd 25418
Time taken by simulation: 3190 microseconds

Stages 16
Micro-bs 32 Max mem: 1128991948.8
Predicted microbatch size for 16: 32
comm size 25690112
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 64 0 0 1028093.6227904424
End of simulation:  Mini-batch time (usec) = 61731430
Min send: 10000000, max send 0
Min long send: 1028093, max long send 1062462
Min fwd: 56, max fwd 33543; min bwd 2591, max bwd 20855
Min long fwd: 1672, max long fwd 12532; min long bwd 2017, max long bwd 11294
Time taken by simulation: 14256 microseconds

{1: 1.777661, 2: 2.926179, 4: 8.186112, 8: 17.887923, 16: 61.73143}
{1: 32, 2: 32, 4: 32, 8: 32, 16: 32}
best config is: 2 32
expected time is 2.926179
9 per stage
18 servers!
Config:
ranks: range(16, 17)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 9
stage to rank map: 0,2,4,6,8,10,12,14,16;1,3,5,7,9,11,13,15,17;
World size is 18
/opt/conda/envs/varuna/bin/python -u main.py --rank=16 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16;1,3,5,7,9,11,13,15,17; --batch-size=224 data -a resnet152 --varuna --lr 0.001 --epochs 1000 --resume s3://spot-checkpoints/resnet
=> creating model 'resnet152'
Files already downloaded and verified
Num cutpoints is 31
dry run time 0.8925266265869141
SHARED WEIGHTS ARE
None
this rank  16 is part of pipeline replica  8
7 chunks
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
[2022-11-30 14:37:45.047497] Finished iteration 1, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 7802.057
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
[2022-11-30 14:37:47.011283] Finished iteration 2, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1963.575
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
[2022-11-30 14:37:48.031424] Finished iteration 3, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1020.113
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
[2022-11-30 14:37:49.949918] Finished iteration 4, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1918.489
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
[2022-11-30 14:37:51.972051] Finished iteration 5, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2022.087
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
[2022-11-30 14:37:52.959472] Finished iteration 6, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 987.381
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
[2022-11-30 14:37:53.852964] Finished iteration 7, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 893.465
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
[2022-11-30 14:37:54.752266] Finished iteration 8, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 899.272
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
[2022-11-30 14:37:55.748911] Finished iteration 9, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 996.604
16 Overflow !!
16 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
[2022-11-30 14:37:37.220644] Epoch: [0][ 10/224]	Time  0.987 ( 1.948)	Data  0.009 ( 0.299)	Loss 7.1908e+00 (7.1843e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:37:56.732357] Finished iteration 10, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 983.421
[2022-11-30 14:37:57.714061] Finished iteration 11, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 981.673
[2022-11-30 14:37:58.689866] Finished iteration 12, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 975.761
[2022-11-30 14:37:59.607027] Finished iteration 13, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 917.135
[2022-11-30 14:38:00.634863] Finished iteration 14, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1027.825
[2022-11-30 14:38:01.619471] Finished iteration 15, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 984.538
[2022-11-30 14:38:02.618703] Finished iteration 16, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 999.188
[2022-11-30 14:38:03.505224] Finished iteration 17, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 886.496
[2022-11-30 14:38:04.500361] Finished iteration 18, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 995.114
[2022-11-30 14:38:05.423972] Finished iteration 19, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 923.567
[2022-11-30 14:37:37.220644] Epoch: [0][ 20/224]	Time  1.008 ( 1.459)	Data  0.008 ( 0.153)	Loss 4.9079e+00 (6.1636e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:38:06.428330] Finished iteration 20, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1004.286
[2022-11-30 14:38:07.366184] Finished iteration 21, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 937.833
[2022-11-30 14:38:08.359248] Finished iteration 22, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 993.022
[2022-11-30 14:38:09.342476] Finished iteration 23, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 983.185
[2022-11-30 14:38:10.304651] Finished iteration 24, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 962.145
[2022-11-30 14:38:11.302734] Finished iteration 25, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 998.034
[2022-11-30 14:38:12.211958] Finished iteration 26, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 909.197
[2022-11-30 14:38:13.184139] Finished iteration 27, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 972.135
[2022-11-30 14:38:14.117034] Finished iteration 28, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 932.869
[2022-11-30 14:38:15.087404] Finished iteration 29, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 970.340
[2022-11-30 14:37:37.220644] Epoch: [0][ 30/224]	Time  0.990 ( 1.294)	Data  0.006 ( 0.104)	Loss 4.7121e+00 (5.6927e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:38:16.078732] Finished iteration 30, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 991.264
[2022-11-30 14:38:17.026598] Finished iteration 31, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 947.847
[2022-11-30 14:38:18.006815] Finished iteration 32, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 980.178
[2022-11-30 14:38:18.940989] Finished iteration 33, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 934.128
[2022-11-30 14:38:19.954329] Finished iteration 34, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1013.306
[2022-11-30 14:38:20.952401] Finished iteration 35, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 998.070
[2022-11-30 14:38:21.948103] Finished iteration 36, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 995.621
[2022-11-30 14:38:22.927313] Finished iteration 37, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 979.180
[2022-11-30 14:38:23.980047] Finished iteration 38, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1052.680
[2022-11-30 14:38:24.957735] Finished iteration 39, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 977.696
[2022-11-30 14:37:37.220644] Epoch: [0][ 40/224]	Time  1.000 ( 1.218)	Data  0.004 ( 0.080)	Loss 4.6674e+00 (5.4339e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:38:25.959193] Finished iteration 40, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1001.378
[2022-11-30 14:38:26.870710] Finished iteration 41, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 911.516
[2022-11-30 14:38:27.790857] Finished iteration 42, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 920.115
[2022-11-30 14:38:28.669106] Finished iteration 43, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 878.196
[2022-11-30 14:38:29.697090] Finished iteration 44, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1027.947
[2022-11-30 14:38:30.693149] Finished iteration 45, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 996.016
[2022-11-30 14:38:31.687565] Finished iteration 46, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 994.404
[2022-11-30 14:38:32.635033] Finished iteration 47, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 947.393
[2022-11-30 14:38:33.628946] Finished iteration 48, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 993.877
[2022-11-30 14:38:34.534504] Finished iteration 49, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 905.510
[2022-11-30 14:37:37.220644] Epoch: [0][ 50/224]	Time  1.011 ( 1.166)	Data  0.006 ( 0.065)	Loss 4.6585e+00 (5.2808e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:38:35.547933] Finished iteration 50, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1013.386
[2022-11-30 14:38:36.558072] Finished iteration 51, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1010.120
[2022-11-30 14:38:37.537429] Finished iteration 52, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 979.341
[2022-11-30 14:38:38.532426] Finished iteration 53, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 994.939
[2022-11-30 14:38:39.552179] Finished iteration 54, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1019.740
[2022-11-30 14:38:40.546886] Finished iteration 55, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 994.643
[2022-11-30 14:38:41.499760] Finished iteration 56, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 952.844
[2022-11-30 14:38:42.432585] Finished iteration 57, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 932.774
[2022-11-30 14:38:43.418958] Finished iteration 58, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 986.343
[2022-11-30 14:38:44.335172] Finished iteration 59, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 916.172
[2022-11-30 14:37:37.220644] Epoch: [0][ 60/224]	Time  0.975 ( 1.134)	Data  0.006 ( 0.056)	Loss 4.6362e+00 (5.1727e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:38:45.311226] Finished iteration 60, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 976.015
[2022-11-30 14:38:46.301305] Finished iteration 61, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 990.047
[2022-11-30 14:38:47.231627] Finished iteration 62, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 930.266
[2022-11-30 14:38:48.191051] Finished iteration 63, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 959.387
[2022-11-30 14:38:49.184765] Finished iteration 64, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 993.683
[2022-11-30 14:38:50.108120] Finished iteration 65, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 923.313
[2022-11-30 14:38:51.118570] Finished iteration 66, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1010.430
[2022-11-30 14:38:52.045228] Finished iteration 67, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 926.617
[2022-11-30 14:38:53.035700] Finished iteration 68, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 990.427
[2022-11-30 14:38:54.006584] Finished iteration 69, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 970.856
[2022-11-30 14:37:37.220644] Epoch: [0][ 70/224]	Time  0.903 ( 1.109)	Data  0.008 ( 0.049)	Loss 4.6440e+00 (5.0964e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-11-30 14:38:54.909804] Finished iteration 70, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 903.152
[2022-11-30 14:38:55.892457] Finished iteration 71, CKPT_AND_STOP: False, flag: tensor([1], dtype=torch.int32), speed: 982.638
Opt ckpt time 3.742493152618408
Process done with return code 0
Parent process ID: 19436 node: 172.31.24.191
32 cutpoints
Stages 1
Micro-bs 32 Max mem: 8675329024.0
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 4 0 217441.22314453125 0
End of simulation:  Mini-batch time (usec) = 1772423
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 201398, max long fwd 203682; min long bwd 184795, max long bwd 189299
Time taken by simulation: 41 microseconds

Stages 2
Micro-bs 32 Max mem: 5306506956.799999
Predicted microbatch size for 2: 32
comm size 6422528
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 8 0 42123.68392944336 339993.4039718803
End of simulation:  Mini-batch time (usec) = 2925438
Min send: 10000000, max send 0
Min long send: 340325, max long send 360040
Min fwd: 54106, max fwd 61226; min bwd 79729, max bwd 84071
Min long fwd: 142875, max long fwd 147087; min long bwd 100210, max long bwd 105674
Time taken by simulation: 163 microseconds

Stages 4
Micro-bs 32 Max mem: 3266000179.2
Predicted microbatch size for 4: 32
comm size 12845056
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 16 0 5012.969017028809 632152.0801385244
End of simulation:  Mini-batch time (usec) = 8186112
Min send: 10000000, max send 0
Min long send: 632289, max long send 656857
Min fwd: 22997, max fwd 85414; min bwd 32345, max bwd 55249
Min long fwd: 59874, max long fwd 66218; min long bwd 45265, max long bwd 54005
Time taken by simulation: 714 microseconds

Stages 8
Micro-bs 32 Max mem: 1980926361.6
Predicted microbatch size for 8: 32
comm size 12845056
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 32 0 1084.3276977539062 632152.0801385244
End of simulation:  Mini-batch time (usec) = 17887923
Min send: 10000000, max send 0
Min long send: 632168, max long send 660373
Min fwd: 5425, max fwd 48670; min bwd 12684, max bwd 35373
Min long fwd: 26803, max long fwd 34176; min long bwd 16127, max long bwd 25418
Time taken by simulation: 3240 microseconds

Stages 16
Micro-bs 32 Max mem: 1128991948.8
Predicted microbatch size for 16: 32
comm size 25690112
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 64 0 0 1028093.6227904424
End of simulation:  Mini-batch time (usec) = 61731430
Min send: 10000000, max send 0
Min long send: 1028093, max long send 1062462
Min fwd: 56, max fwd 33543; min bwd 2591, max bwd 20855
Min long fwd: 1672, max long fwd 12532; min long bwd 2017, max long bwd 11294
Time taken by simulation: 14261 microseconds

{1: 1.772423, 2: 2.925438, 4: 8.186112, 8: 17.887923, 16: 61.73143}
{1: 32, 2: 32, 4: 32, 8: 32, 16: 32}
best config is: 2 32
expected time is 2.925438
8 per stage
16 servers!
16 16 I am of no use!
