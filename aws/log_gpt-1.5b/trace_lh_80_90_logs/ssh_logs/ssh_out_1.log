Parent process ID: 14226 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 7 0 5984009.765625 0
End of simulation:  Mini-batch time (usec) = 9230845
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164303, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 47 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 14 0 2816083.251953125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 7191944
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82709, max long fwd 89657; min long bwd 149926, max long bwd 157738
Time taken by simulation: 236 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 21 0 1916562.744140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6803052
Min send: 10000000, max send 0
Min long send: 38109, max long send 62549
Min fwd: 45773, max fwd 59456; min bwd 92874, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 96930, max long bwd 106927
Time taken by simulation: 660 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 16 0 1199719.8486328125 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5670469
Min send: 10000000, max send 0
Min long send: 80925, max long send 104560
Min fwd: 47855, max fwd 59401; min bwd 106211, max bwd 126925
Min long fwd: 52606, max long fwd 62603; min long bwd 118442, max long bwd 125606
Time taken by simulation: 701 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 764 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1099 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1899 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1925 microseconds

can't have 24 stages!
{1: 9.230845, 2: 7.191944, 3: 6.803052, 4: 5.670469, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.670469
4 per stage
16 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 4
stage to rank map: 0,4,8,12;1,5,9,13;2,6,10,14;3,7,11,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12;1,5,9,13;2,6,10,14;3,7,11,15; --batch-size=32 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16
device is' 0
dry run time 0.6138176918029785
SHARED WEIGHTS ARE
[(0, 3)]
this rank  1 is part of pipeline replica  0
16 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 0.207 seconds
START iteration 0, CKPT_AND_STOP: False
Finished iteration 1, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 1, CKPT_AND_STOP: False
Finished iteration 2, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 2, CKPT_AND_STOP: False
Finished iteration 3, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 3, CKPT_AND_STOP: False
Finished iteration 4, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 4, CKPT_AND_STOP: False
Finished iteration 5, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 5, CKPT_AND_STOP: False
Finished iteration 6, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 6, CKPT_AND_STOP: False
Finished iteration 7, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 7, CKPT_AND_STOP: False
Finished iteration 8, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 8, CKPT_AND_STOP: False
Finished iteration 9, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 9, CKPT_AND_STOP: False
Finished iteration 10, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 10, CKPT_AND_STOP: False
Finished iteration 11, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 11, CKPT_AND_STOP: False
Finished iteration 12, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 12, CKPT_AND_STOP: False
Finished iteration 13, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 13, CKPT_AND_STOP: False
Finished iteration 14, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 14, CKPT_AND_STOP: False
Finished iteration 15, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 15, CKPT_AND_STOP: False
Finished iteration 16, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 16, CKPT_AND_STOP: False
Finished iteration 17, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 17, CKPT_AND_STOP: False
Finished iteration 18, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 18, CKPT_AND_STOP: False
Finished iteration 19, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 19, CKPT_AND_STOP: False
Finished iteration 20, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 20, CKPT_AND_STOP: False
Finished iteration 21, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 21, CKPT_AND_STOP: False
Finished iteration 22, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 22, CKPT_AND_STOP: False
Finished iteration 23, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 23, CKPT_AND_STOP: False
Finished iteration 24, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 24, CKPT_AND_STOP: False
Finished iteration 25, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 25, CKPT_AND_STOP: False
Finished iteration 26, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 26, CKPT_AND_STOP: False
Finished iteration 27, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 27, CKPT_AND_STOP: False
Finished iteration 28, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 28, CKPT_AND_STOP: False
Finished iteration 29, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 29, CKPT_AND_STOP: False
Finished iteration 30, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 30, CKPT_AND_STOP: False
Finished iteration 31, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 31, CKPT_AND_STOP: False
Finished iteration 32, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 32, CKPT_AND_STOP: False
Finished iteration 33, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 33, CKPT_AND_STOP: False
Finished iteration 34, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 34, CKPT_AND_STOP: False
Finished iteration 35, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 35, CKPT_AND_STOP: False
Finished iteration 36, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 36, CKPT_AND_STOP: False
Finished iteration 37, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 37, CKPT_AND_STOP: False
Finished iteration 38, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 38, CKPT_AND_STOP: False
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 1 signal handler called with signal 10
Finished iteration 39, CKPT_AND_STOP: True, flag: tensor([7], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 15.037902355194092
Process done with return code 0
Parent process ID: 14810 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 6 0 5940361.81640625 0
End of simulation:  Mini-batch time (usec) = 8725127
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164547, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 50 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 12 0 2836733.88671875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6512857
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82709, max long fwd 89657; min long bwd 149926, max long bwd 157738
Time taken by simulation: 212 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 21 0 1916562.744140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6803052
Min send: 10000000, max send 0
Min long send: 38109, max long send 62549
Min fwd: 45773, max fwd 59456; min bwd 92874, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 96930, max long bwd 106927
Time taken by simulation: 606 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 13 0 1338646.484375 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5132496
Min send: 10000000, max send 0
Min long send: 80953, max long send 103337
Min fwd: 48269, max fwd 59401; min bwd 107938, max bwd 126574
Min long fwd: 53770, max long fwd 60383; min long bwd 118672, max long bwd 125606
Time taken by simulation: 575 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 799 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1038 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1937 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1915 microseconds

can't have 24 stages!
{1: 8.725127, 2: 6.512857, 3: 6.803052, 4: 5.132496, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.132496
5 per stage
20 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 5
stage to rank map: 0,4,8,12,16;1,5,9,13,17;2,6,10,14,18;3,7,11,15,19;
World size is 20
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16;1,5,9,13,17;2,6,10,14,18;3,7,11,15,19; --batch-size=25 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 39
device is' 0
dry run time 1.5404670238494873
SHARED WEIGHTS ARE
[(0, 3)]
this rank  1 is part of pipeline replica  0
13 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 77.735 seconds
START iteration 39, CKPT_AND_STOP: False
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 1 signal handler called with signal 10
Finished iteration 40, CKPT_AND_STOP: True, flag: tensor([20], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 11.102186679840088
Process done with return code 0
Parent process ID: 16000 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 5 0 6125747.0703125 0
End of simulation:  Mini-batch time (usec) = 8451860
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164718, max long fwd 168133; min long bwd 296265, max long bwd 302385
Time taken by simulation: 51 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 11 0 2767979.736328125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6203240
Min send: 10000000, max send 0
Min long send: 38387, max long send 62760
Min fwd: 76538, max fwd 83279; min bwd 142710, max bwd 147733
Min long fwd: 81915, max long fwd 89657; min long bwd 148530, max long bwd 156110
Time taken by simulation: 241 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 18 0 1846814.0869140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5987018
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 45773, max fwd 59834; min bwd 93871, max bwd 104244
Min long fwd: 57033, max long fwd 64913; min long bwd 98140, max long bwd 103204
Time taken by simulation: 523 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 13 0 1338646.484375 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5132496
Min send: 10000000, max send 0
Min long send: 80953, max long send 103337
Min fwd: 48269, max fwd 59401; min bwd 107938, max bwd 126574
Min long fwd: 53770, max long fwd 60383; min long bwd 118672, max long bwd 125606
Time taken by simulation: 580 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 763 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1041 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1953 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1925 microseconds

can't have 24 stages!
{1: 8.45186, 2: 6.20324, 3: 5.987018, 4: 5.132496, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.132496
5 per stage
20 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 5
stage to rank map: 0,4,8,12,16;1,5,9,13,17;2,6,10,14,18;3,7,11,15,19;
World size is 20
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16;1,5,9,13,17;2,6,10,14,18;3,7,11,15,19; --batch-size=25 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 40
device is' 0
dry run time 1.301950216293335
SHARED WEIGHTS ARE
[(0, 3)]
this rank  1 is part of pipeline replica  0
13 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 73.986 seconds
START iteration 40, CKPT_AND_STOP: False
Finished iteration 41, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 41, CKPT_AND_STOP: False
Finished iteration 42, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 42, CKPT_AND_STOP: False
Finished iteration 43, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 43, CKPT_AND_STOP: False
Finished iteration 44, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 44, CKPT_AND_STOP: False
Finished iteration 45, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 45, CKPT_AND_STOP: False
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 1 signal handler called with signal 10
Finished iteration 46, CKPT_AND_STOP: True, flag: tensor([6], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 12.135616302490234
Process done with return code 0
Parent process ID: 17259 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 5 0 5671273.4375 0
End of simulation:  Mini-batch time (usec) = 7997386
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164718, max long fwd 168133; min long bwd 296265, max long bwd 302385
Time taken by simulation: 53 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 10 0 2977483.88671875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6172069
Min send: 10000000, max send 0
Min long send: 38387, max long send 59301
Min fwd: 77133, max fwd 85384; min bwd 141071, max bwd 148651
Min long fwd: 83859, max long fwd 89657; min long bwd 148892, max long bwd 154838
Time taken by simulation: 183 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 16 0 2198285.64453125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5986016
Min send: 10000000, max send 0
Min long send: 38293, max long send 60521
Min fwd: 45773, max fwd 59456; min bwd 93556, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 97741, max long bwd 104518
Time taken by simulation: 509 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 11 0 1478731.4453125 80871.45884831746
End of simulation:  Mini-batch time (usec) = 4902207
Min send: 10000000, max send 0
Min long send: 81109, max long send 105576
Min fwd: 49725, max fwd 58709; min bwd 110370, max bwd 129008
Min long fwd: 53770, max long fwd 59495; min long bwd 117692, max long bwd 125606
Time taken by simulation: 482 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 8 0 876895.5078125 159635.3450129109
End of simulation:  Mini-batch time (usec) = 5601136
Min send: 10000000, max send 0
Min long send: 159772, max long send 184340
Min fwd: 53241, max fwd 62601; min bwd 123697, max bwd 141328
Min long fwd: 72998, max long fwd 79077; min long bwd 148883, max long bwd 151161
Time taken by simulation: 553 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 7 0 610855.46875 230166.85465330718
End of simulation:  Mini-batch time (usec) = 7505355
Min send: 10000000, max send 0
Min long send: 230248, max long send 254871
Min fwd: 56011, max fwd 66812; min bwd 129842, max bwd 141350
Min long fwd: 83341, max long fwd 88072; min long bwd 159951, max long bwd 163059
Time taken by simulation: 657 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 7 0 343797.36328125 361377.8571928701
End of simulation:  Mini-batch time (usec) = 13548777
Min send: 10000000, max send 0
Min long send: 361459, max long send 385871
Min fwd: 61802, max fwd 72928; min bwd 141491, max bwd 152040
Min long fwd: 108389, max long fwd 112365; min long bwd 179662, max long bwd 186130
Time taken by simulation: 987 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1917 microseconds

Stages 24
13 11546353561.599998
19 16037201817.599998
16 13791433625.599998
17 14539214745.599998
18 15288667033.599998
Predicted microbatch size for 24: 17
comm size 27852800
WARNING: no send time found, 24 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 24 8 0 0 548143.2004641461
End of simulation:  Mini-batch time (usec) = 33444830
Min send: 10000000, max send 0
Min long send: 548262, max long send 578147
Min fwd: 49763, max fwd 61192; min bwd 113823, max bwd 127856
Min long fwd: 124104, max long fwd 128023; min long bwd 187948, max long bwd 195033
Time taken by simulation: 2281 microseconds

{1: 7.997386, 2: 6.172069, 3: 5.986016, 4: 4.902207, 6: 5.601136, 8: 7.505355, 12: 13.548777, 16: 20.148929, 24: 33.44483}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13, 24: 17}
best config is: 4 2
expected time is 4.902207
6 per stage
24 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 6
stage to rank map: 0,4,8,12,16,20;1,5,9,13,17,21;2,6,10,14,18,22;3,7,11,15,19,23;
World size is 24
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16,20;1,5,9,13,17,21;2,6,10,14,18,22;3,7,11,15,19,23; --batch-size=21 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 46
device is' 0
dry run time 1.5952935218811035
SHARED WEIGHTS ARE
[(0, 3)]
this rank  1 is part of pipeline replica  0
11 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 73.636 seconds
START iteration 46, CKPT_AND_STOP: False
Finished iteration 47, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 47, CKPT_AND_STOP: False
Finished iteration 48, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 48, CKPT_AND_STOP: False
Finished iteration 49, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 49, CKPT_AND_STOP: False
Finished iteration 50, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 50, CKPT_AND_STOP: False
Finished iteration 51, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 51, CKPT_AND_STOP: False
Finished iteration 52, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 52, CKPT_AND_STOP: False
Finished iteration 53, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 53, CKPT_AND_STOP: False
Finished iteration 54, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 54, CKPT_AND_STOP: False
Finished iteration 55, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 55, CKPT_AND_STOP: False
Finished iteration 56, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 56, CKPT_AND_STOP: False
Finished iteration 57, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 57, CKPT_AND_STOP: False
Finished iteration 58, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 58, CKPT_AND_STOP: False
Finished iteration 59, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 59, CKPT_AND_STOP: False
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 1 signal handler called with signal 10
Finished iteration 60, CKPT_AND_STOP: True, flag: tensor([3], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 16.16901731491089
Process done with return code 0
Parent process ID: 18550 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 6 0 5940361.81640625 0
End of simulation:  Mini-batch time (usec) = 8725127
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164547, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 49 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 12 0 2836733.88671875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6512857
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82709, max long fwd 89657; min long bwd 149926, max long bwd 157738
Time taken by simulation: 207 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 21 0 1916562.744140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6803052
Min send: 10000000, max send 0
Min long send: 38109, max long send 62549
Min fwd: 45773, max fwd 59456; min bwd 92874, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 96930, max long bwd 106927
Time taken by simulation: 605 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 13 0 1338646.484375 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5132496
Min send: 10000000, max send 0
Min long send: 80953, max long send 103337
Min fwd: 48269, max fwd 59401; min bwd 107938, max bwd 126574
Min long fwd: 53770, max long fwd 60383; min long bwd 118672, max long bwd 125606
Time taken by simulation: 598 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 755 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1042 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1896 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 2119 microseconds

can't have 24 stages!
{1: 8.725127, 2: 6.512857, 3: 6.803052, 4: 5.132496, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.132496
5 per stage
20 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 5
stage to rank map: 0,4,8,12,16;1,5,9,13,17;2,6,10,14,18;3,7,11,15,19;
World size is 20
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16;1,5,9,13,17;2,6,10,14,18;3,7,11,15,19; --batch-size=25 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 60
device is' 0
dry run time 2.0862655639648438
SHARED WEIGHTS ARE
[(0, 3)]
this rank  1 is part of pipeline replica  0
13 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 83.065 seconds
START iteration 60, CKPT_AND_STOP: False
Finished iteration 61, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 61, CKPT_AND_STOP: False
Finished iteration 62, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 62, CKPT_AND_STOP: False
Finished iteration 63, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 63, CKPT_AND_STOP: False
Finished iteration 64, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 64, CKPT_AND_STOP: False
Finished iteration 65, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 65, CKPT_AND_STOP: False
Finished iteration 66, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 66, CKPT_AND_STOP: False
Finished iteration 67, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 67, CKPT_AND_STOP: False
Finished iteration 68, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 68, CKPT_AND_STOP: False
Finished iteration 69, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 69, CKPT_AND_STOP: False
Finished iteration 70, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 70, CKPT_AND_STOP: False
Finished iteration 71, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 71, CKPT_AND_STOP: False
Finished iteration 72, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 72, CKPT_AND_STOP: False
Finished iteration 73, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 73, CKPT_AND_STOP: False
Finished iteration 74, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 74, CKPT_AND_STOP: False
Finished iteration 75, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 75, CKPT_AND_STOP: False
Finished iteration 76, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 76, CKPT_AND_STOP: False
Finished iteration 77, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 77, CKPT_AND_STOP: False
Finished iteration 78, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 78, CKPT_AND_STOP: False
Finished iteration 79, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 79, CKPT_AND_STOP: False
Finished iteration 80, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 80, CKPT_AND_STOP: False
Finished iteration 81, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 81, CKPT_AND_STOP: False
Finished iteration 82, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 82, CKPT_AND_STOP: False
Finished iteration 83, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 83, CKPT_AND_STOP: False
Finished iteration 84, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 84, CKPT_AND_STOP: False
Finished iteration 85, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 85, CKPT_AND_STOP: False
Finished iteration 86, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 86, CKPT_AND_STOP: False
Finished iteration 87, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 87, CKPT_AND_STOP: False
Finished iteration 88, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 88, CKPT_AND_STOP: False
Finished iteration 89, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 89, CKPT_AND_STOP: False
Finished iteration 90, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 90, CKPT_AND_STOP: False
Finished iteration 91, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 91, CKPT_AND_STOP: False
Finished iteration 92, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 92, CKPT_AND_STOP: False
Finished iteration 93, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 93, CKPT_AND_STOP: False
Finished iteration 94, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 94, CKPT_AND_STOP: False
Finished iteration 95, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 95, CKPT_AND_STOP: False
Finished iteration 96, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 96, CKPT_AND_STOP: False
Finished iteration 97, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 97, CKPT_AND_STOP: False
Finished iteration 98, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 98, CKPT_AND_STOP: False
Finished iteration 99, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 99, CKPT_AND_STOP: False
Finished iteration 100, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 100, CKPT_AND_STOP: False
Finished iteration 101, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 101, CKPT_AND_STOP: False
Finished iteration 102, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 102, CKPT_AND_STOP: False
Finished iteration 103, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 103, CKPT_AND_STOP: False
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 104, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 104, CKPT_AND_STOP: False
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 105, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 105, CKPT_AND_STOP: False
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 106, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 106, CKPT_AND_STOP: False
1 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 107, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 107, CKPT_AND_STOP: False
Finished iteration 108, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 108, CKPT_AND_STOP: False
Finished iteration 109, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 109, CKPT_AND_STOP: False
Finished iteration 110, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 110, CKPT_AND_STOP: False
Finished iteration 111, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 111, CKPT_AND_STOP: False
Finished iteration 112, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 112, CKPT_AND_STOP: False
Finished iteration 113, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 113, CKPT_AND_STOP: False
Finished iteration 114, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 114, CKPT_AND_STOP: False
Finished iteration 115, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 115, CKPT_AND_STOP: False
Finished iteration 116, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 116, CKPT_AND_STOP: False
Finished iteration 117, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 117, CKPT_AND_STOP: False
Finished iteration 118, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 118, CKPT_AND_STOP: False
Finished iteration 119, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 119, CKPT_AND_STOP: False
Finished iteration 120, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 120, CKPT_AND_STOP: False
Finished iteration 121, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 121, CKPT_AND_STOP: False
Finished iteration 122, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 122, CKPT_AND_STOP: False
Finished iteration 123, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 123, CKPT_AND_STOP: False
Finished iteration 124, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 124, CKPT_AND_STOP: False
Finished iteration 125, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 125, CKPT_AND_STOP: False
Finished iteration 126, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 126, CKPT_AND_STOP: False
Finished iteration 127, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 127, CKPT_AND_STOP: False
Finished iteration 128, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 128, CKPT_AND_STOP: False
Finished iteration 129, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 129, CKPT_AND_STOP: False
Finished iteration 130, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 130, CKPT_AND_STOP: False
Finished iteration 131, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 131, CKPT_AND_STOP: False
Finished iteration 132, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 132, CKPT_AND_STOP: False
Finished iteration 133, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 133, CKPT_AND_STOP: False
Finished iteration 134, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 134, CKPT_AND_STOP: False
Finished iteration 135, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 135, CKPT_AND_STOP: False
Finished iteration 136, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 136, CKPT_AND_STOP: False
Finished iteration 137, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 137, CKPT_AND_STOP: False
Finished iteration 138, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 138, CKPT_AND_STOP: False
Finished iteration 139, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 139, CKPT_AND_STOP: False
Finished iteration 140, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 140, CKPT_AND_STOP: False
Finished iteration 141, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 141, CKPT_AND_STOP: False
Finished iteration 142, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 142, CKPT_AND_STOP: False
Finished iteration 143, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 143, CKPT_AND_STOP: False
Finished iteration 144, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 144, CKPT_AND_STOP: False
Finished iteration 145, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 145, CKPT_AND_STOP: False
Finished iteration 146, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 146, CKPT_AND_STOP: False
Finished iteration 147, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 147, CKPT_AND_STOP: False
Finished iteration 148, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 148, CKPT_AND_STOP: False
Finished iteration 149, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 149, CKPT_AND_STOP: False
Finished iteration 150, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 150, CKPT_AND_STOP: False
Finished iteration 151, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 151, CKPT_AND_STOP: False
Finished iteration 152, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 152, CKPT_AND_STOP: False
Finished iteration 153, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 153, CKPT_AND_STOP: False
Finished iteration 154, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 154, CKPT_AND_STOP: False
Finished iteration 155, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 155, CKPT_AND_STOP: False
Finished iteration 156, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 156, CKPT_AND_STOP: False
Finished iteration 157, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 157, CKPT_AND_STOP: False
Finished iteration 158, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 158, CKPT_AND_STOP: False
Finished iteration 159, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 159, CKPT_AND_STOP: False
Finished iteration 160, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 160, CKPT_AND_STOP: False
Finished iteration 161, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 161, CKPT_AND_STOP: False
Finished iteration 162, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 162, CKPT_AND_STOP: False
Finished iteration 163, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 163, CKPT_AND_STOP: False
Finished iteration 164, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 164, CKPT_AND_STOP: False
Finished iteration 165, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 165, CKPT_AND_STOP: False
Finished iteration 166, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 166, CKPT_AND_STOP: False
Finished iteration 167, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 167, CKPT_AND_STOP: False
Finished iteration 168, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 168, CKPT_AND_STOP: False
Finished iteration 169, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 169, CKPT_AND_STOP: False
Finished iteration 170, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 170, CKPT_AND_STOP: False
Finished iteration 171, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 171, CKPT_AND_STOP: False
Finished iteration 172, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 172, CKPT_AND_STOP: False
Finished iteration 173, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 173, CKPT_AND_STOP: False
Finished iteration 174, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 174, CKPT_AND_STOP: False
Finished iteration 175, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 175, CKPT_AND_STOP: False
Finished iteration 176, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 176, CKPT_AND_STOP: False
Finished iteration 177, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 177, CKPT_AND_STOP: False
Finished iteration 178, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 178, CKPT_AND_STOP: False
Finished iteration 179, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 179, CKPT_AND_STOP: False
Finished iteration 180, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 180, CKPT_AND_STOP: False
Finished iteration 181, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 181, CKPT_AND_STOP: False
Finished iteration 182, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 182, CKPT_AND_STOP: False
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 1 signal handler called with signal 10
Finished iteration 183, CKPT_AND_STOP: True, flag: tensor([2], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 11.279009103775024
Process done with return code 0
Parent process ID: 20341 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 9 0 5592122.55859375 0
End of simulation:  Mini-batch time (usec) = 9770154
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164303, max long fwd 168896; min long bwd 294106, max long bwd 302385
Time taken by simulation: 83 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 21 0 2732766.6015625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 9192802
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82380, max long fwd 89657; min long bwd 149642, max long bwd 157738
Time taken by simulation: 341 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 32 0 1527054.19921875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 8830859
Min send: 10000000, max send 0
Min long send: 38055, max long send 61744
Min fwd: 45773, max fwd 61214; min bwd 93190, max bwd 104086
Min long fwd: 56519, max long fwd 64913; min long bwd 96534, max long bwd 106927
Time taken by simulation: 950 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 21 0 1050667.96875 80871.45884831746
End of simulation:  Mini-batch time (usec) = 6512804
Min send: 10000000, max send 0
Min long send: 80871, max long send 103337
Min fwd: 47099, max fwd 59401; min bwd 106731, max bwd 128252
Min long fwd: 54031, max long fwd 62603; min long bwd 118588, max long bwd 125970
Time taken by simulation: 914 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 16 0 548680.6640625 159635.3450129109
End of simulation:  Mini-batch time (usec) = 7062870
Min send: 10000000, max send 0
Min long send: 159689, max long send 182101
Min fwd: 52659, max fwd 63293; min bwd 123973, max bwd 139940
Min long fwd: 73341, max long fwd 81486; min long bwd 146196, max long bwd 154690
Time taken by simulation: 1115 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 22 0 0 230166.85465330718
End of simulation:  Mini-batch time (usec) = 10536264
Min send: 10000000, max send 0
Min long send: 230303, max long send 257328
Min fwd: 54967, max fwd 67591; min bwd 130849, max bwd 143444
Min long fwd: 78331, max long fwd 89630; min long bwd 156920, max long bwd 164176
Time taken by simulation: 2156 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1936 microseconds

can't have 16 stages!
can't have 24 stages!
{1: 9.770154, 2: 9.192802, 3: 8.830859, 4: 6.512804, 6: 7.06287, 8: 10.536264, 12: 15.020502}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10}
best config is: 4 2
expected time is 6.512804
3 per stage
12 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 3
stage to rank map: 0,4,8;1,5,9;2,6,10;3,7,11;
World size is 12
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8;1,5,9;2,6,10;3,7,11; --batch-size=42 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 183
device is' 0
dry run time 1.5798413753509521
SHARED WEIGHTS ARE
[(0, 3)]
this rank  1 is part of pipeline replica  0
21 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 86.724 seconds
START iteration 183, CKPT_AND_STOP: False
Finished iteration 184, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 184, CKPT_AND_STOP: False
Finished iteration 185, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 185, CKPT_AND_STOP: False
Finished iteration 186, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 186, CKPT_AND_STOP: False
Finished iteration 187, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 187, CKPT_AND_STOP: False
Finished iteration 188, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 188, CKPT_AND_STOP: False
Finished iteration 189, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 189, CKPT_AND_STOP: False
Finished iteration 190, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 190, CKPT_AND_STOP: False
Finished iteration 191, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 191, CKPT_AND_STOP: False
Finished iteration 192, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 192, CKPT_AND_STOP: False
Finished iteration 193, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 193, CKPT_AND_STOP: False
Finished iteration 194, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 194, CKPT_AND_STOP: False
Finished iteration 195, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 195, CKPT_AND_STOP: False
Finished iteration 196, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 196, CKPT_AND_STOP: False
Finished iteration 197, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 197, CKPT_AND_STOP: False
Finished iteration 198, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 198, CKPT_AND_STOP: False
Finished iteration 199, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 199, CKPT_AND_STOP: False
Finished iteration 200, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 200, CKPT_AND_STOP: False
Finished iteration 201, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 201, CKPT_AND_STOP: False
Finished iteration 202, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 202, CKPT_AND_STOP: False
Finished iteration 203, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 203, CKPT_AND_STOP: False
Finished iteration 204, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 204, CKPT_AND_STOP: False
Finished iteration 205, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 205, CKPT_AND_STOP: False
Finished iteration 206, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 206, CKPT_AND_STOP: False
Finished iteration 207, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 207, CKPT_AND_STOP: False
Finished iteration 208, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 208, CKPT_AND_STOP: False
Finished iteration 209, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 209, CKPT_AND_STOP: False
Finished iteration 210, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 210, CKPT_AND_STOP: False
Finished iteration 211, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 211, CKPT_AND_STOP: False
Finished iteration 212, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 212, CKPT_AND_STOP: False
Finished iteration 213, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 213, CKPT_AND_STOP: False
Finished iteration 214, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 214, CKPT_AND_STOP: False
Finished iteration 215, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 215, CKPT_AND_STOP: False
Finished iteration 216, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 216, CKPT_AND_STOP: False
Finished iteration 217, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 217, CKPT_AND_STOP: False
Finished iteration 218, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 218, CKPT_AND_STOP: False
Finished iteration 219, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 219, CKPT_AND_STOP: False
Finished iteration 220, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 220, CKPT_AND_STOP: False
Finished iteration 221, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 221, CKPT_AND_STOP: False
Finished iteration 222, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 222, CKPT_AND_STOP: False
Finished iteration 223, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 223, CKPT_AND_STOP: False
Finished iteration 224, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 224, CKPT_AND_STOP: False
Finished iteration 225, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 225, CKPT_AND_STOP: False
Finished iteration 226, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 226, CKPT_AND_STOP: False
Finished iteration 227, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 227, CKPT_AND_STOP: False
Finished iteration 228, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 228, CKPT_AND_STOP: False
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 1 signal handler called with signal 10
Finished iteration 229, CKPT_AND_STOP: True, flag: tensor([4], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 18.079923391342163
Process done with return code 0
Parent process ID: 21768 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 9 0 5880609.86328125 0
End of simulation:  Mini-batch time (usec) = 10058641
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164303, max long fwd 168896; min long bwd 294106, max long bwd 302385
Time taken by simulation: 55 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 18 0 2725911.1328125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 8250798
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82380, max long fwd 89657; min long bwd 149642, max long bwd 157738
Time taken by simulation: 296 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 32 0 1527054.19921875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 8830859
Min send: 10000000, max send 0
Min long send: 38055, max long send 61744
Min fwd: 45773, max fwd 61214; min bwd 93190, max bwd 104086
Min long fwd: 56519, max long fwd 64913; min long bwd 96534, max long bwd 106927
Time taken by simulation: 911 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 21 0 1050667.96875 80871.45884831746
End of simulation:  Mini-batch time (usec) = 6512804
Min send: 10000000, max send 0
Min long send: 80871, max long send 103337
Min fwd: 47099, max fwd 59401; min bwd 106731, max bwd 128252
Min long fwd: 54031, max long fwd 62603; min long bwd 118588, max long bwd 125970
Time taken by simulation: 917 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 16 0 548680.6640625 159635.3450129109
End of simulation:  Mini-batch time (usec) = 7062870
Min send: 10000000, max send 0
Min long send: 159689, max long send 182101
Min fwd: 52659, max fwd 63293; min bwd 123973, max bwd 139940
Min long fwd: 73341, max long fwd 81486; min long bwd 146196, max long bwd 154690
Time taken by simulation: 1128 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 22 0 0 230166.85465330718
End of simulation:  Mini-batch time (usec) = 10536264
Min send: 10000000, max send 0
Min long send: 230303, max long send 257328
Min fwd: 54967, max fwd 67591; min bwd 130849, max bwd 143444
Min long fwd: 78331, max long fwd 89630; min long bwd 156920, max long bwd 164176
Time taken by simulation: 2198 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1929 microseconds

can't have 16 stages!
can't have 24 stages!
{1: 10.058641, 2: 8.250798, 3: 8.830859, 4: 6.512804, 6: 7.06287, 8: 10.536264, 12: 15.020502}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10}
best config is: 4 2
expected time is 6.512804
3 per stage
12 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 3
stage to rank map: 0,4,8;1,5,9;2,6,10;3,7,11;
World size is 12
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8;1,5,9;2,6,10;3,7,11; --batch-size=42 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 229
Signal handler called with signal 10


 STOPPING VARUNA !!



Parent process ID: 22110 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 6 0 6165271.97265625 0
End of simulation:  Mini-batch time (usec) = 8950037
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164547, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 50 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 14 0 2816083.251953125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 7191944
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82709, max long fwd 89657; min long bwd 149926, max long bwd 157738
Time taken by simulation: 286 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 21 0 1916562.744140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6803052
Min send: 10000000, max send 0
Min long send: 38109, max long send 62549
Min fwd: 45773, max fwd 59456; min bwd 92874, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 96930, max long bwd 106927
Time taken by simulation: 607 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 16 0 1199719.8486328125 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5670469
Min send: 10000000, max send 0
Min long send: 80925, max long send 104560
Min fwd: 47855, max fwd 59401; min bwd 106211, max bwd 126925
Min long fwd: 52606, max long fwd 62603; min long bwd 118442, max long bwd 125606
Time taken by simulation: 696 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 826 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1044 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1945 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1929 microseconds

can't have 24 stages!
{1: 8.950037, 2: 7.191944, 3: 6.803052, 4: 5.670469, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.670469
4 per stage
16 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 4
stage to rank map: 0,4,8,12;1,5,9,13;2,6,10,14;3,7,11,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12;1,5,9,13;2,6,10,14;3,7,11,15; --batch-size=32 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 229
Parent process ID: 22369 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 6 0 6165271.97265625 0
End of simulation:  Mini-batch time (usec) = 8950037
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164547, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 58 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 14 0 2816083.251953125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 7191944
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82709, max long fwd 89657; min long bwd 149926, max long bwd 157738
Time taken by simulation: 237 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 21 0 1916562.744140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6803052
Min send: 10000000, max send 0
Min long send: 38109, max long send 62549
Min fwd: 45773, max fwd 59456; min bwd 92874, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 96930, max long bwd 106927
Time taken by simulation: 669 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 16 0 1199719.8486328125 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5670469
Min send: 10000000, max send 0
Min long send: 80925, max long send 104560
Min fwd: 47855, max fwd 59401; min bwd 106211, max bwd 126925
Min long fwd: 52606, max long fwd 62603; min long bwd 118442, max long bwd 125606
Time taken by simulation: 703 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 757 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1087 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1890 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1967 microseconds

can't have 24 stages!
{1: 8.950037, 2: 7.191944, 3: 6.803052, 4: 5.670469, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.670469
4 per stage
16 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 4
stage to rank map: 0,4,8,12;1,5,9,13;2,6,10,14;3,7,11,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12;1,5,9,13;2,6,10,14;3,7,11,15; --batch-size=32 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 229
Process done with return code 1
Parent process ID: 22637 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 8 0 5758860.83984375 0
End of simulation:  Mini-batch time (usec) = 9470530
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164303, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 54 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 18 0 2725911.1328125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 8250798
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82380, max long fwd 89657; min long bwd 149642, max long bwd 157738
Time taken by simulation: 300 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 25 0 1731851.1962890625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 7585451
Min send: 10000000, max send 0
Min long send: 38055, max long send 64155
Min fwd: 45773, max fwd 59456; min bwd 92460, max bwd 103910
Min long fwd: 56519, max long fwd 64913; min long bwd 96930, max long bwd 104722
Time taken by simulation: 724 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 21 0 1050667.96875 80871.45884831746
End of simulation:  Mini-batch time (usec) = 6512804
Min send: 10000000, max send 0
Min long send: 80871, max long send 103337
Min fwd: 47099, max fwd 59401; min bwd 106731, max bwd 128252
Min long fwd: 54031, max long fwd 62603; min long bwd 118588, max long bwd 125970
Time taken by simulation: 946 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 16 0 548680.6640625 159635.3450129109
End of simulation:  Mini-batch time (usec) = 7062870
Min send: 10000000, max send 0
Min long send: 159689, max long send 182101
Min fwd: 52659, max fwd 63293; min bwd 123973, max bwd 139940
Min long fwd: 73341, max long fwd 81486; min long bwd 146196, max long bwd 154690
Time taken by simulation: 1119 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 22 0 0 230166.85465330718
End of simulation:  Mini-batch time (usec) = 10536264
Min send: 10000000, max send 0
Min long send: 230303, max long send 257328
Min fwd: 54967, max fwd 67591; min bwd 130849, max bwd 143444
Min long fwd: 78331, max long fwd 89630; min long bwd 156920, max long bwd 164176
Time taken by simulation: 2200 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1905 microseconds

can't have 16 stages!
can't have 24 stages!
{1: 9.47053, 2: 8.250798, 3: 7.585451, 4: 6.512804, 6: 7.06287, 8: 10.536264, 12: 15.020502}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10}
best config is: 4 2
expected time is 6.512804
3 per stage
12 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 3
stage to rank map: 0,4,8;1,5,9;2,6,10;3,7,11;
World size is 12
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8;1,5,9;2,6,10;3,7,11; --batch-size=42 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 229
Process done with return code 1
Parent process ID: 22893 node: 172.31.12.208
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 8 0 5758860.83984375 0
End of simulation:  Mini-batch time (usec) = 9470530
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164303, max long fwd 168133; min long bwd 294106, max long bwd 302385
Time taken by simulation: 62 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 18 0 2725911.1328125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 8250798
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 76538, max fwd 84520; min bwd 141071, max bwd 148651
Min long fwd: 82380, max long fwd 89657; min long bwd 149642, max long bwd 157738
Time taken by simulation: 303 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 25 0 1731851.1962890625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 7585451
Min send: 10000000, max send 0
Min long send: 38055, max long send 64155
Min fwd: 45773, max fwd 59456; min bwd 92460, max bwd 103910
Min long fwd: 56519, max long fwd 64913; min long bwd 96930, max long bwd 104722
Time taken by simulation: 717 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 21 0 1050667.96875 80871.45884831746
End of simulation:  Mini-batch time (usec) = 6512804
Min send: 10000000, max send 0
Min long send: 80871, max long send 103337
Min fwd: 47099, max fwd 59401; min bwd 106731, max bwd 128252
Min long fwd: 54031, max long fwd 62603; min long bwd 118588, max long bwd 125970
Time taken by simulation: 916 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 16 0 548680.6640625 159635.3450129109
End of simulation:  Mini-batch time (usec) = 7062870
Min send: 10000000, max send 0
Min long send: 159689, max long send 182101
Min fwd: 52659, max fwd 63293; min bwd 123973, max bwd 139940
Min long fwd: 73341, max long fwd 81486; min long bwd 146196, max long bwd 154690
Time taken by simulation: 1132 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 22 0 0 230166.85465330718
End of simulation:  Mini-batch time (usec) = 10536264
Min send: 10000000, max send 0
Min long send: 230303, max long send 257328
Min fwd: 54967, max fwd 67591; min bwd 130849, max bwd 143444
Min long fwd: 78331, max long fwd 89630; min long bwd 156920, max long bwd 164176
Time taken by simulation: 2190 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1929 microseconds

can't have 16 stages!
can't have 24 stages!
{1: 9.47053, 2: 8.250798, 3: 7.585451, 4: 6.512804, 6: 7.06287, 8: 10.536264, 12: 15.020502}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10}
best config is: 4 2
expected time is 6.512804
3 per stage
12 servers!
Config:
ranks: range(1, 2)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 3
stage to rank map: 0,4,8;1,5,9;2,6,10;3,7,11;
World size is 12
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=1 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8;1,5,9;2,6,10;3,7,11; --batch-size=42 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 229
Process done with return code 1
