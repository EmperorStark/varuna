Parent process ID: 30809 node: 172.31.15.67
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 5 0 6125747.0703125 0
End of simulation:  Mini-batch time (usec) = 8451860
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164718, max long fwd 168133; min long bwd 296265, max long bwd 302385
Time taken by simulation: 44 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 11 0 2767979.736328125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6203240
Min send: 10000000, max send 0
Min long send: 38387, max long send 62760
Min fwd: 76538, max fwd 83279; min bwd 142710, max bwd 147733
Min long fwd: 81915, max long fwd 89657; min long bwd 148530, max long bwd 156110
Time taken by simulation: 202 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 18 0 1846814.0869140625 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5987018
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 45773, max fwd 59834; min bwd 93871, max bwd 104244
Min long fwd: 57033, max long fwd 64913; min long bwd 98140, max long bwd 103204
Time taken by simulation: 532 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 13 0 1338646.484375 80871.45884831746
End of simulation:  Mini-batch time (usec) = 5132496
Min send: 10000000, max send 0
Min long send: 80953, max long send 103337
Min fwd: 48269, max fwd 59401; min bwd 107938, max bwd 126574
Min long fwd: 53770, max long fwd 60383; min long bwd 118672, max long bwd 125606
Time taken by simulation: 603 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 11 0 770127.8076171875 159635.3450129109
End of simulation:  Mini-batch time (usec) = 6157105
Min send: 10000000, max send 0
Min long send: 159689, max long send 184340
Min fwd: 52659, max fwd 63832; min bwd 123243, max bwd 140240
Min long fwd: 72998, max long fwd 78841; min long bwd 148211, max long bwd 154022
Time taken by simulation: 761 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 11 0 442992.24853515625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 8313990
Min send: 10000000, max send 0
Min long send: 230166, max long send 255370
Min fwd: 54051, max fwd 66033; min bwd 132265, max bwd 140978
Min long fwd: 81808, max long fwd 89347; min long bwd 157650, max long bwd 164467
Time taken by simulation: 1034 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 13 0 0 361377.8571928701
End of simulation:  Mini-batch time (usec) = 15020502
Min send: 10000000, max send 0
Min long send: 361431, max long send 386584
Min fwd: 61398, max fwd 73009; min bwd 138510, max bwd 150849
Min long fwd: 109818, max long fwd 116156; min long bwd 179680, max long bwd 186710
Time taken by simulation: 1932 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1920 microseconds

can't have 24 stages!
{1: 8.45186, 2: 6.20324, 3: 5.987018, 4: 5.132496, 6: 6.157105, 8: 8.31399, 12: 15.020502, 16: 20.148929}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13}
best config is: 4 2
expected time is 5.132496
5 per stage
20 servers!
20 20 I am of no use!
Parent process ID: 31166 node: 172.31.15.67
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 5 0 5671273.4375 0
End of simulation:  Mini-batch time (usec) = 7997386
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 164718, max long fwd 168133; min long bwd 296265, max long bwd 302385
Time taken by simulation: 49 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 10 0 2977483.88671875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 6172069
Min send: 10000000, max send 0
Min long send: 38387, max long send 59301
Min fwd: 77133, max fwd 85384; min bwd 141071, max bwd 148651
Min long fwd: 83859, max long fwd 89657; min long bwd 148892, max long bwd 154838
Time taken by simulation: 179 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 16 0 2198285.64453125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5986016
Min send: 10000000, max send 0
Min long send: 38293, max long send 60521
Min fwd: 45773, max fwd 59456; min bwd 93556, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 97741, max long bwd 104518
Time taken by simulation: 469 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 11 0 1478731.4453125 80871.45884831746
End of simulation:  Mini-batch time (usec) = 4902207
Min send: 10000000, max send 0
Min long send: 81109, max long send 105576
Min fwd: 49725, max fwd 58709; min bwd 110370, max bwd 129008
Min long fwd: 53770, max long fwd 59495; min long bwd 117692, max long bwd 125606
Time taken by simulation: 485 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 8 0 876895.5078125 159635.3450129109
End of simulation:  Mini-batch time (usec) = 5601136
Min send: 10000000, max send 0
Min long send: 159772, max long send 184340
Min fwd: 53241, max fwd 62601; min bwd 123697, max bwd 141328
Min long fwd: 72998, max long fwd 79077; min long bwd 148883, max long bwd 151161
Time taken by simulation: 555 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 7 0 610855.46875 230166.85465330718
End of simulation:  Mini-batch time (usec) = 7505355
Min send: 10000000, max send 0
Min long send: 230248, max long send 254871
Min fwd: 56011, max fwd 66812; min bwd 129842, max bwd 141350
Min long fwd: 83341, max long fwd 88072; min long bwd 159951, max long bwd 163059
Time taken by simulation: 653 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 7 0 343797.36328125 361377.8571928701
End of simulation:  Mini-batch time (usec) = 13548777
Min send: 10000000, max send 0
Min long send: 361459, max long send 385871
Min fwd: 61802, max fwd 72928; min bwd 141491, max bwd 152040
Min long fwd: 108389, max long fwd 112365; min long bwd 179662, max long bwd 186130
Time taken by simulation: 984 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1915 microseconds

Stages 24
13 11546353561.599998
19 16037201817.599998
16 13791433625.599998
17 14539214745.599998
18 15288667033.599998
Predicted microbatch size for 24: 17
comm size 27852800
WARNING: no send time found, 24 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 24 8 0 0 548143.2004641461
End of simulation:  Mini-batch time (usec) = 33444830
Min send: 10000000, max send 0
Min long send: 548262, max long send 578147
Min fwd: 49763, max fwd 61192; min bwd 113823, max bwd 127856
Min long fwd: 124104, max long fwd 128023; min long bwd 187948, max long bwd 195033
Time taken by simulation: 2298 microseconds

{1: 7.997386, 2: 6.172069, 3: 5.986016, 4: 4.902207, 6: 5.601136, 8: 7.505355, 12: 13.548777, 16: 20.148929, 24: 33.44483}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13, 24: 17}
best config is: 4 2
expected time is 4.902207
6 per stage
24 servers!
Config:
ranks: range(20, 21)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 6
stage to rank map: 0,4,8,12,16,20;1,5,9,13,17,21;2,6,10,14,18,22;3,7,11,15,19,23;
World size is 24
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=20 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16,20;1,5,9,13,17,21;2,6,10,14,18,22;3,7,11,15,19,23; --batch-size=21 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 46
device is' 0
dry run time 1.4088616371154785
SHARED WEIGHTS ARE
[(0, 3)]
this rank  20 is part of pipeline replica  5
11 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 73.650 seconds
START iteration 46, CKPT_AND_STOP: False
Finished iteration 47, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 47, CKPT_AND_STOP: False
Finished iteration 48, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 48, CKPT_AND_STOP: False
Finished iteration 49, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 49, CKPT_AND_STOP: False
Finished iteration 50, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 50, CKPT_AND_STOP: False
Finished iteration 51, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 51, CKPT_AND_STOP: False
Finished iteration 52, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 52, CKPT_AND_STOP: False
Finished iteration 53, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 53, CKPT_AND_STOP: False
Finished iteration 54, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 54, CKPT_AND_STOP: False
Finished iteration 55, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 55, CKPT_AND_STOP: False
Finished iteration 56, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 56, CKPT_AND_STOP: False
Finished iteration 57, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 57, CKPT_AND_STOP: False
Finished iteration 58, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 58, CKPT_AND_STOP: False
Finished iteration 59, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 59, CKPT_AND_STOP: False
Finished iteration 60, CKPT_AND_STOP: False, flag: tensor([3], dtype=torch.int32)
Begin to save checkpont and exit
Opt ckpt time 9.772218227386475
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 20 signal handler called with signal 10
Process done with return code 0
