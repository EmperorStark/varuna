Parent process ID: 13540 node: 172.31.16.100
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 4 0 5914824.70703125 0
End of simulation:  Mini-batch time (usec) = 7779954
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 165849, max long fwd 168133; min long bwd 297881, max long bwd 302385
Time taken by simulation: 46 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 9 0 3040763.671875 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5992953
Min send: 10000000, max send 0
Min long send: 38387, max long send 59301
Min fwd: 78572, max fwd 83279; min bwd 141605, max bwd 146473
Min long fwd: 83859, max long fwd 89657; min long bwd 149487, max long bwd 154838
Time taken by simulation: 168 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 14 0 2006653.3203125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5367030
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 45773, max fwd 60689; min bwd 93028, max bwd 103910
Min long fwd: 57033, max long fwd 64913; min long bwd 98397, max long bwd 102857
Time taken by simulation: 417 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 9 0 1481951.2939453125 80871.45884831746
End of simulation:  Mini-batch time (usec) = 4325287
Min send: 10000000, max send 0
Min long send: 80953, max long send 103337
Min fwd: 48269, max fwd 58933; min bwd 108965, max bwd 128153
Min long fwd: 53770, max long fwd 61460; min long bwd 118329, max long bwd 124910
Time taken by simulation: 405 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 8 0 876895.5078125 159635.3450129109
End of simulation:  Mini-batch time (usec) = 5601136
Min send: 10000000, max send 0
Min long send: 159772, max long send 184340
Min fwd: 53241, max fwd 62601; min bwd 123697, max bwd 141328
Min long fwd: 72998, max long fwd 79077; min long bwd 148883, max long bwd 151161
Time taken by simulation: 557 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 7 0 610855.46875 230166.85465330718
End of simulation:  Mini-batch time (usec) = 7505355
Min send: 10000000, max send 0
Min long send: 230248, max long send 254871
Min fwd: 56011, max fwd 66812; min bwd 129842, max bwd 141350
Min long fwd: 83341, max long fwd 88072; min long bwd 159951, max long bwd 163059
Time taken by simulation: 703 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 7 0 343797.36328125 361377.8571928701
End of simulation:  Mini-batch time (usec) = 13548777
Min send: 10000000, max send 0
Min long send: 361459, max long send 385871
Min fwd: 61802, max fwd 72928; min bwd 141491, max bwd 152040
Min long fwd: 108389, max long fwd 112365; min long bwd 179662, max long bwd 186130
Time taken by simulation: 987 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 10 0 0 425876.58448885847
End of simulation:  Mini-batch time (usec) = 20148929
Min send: 10000000, max send 0
Min long send: 425930, max long send 455880
Min fwd: 58146, max fwd 69239; min bwd 134282, max bwd 149519
Min long fwd: 116097, max long fwd 122130; min long bwd 192822, max long bwd 197216
Time taken by simulation: 1984 microseconds

Stages 24
13 11546353561.599998
19 16037201817.599998
16 13791433625.599998
17 14539214745.599998
18 15288667033.599998
Predicted microbatch size for 24: 17
comm size 27852800
WARNING: no send time found, 24 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 24 8 0 0 548143.2004641461
End of simulation:  Mini-batch time (usec) = 33444830
Min send: 10000000, max send 0
Min long send: 548262, max long send 578147
Min fwd: 49763, max fwd 61192; min bwd 113823, max bwd 127856
Min long fwd: 124104, max long fwd 128023; min long bwd 187948, max long bwd 195033
Time taken by simulation: 2322 microseconds

{1: 7.779954, 2: 5.992953, 3: 5.36703, 4: 4.325287, 6: 5.601136, 8: 7.505355, 12: 13.548777, 16: 20.148929, 24: 33.44483}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13, 24: 17}
best config is: 4 2
expected time is 4.325287
7 per stage
28 servers!
Config:
ranks: range(5, 6)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 7
stage to rank map: 0,4,8,12,16,20,24;1,5,9,13,17,21,25;2,6,10,14,18,22,26;3,7,11,15,19,23,27;
World size is 28
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=5 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16,20,24;1,5,9,13,17,21,25;2,6,10,14,18,22,26;3,7,11,15,19,23,27; --batch-size=18 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 384
