Parent process ID: 9860 node: 172.31.30.99
48 cutpoints
Stages 1
13 179408597504.00003
7 107169514393.59993
4 71132724223.99994
2 45211359129.60004
Predicted microbatch size for 1: 1
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 4 0 5929368.65234375 0
End of simulation:  Mini-batch time (usec) = 7794498
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 165849, max long fwd 168133; min long bwd 297881, max long bwd 302385
Time taken by simulation: 47 microseconds

Stages 2
13 91326429286.39996
7 54442902425.59998
4 36011032883.20001
2 22710326886.4
Predicted microbatch size for 2: 1
comm size 1638400
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 8 0 3077126.220703125 38055.03383759529
End of simulation:  Mini-batch time (usec) = 5790316
Min send: 10000000, max send 0
Min long send: 38387, max long send 59301
Min fwd: 78572, max fwd 83279; min bwd 142710, max bwd 146473
Min long fwd: 83859, max long fwd 89657; min long bwd 149926, max long bwd 155487
Time taken by simulation: 162 microseconds

Stages 3
13 62378072166.39999
7 37276345241.600006
4 24698690662.400005
2 15681540915.199997
Predicted microbatch size for 3: 1
comm size 1638400
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 12 0 2007202.880859375 38055.03383759529
End of simulation:  Mini-batch time (usec) = 4913759
Min send: 10000000, max send 0
Min long send: 38387, max long send 60521
Min fwd: 45773, max fwd 58711; min bwd 92748, max bwd 103910
Min long fwd: 56704, max long fwd 63285; min long bwd 98353, max long bwd 106648
Time taken by simulation: 397 microseconds

Stages 4
13 47854723993.6
7 28643536588.800003
4 19017705369.600002
2 12167147929.599998
3 15282454937.599998
Predicted microbatch size for 4: 2
comm size 3276800
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 8 0 1727535.5224609375 80871.45884831746
End of simulation:  Mini-batch time (usec) = 4388856
Min send: 10000000, max send 0
Min long send: 80953, max long send 103337
Min fwd: 49388, max fwd 58933; min bwd 108965, max bwd 126220
Min long fwd: 54346, max long fwd 61460; min long bwd 117864, max long bwd 124737
Time taken by simulation: 363 microseconds

Stages 6
13 33331375820.800003
7 20010727936.0
4 13336720076.8
5 15504158822.400002
Predicted microbatch size for 6: 4
comm size 6553600
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 7 0 976051.4526367188 159635.3450129109
End of simulation:  Mini-batch time (usec) = 5456483
Min send: 10000000, max send 0
Min long send: 159823, max long send 184340
Min fwd: 53241, max fwd 62909; min bwd 126909, max bwd 138294
Min long fwd: 73111, max long fwd 78378; min long bwd 146710, max long bwd 150832
Time taken by simulation: 492 microseconds

Stages 8
13 26069701734.4
7 15694323609.6
4 10496227430.4
5 12173858304.0
6 13758925312.0
Predicted microbatch size for 8: 6
comm size 9830400
WARNING: no send time found, 8 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 8 6 0 700971.3134765625 230166.85465330718
End of simulation:  Mini-batch time (usec) = 7331814
Min send: 10000000, max send 0
Min long send: 230220, max long send 252632
Min fwd: 56260, max fwd 68296; min bwd 132173, max bwd 140938
Min long fwd: 83748, max long fwd 89792; min long bwd 161121, max long bwd 163883
Time taken by simulation: 556 microseconds

Stages 12
13 18808027648.0
7 11377919283.2
10 15096853196.8
11 16232151142.4
Predicted microbatch size for 12: 10
comm size 16384000
WARNING: no send time found, 12 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 12 7 0 343797.36328125 361377.8571928701
End of simulation:  Mini-batch time (usec) = 13548777
Min send: 10000000, max send 0
Min long send: 361459, max long send 385871
Min fwd: 61802, max fwd 72928; min bwd 141491, max bwd 152040
Min long fwd: 108389, max long fwd 112365; min long bwd 179662, max long bwd 186130
Time taken by simulation: 992 microseconds

Stages 16
13 15177190604.8
19 21144245452.8
16 18160685260.8
14 16174148608.0
Predicted microbatch size for 16: 13
comm size 21299200
WARNING: no send time found, 16 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 16 5 0 294405.0598144531 425876.58448885847
End of simulation:  Mini-batch time (usec) = 18896014
Min send: 10000000, max send 0
Min long send: 426064, max long send 450581
Min fwd: 56617, max fwd 69172; min bwd 133951, max bwd 148619
Min long fwd: 114363, max long fwd 122702; min long bwd 191828, max long bwd 196213
Time taken by simulation: 909 microseconds

Stages 24
13 11546353561.599998
19 16037201817.599998
16 13791433625.599998
17 14539214745.599998
18 15288667033.599998
Predicted microbatch size for 24: 17
comm size 27852800
WARNING: no send time found, 24 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 24 8 0 0 548143.2004641461
End of simulation:  Mini-batch time (usec) = 33444830
Min send: 10000000, max send 0
Min long send: 548262, max long send 578147
Min fwd: 49763, max fwd 61192; min bwd 113823, max bwd 127856
Min long fwd: 124104, max long fwd 128023; min long bwd 187948, max long bwd 195033
Time taken by simulation: 2274 microseconds

{1: 7.794498, 2: 5.790316, 3: 4.913759, 4: 4.388856, 6: 5.456483, 8: 7.331814, 12: 13.548777, 16: 18.896014, 24: 33.44483}
{1: 1, 2: 1, 3: 1, 4: 2, 6: 4, 8: 6, 12: 10, 16: 13, 24: 17}
best config is: 4 2
expected time is 4.388856
8 per stage
32 servers!
Config:
ranks: range(31, 32)
train batch size: 128
partitions: 4
chunk_size: 2
data depth: 8
stage to rank map: 0,4,8,12,16,20,24,28;1,5,9,13,17,21,25,29;2,6,10,14,18,22,26,30;3,7,11,15,19,23,27,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u pretrain_gpt2.py --rank=31 --chunk_size=2 --local_rank=0 --stage_to_rank_map=0,4,8,12,16,20,24,28;1,5,9,13,17,21,25,29;2,6,10,14,18,22,26,30;3,7,11,15,19,23,27,31; --batch-size=16 --num-layers 48 --hidden-size 1600 --num-attention-heads 25 --seq-length 1024 --max-position-embeddings 1024 --train-iters 18750 --lr-decay-iters 18750 --save s3://spot-checkpoints/gpt --load s3://spot-checkpoints/gpt --vocab-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/vocab.json --merge-file /home/ubuntu/SpotDL-DeesSpeed/megatron/Megatron-LM-v1.1.5-3D_parallelism/data/gpt2/merges.txt --data-impl mmap --split 949,50,1 --distributed-backend gloo --lr 0.00015 --min-lr 1.0e-5 --lr-decay-style cosine --weight-decay 1e-2 --clip-grad 1.0 --warmup .01 --log-interval 1 --exit-interval 10000 --save-interval 500 --eval-interval 10000 --use-cpu-initialization --synthetic --eval-iters 10 --varuna --fp16 --resume_step 384
dry run time 1.9928100109100342
SHARED WEIGHTS ARE
[(0, 3)]
this rank  31 is part of pipeline replica  7
8 chunks
Begin to load checkpoint from global store s3://spot-checkpoints/gpt
 > finished loading checkpoint in 52.983 seconds
START iteration 384, CKPT_AND_STOP: False
Finished iteration 385, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 385, CKPT_AND_STOP: False
Finished iteration 386, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 386, CKPT_AND_STOP: False
Finished iteration 387, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 387, CKPT_AND_STOP: False
Finished iteration 388, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 388, CKPT_AND_STOP: False
Finished iteration 389, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 389, CKPT_AND_STOP: False
Finished iteration 390, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32)
START iteration 390, CKPT_AND_STOP: False
Process done with return code 1
