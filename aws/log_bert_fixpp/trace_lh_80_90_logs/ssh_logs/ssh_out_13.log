Parent process ID: 12573 node: 172.31.21.45
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.12103009223937988
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Finished iteration 0, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 10684.976
Finished iteration 1, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5486.541
Finished iteration 2, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5495.745
Finished iteration 3, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5625.434
Finished iteration 4, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5427.131
Finished iteration 5, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4378.535
Finished iteration 6, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4498.399
Finished iteration 7, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4508.184
Finished iteration 8, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4371.452
Finished iteration 9, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4525.024
Finished iteration 10, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4216.232
Finished iteration 11, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4438.359
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 12, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4258.944
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 13, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4248.132
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 14, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4452.710
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 15, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4482.668
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 16, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4324.591
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 17, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4292.624
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 18, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4559.565
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 19, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5294.957
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 20, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4366.969
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 21, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4214.271
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 22, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4415.760
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 23, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4277.456
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 24, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4388.765
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 25, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4456.026
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 26, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4322.597
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 27, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4410.641
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 28, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4561.658
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 29, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4366.158
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 30, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4358.428
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 31, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4638.733
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 32, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4257.978
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 33, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4369.375
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 34, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4832.135
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 35, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4511.203
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 36, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4521.051
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 37, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4467.506
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 38, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4348.982
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 39, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4298.080
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 40, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4337.032
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 41, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4422.288
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 42, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4362.419
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 43, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4478.717
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 44, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4375.028
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 45, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4662.432
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 46, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4396.011
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 47, CKPT_AND_STOP: False, flag: tensor([3], dtype=torch.int32), speed: 4263.566
2022-11-23 14:43:19.362192 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 3.1970949172973633
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 13 signal handler called with signal 10
Process done with return code 0
Parent process ID: 13165 node: 172.31.21.45
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 48
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.004021167755126953
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_48.pt
2022-11-23 14:43:47.797053 resume step from  48
2022-11-23 14:43:54.893442 - Finished loading checkpoint, takes 7084.785 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 48, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 15765.421
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 49, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5290.531
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 50, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5416.952
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 51, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5334.976
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 52, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5550.823
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 53, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4425.569
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 54, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5012.170
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 55, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4371.204
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 56, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4263.064
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 57, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4197.688
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 58, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4202.664
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 59, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4489.410
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 60, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4358.539
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 61, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4389.043
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 62, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4735.161
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 63, CKPT_AND_STOP: False, flag: tensor([5], dtype=torch.int32), speed: 4347.308
2022-11-23 14:45:21.088510 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 3.2238070964813232
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 13 signal handler called with signal 10
Process done with return code 0
Parent process ID: 13726 node: 172.31.21.45
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 64
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.2363426685333252
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_64.pt
2022-11-23 14:45:49.281020 resume step from  64
2022-11-23 14:46:01.670767 - Finished loading checkpoint, takes 12378.149 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 64, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 15117.377
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 65, CKPT_AND_STOP: False, flag: tensor([5], dtype=torch.int32), speed: 5802.256
2022-11-23 14:46:22.632428 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 3.2591633796691895
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 13 signal handler called with signal 10
Process done with return code 0
Parent process ID: 14226 node: 172.31.21.45
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 66
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.1511683464050293
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_66.pt
2022-11-23 14:46:50.622683 resume step from  66
2022-11-23 14:46:57.700395 - Finished loading checkpoint, takes 7066.683 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 66, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 21157.431
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 67, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5467.611
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 68, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5709.057
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 69, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5755.358
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 70, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5467.919
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 71, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4322.544
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 72, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4308.421
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 73, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4279.818
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 74, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4458.679
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 75, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4304.482
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 76, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4330.636
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 77, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4257.361
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 78, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4307.438
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 79, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4239.868
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 80, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4337.159
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 81, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4384.809
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 82, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4352.660
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 83, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4165.175
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 84, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4387.300
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 85, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4289.397
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 86, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4403.875
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 87, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4337.436
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 88, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4501.070
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 89, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4357.446
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 90, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4361.670
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 91, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4574.676
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 92, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4419.103
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 93, CKPT_AND_STOP: False, flag: tensor([4], dtype=torch.int32), speed: 4340.366
2022-11-23 14:49:21.318519 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 4.041538238525391
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 13 signal handler called with signal 10
Process done with return code 0
Parent process ID: 14832 node: 172.31.21.45
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 94
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.10427284240722656
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_94.pt
2022-11-23 14:49:50.975421 resume step from  94
2022-11-23 14:49:57.853295 - Finished loading checkpoint, takes 6866.101 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 94, CKPT_AND_STOP: False, flag: tensor([2], dtype=torch.int32), speed: 21201.360
2022-11-23 14:50:19.093030 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 3.471708297729492
Signal handler called with signal 10


 STOPPING VARUNA !!



Rank 13 signal handler called with signal 10
Process done with return code 0
Parent process ID: 15332 node: 172.31.21.45
3 per stage
24 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 3
stage to rank map: 0,8,16;1,9,17;2,10,18;3,11,19;4,12,20;5,13,21;6,14,22;7,15,23;
World size is 24
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8,16;1,9,17;2,10,18;3,11,19;4,12,20;5,13,21;6,14,22;7,15,23; --batch-size=341 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 95
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.1998279094696045
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
43 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_95.pt
2022-11-23 14:50:50.860185 resume step from  95
2022-11-23 14:50:57.798101 - Finished loading checkpoint, takes 6926.240 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 95, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 16880.539
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 96, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4192.350
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 97, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4192.198
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 98, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4249.279
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 99, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4179.598
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 100, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3264.699
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 101, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3238.062
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 102, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3427.569
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 103, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3263.718
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 104, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3127.924
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 105, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3098.918
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 106, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3205.210
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 107, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3133.863
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 108, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3167.150
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 109, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3380.280
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 110, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3088.428
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 111, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3181.246
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 112, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3336.411
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 113, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3153.738
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 114, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3212.315
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 115, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3153.341
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 116, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3224.460
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 117, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3179.735
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 118, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3122.661
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 119, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3121.859
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 120, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3175.287
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 121, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3162.976
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 122, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3089.182
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 123, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3170.285
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 124, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3175.977
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 125, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4008.121
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 126, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3129.906
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 127, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3395.591
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 128, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3254.206
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 129, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3289.091
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 130, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3092.876
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 131, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3171.975
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 132, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3171.134
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 133, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3284.687
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 134, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3315.927
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 135, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3368.306
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 136, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3157.979
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 137, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3173.912
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 138, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3230.341
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 139, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3947.712
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 140, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3201.075
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 141, CKPT_AND_STOP: False, flag: tensor([1], dtype=torch.int32), speed: 3198.055
2022-11-23 14:53:47.781015 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 2.9218294620513916
Process done with return code 0
Parent process ID: 12984 node: 172.31.24.191
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 142
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.12366390228271484
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_142.pt
2022-11-23 14:54:22.019796 resume step from  142
2022-11-23 14:54:30.196180 - Finished loading checkpoint, takes 8165.197 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 142, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 20433.941
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 143, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5308.577
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 144, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5364.724
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 145, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5468.266
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 146, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5312.169
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 147, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4520.078
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 148, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4417.217
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 149, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4490.100
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 150, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4447.274
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 151, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4419.867
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 152, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4532.109
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 153, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4301.171
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 154, CKPT_AND_STOP: False, flag: tensor([1], dtype=torch.int32), speed: 4217.175
2022-11-23 14:55:47.468434 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 3.446746349334717
Signal handler called with signal 10


 STOPPING VARUNA !!



Process done with return code -10
Parent process ID: 8489 node: 172.31.21.137
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 155
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.1679847240447998
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_155.pt
2022-11-23 14:56:18.431428 resume step from  155
2022-11-23 14:56:25.412271 - Finished loading checkpoint, takes 6969.298 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 155, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 16402.871
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 156, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 6396.158
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 157, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5540.601
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 158, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5612.865
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 159, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5541.603
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 160, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4417.585
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 161, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4159.740
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 162, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4444.411
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 163, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4356.314
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 164, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4492.315
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 165, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4434.723
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 166, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4467.957
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 167, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5416.494
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 168, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4521.178
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 169, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4489.087
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 170, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4175.960
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 171, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4528.772
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 172, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4408.161
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 173, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4426.594
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 174, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4473.066
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 175, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4418.900
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 176, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4482.517
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 177, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4498.075
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 178, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4490.356
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 179, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4577.711
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 180, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4436.279
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 181, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4788.175
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 182, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4440.820
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 183, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4354.637
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 184, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4745.682
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 185, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4556.690
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 186, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4326.725
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 187, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4426.530
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 188, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4442.541
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 189, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4740.022
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 190, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4304.211
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 191, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4179.042
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 192, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4235.518
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 193, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4292.652
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 194, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4401.295
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 195, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4260.347
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 196, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4641.120
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 197, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4344.191
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 198, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4251.519
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 199, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4325.622
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 200, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4227.381
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 201, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4226.085
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 202, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4279.410
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 203, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4453.632
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 204, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4417.474
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 205, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4747.283
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 206, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5259.634
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 207, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4377.367
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 208, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4293.970
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 209, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4287.524
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 210, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4209.509
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 211, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4606.530
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 212, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4401.978
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 213, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4524.245
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 214, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5035.972
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 215, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4543.740
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 216, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4708.562
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 217, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4251.051
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 218, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4239.944
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 219, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4424.337
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 220, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4582.623
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 221, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4335.951
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 222, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4826.584
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 223, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4489.118
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 224, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4449.553
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 225, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4487.808
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 226, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4261.584
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 227, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4402.449
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 228, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4485.980
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 229, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4547.592
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 230, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4302.766
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 231, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4148.133
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 232, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4322.048
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 233, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4367.970
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 234, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4445.715
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 235, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4196.494
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 236, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4270.822
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 237, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4323.689
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 238, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4297.425
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 239, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4445.411
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 240, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4368.129
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 241, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4534.178
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 242, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4451.674
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 243, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4721.432
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 244, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4448.154
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 245, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4396.474
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 246, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4451.506
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 247, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4360.729
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 248, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4483.619
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 249, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4182.791
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 250, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4162.134
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 251, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5038.612
Process done with return code -6
Parent process ID: 14380 node: 172.31.24.208
1 per stage
8 servers!
13 8 I am of no use!
Parent process ID: 14704 node: 172.31.24.208
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 193
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.2680628299713135
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_193.pt
2022-11-23 15:15:48.843964 resume step from  193
2022-11-23 15:15:54.419906 - Finished loading checkpoint, takes 5564.101 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 193, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 16676.476
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 194, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5454.117
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 195, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5179.448
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 196, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5350.291
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 197, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5423.894
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 198, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4096.863
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 199, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4213.188
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 200, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4345.682
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 201, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4333.075
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 202, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4285.128
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 203, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4343.043
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 204, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4092.408
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 205, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4243.670
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 206, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4083.686
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 207, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4277.276
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 208, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4171.709
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 209, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4515.043
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 210, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4278.439
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 211, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4187.877
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 212, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4287.347
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 213, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4111.414
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 214, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4099.576
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 215, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4262.892
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 216, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4108.563
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 217, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4234.458
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 218, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4261.892
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 219, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4113.978
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 220, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4239.327
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 221, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4463.770
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 222, CKPT_AND_STOP: False, flag: tensor([2], dtype=torch.int32), speed: 4176.332
2022-11-23 15:18:18.371217 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 3.1381406784057617
Process done with return code 0
Parent process ID: 15297 node: 172.31.24.208
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 223
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.05013442039489746
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_223.pt
2022-11-23 15:18:46.881196 resume step from  223
2022-11-23 15:18:53.808492 - Finished loading checkpoint, takes 6916.193 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 223, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 20791.539
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 224, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5328.026
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 225, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5298.802
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 226, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5192.486
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 227, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5258.948
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 228, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4405.869
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 229, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4337.911
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 230, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4174.967
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 231, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4237.016
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 232, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4241.729
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 233, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4238.007
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 234, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4259.423
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 235, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4114.042
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 236, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4348.396
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 237, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4167.012
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 238, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4235.016
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 239, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4216.245
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 240, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4249.018
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 241, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4055.932
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 242, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4242.891
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 243, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4368.775
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 244, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4183.450
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 245, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4188.419
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 246, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4344.760
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 247, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4196.504
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 248, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4311.723
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 249, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4207.826
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 250, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4192.782
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 251, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4251.283
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 252, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4205.700
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 253, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4278.121
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 254, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4095.643
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 255, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4134.583
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 256, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4100.583
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 257, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4120.687
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 258, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4332.284
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 259, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4347.446
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 260, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4188.239
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 261, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4384.023
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 262, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4245.025
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 263, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4308.530
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 264, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4283.633
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 265, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4126.141
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 266, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4343.342
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 267, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4179.566
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 268, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4345.873
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 269, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4262.247
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 270, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4274.768
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 271, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4369.922
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 272, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4221.337
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 273, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4205.262
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 274, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4270.751
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 275, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4193.755
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 276, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4221.869
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 277, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4142.809
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 278, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4085.693
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 279, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4244.275
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 280, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4147.949
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 281, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4250.138
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 282, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4384.780
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 283, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4166.940
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 284, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4171.286
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 285, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5243.707
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 286, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4374.345
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 287, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4255.888
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 288, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4330.297
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 289, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4147.785
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 290, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4301.249
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 291, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4249.020
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 292, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4123.982
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 293, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4357.247
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 294, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4157.146
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 295, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4343.647
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 296, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4134.174
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 297, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4328.099
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 298, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4153.237
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 299, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4266.829
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 300, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4239.616
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 301, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4372.755
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 302, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4460.348
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 303, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4602.192
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 304, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4630.653
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 305, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4160.715
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 306, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4254.490
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 307, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4266.928
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 308, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4191.606
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 309, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4176.935
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 310, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4127.931
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 311, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4168.558
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 312, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4260.205
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 313, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4082.094
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 314, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4467.765
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 315, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4243.716
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 316, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4202.569
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 317, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4159.741
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 318, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4160.492
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 319, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4157.361
Process done with return code 1
Parent process ID: 10814 node: 172.31.30.133
1 per stage
8 servers!
13 8 I am of no use!
Parent process ID: 11126 node: 172.31.30.133
2 per stage
16 servers!
Config:
ranks: range(13, 14)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 2
stage to rank map: 0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15;
World size is 16
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=13 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8;1,9;2,10;3,11;4,12;5,13;6,14;7,15; --batch-size=512 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 223
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.2228097915649414
SHARED WEIGHTS ARE
[(0, 7)]
this rank  13 is part of pipeline replica  1
64 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_223.pt
2022-11-23 15:26:44.300319 resume step from  223
2022-11-23 15:26:56.702475 - Finished loading checkpoint, takes 12391.124 secs
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 223, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 16539.769
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 224, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5307.816
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 225, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5295.238
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 226, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5232.524
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 227, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 5248.580
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 228, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4204.299
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 229, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4267.277
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 230, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4335.179
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 231, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4194.344
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 232, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4416.987
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 233, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4281.316
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 234, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4484.722
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 235, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4307.982
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 236, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4184.419
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 237, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4227.859
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 238, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4193.313
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 239, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4277.410
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 240, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4162.579
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 241, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4248.379
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 242, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4257.337
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 243, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4242.034
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 244, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4158.690
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 245, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4165.840
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 246, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4037.579
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 247, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4312.426
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 248, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4285.561
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 249, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4302.969
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 250, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4138.300
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 251, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4137.602
13 Overflow !!
13 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 252, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4069.185
