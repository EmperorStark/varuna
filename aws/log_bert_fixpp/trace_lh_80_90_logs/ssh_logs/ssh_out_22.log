Parent process ID: 7458 node: 172.31.26.140
2 per stage
16 servers!
22 16 I am of no use!
Parent process ID: 7778 node: 172.31.26.140
3 per stage
24 servers!
Config:
ranks: range(22, 23)
train batch size: 1024
partitions: 8
chunk_size: 8
data depth: 3
stage to rank map: 0,8,16;1,9,17;2,10,18;3,11,19;4,12,20;5,13,21;6,14,22;7,15,23;
World size is 24
/opt/conda/envs/varuna/bin/python -u /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/run_pretraining.py --rank=22 --chunk_size=8 --local_rank=0 --stage_to_rank_map=0,8,16;1,9,17;2,10,18;3,11,19;4,12,20;5,13,21;6,14,22;7,15,23; --batch-size=341 --input_dir=/hdf5_lower_case_1_seq_len_128_max_pred_20_masked_lm_prob_0.15_random_seed_12345_dupe_factor_5/wikicorpus_en/ --output_dir=s3://spot-checkpoints/bert --config_file=bert_config.json --bert_model=bert-large-uncased --train_batch_size=1024 --max_seq_length=128 --max_predictions_per_seq=20 --max_steps=7038 --warmup_proportion=0.2843 --num_steps_per_checkpoint=200 --learning_rate=6e-3 --seed=12439 --fp16 --gradient_accumulation_steps=128 --allreduce_post_accumulation --allreduce_post_accumulation_fp16 --do_train --json-summary /home/ubuntu/varuna_examples/DeepLearningExamples/PyTorch/LanguageModeling/BERT/results/dllogger.json --varuna --resume_step 95
device: cuda:0 n_gpu: 1, distributed training: True, 16-bits training: True
dry run time 0.0054585933685302734
SHARED WEIGHTS ARE
[(0, 7)]
this rank  22 is part of pipeline replica  2
43 chunks
Begin to load checkpint from s3://spot-checkpoints/bert/ckpt_95.pt
2022-11-23 14:50:50.833472 resume step from  95
2022-11-23 14:50:57.633761 - Finished loading checkpoint, takes 6788.990 secs
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
Finished iteration 95, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 17048.437
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
Finished iteration 96, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4192.730
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
Finished iteration 97, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4192.025
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
Finished iteration 98, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4249.176
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
Finished iteration 99, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4179.633
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
Finished iteration 100, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3264.759
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
Finished iteration 101, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3237.849
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
Finished iteration 102, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3428.056
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
Finished iteration 103, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3263.666
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1024.0
Finished iteration 104, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3127.662
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  512.0
Finished iteration 105, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3099.367
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  256.0
Finished iteration 106, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3204.744
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  128.0
Finished iteration 107, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3133.979
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  64.0
Finished iteration 108, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3167.393
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  32.0
Finished iteration 109, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3380.035
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  16.0
Finished iteration 110, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3088.577
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  8.0
Finished iteration 111, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3181.178
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  4.0
Finished iteration 112, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3336.311
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  2.0
Finished iteration 113, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3153.804
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 114, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3212.435
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 115, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3153.148
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 116, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3224.701
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 117, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3179.400
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 118, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3122.773
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 119, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3122.022
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 120, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3175.140
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 121, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3163.048
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 122, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3088.845
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 123, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3170.688
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 124, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3175.961
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 125, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 4008.219
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 126, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3129.889
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 127, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3395.452
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 128, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3254.310
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 129, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3288.890
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 130, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3093.063
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 131, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3171.623
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 132, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3171.344
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 133, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3284.911
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 134, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3315.583
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 135, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3368.467
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 136, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3158.050
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 137, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3173.728
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 138, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3230.288
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 139, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3947.975
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 140, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 3200.928
22 Overflow !!
22 : update_scale(): _has_overflow, dynamic. _loss_scale =  1.0
Finished iteration 141, CKPT_AND_STOP: False, flag: tensor([1], dtype=torch.int32), speed: 3198.001
2022-11-23 14:53:47.779928 Begin to save checkpont to s3://spot-checkpoints/bert and exit
Opt ckpt time 2.727006196975708
Process done with return code 0
