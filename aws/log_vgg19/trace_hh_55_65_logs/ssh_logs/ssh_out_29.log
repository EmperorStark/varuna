Parent process ID: 116104 node: 172.31.30.89
12 cutpoints
Stages 1
Micro-bs 32 Max mem: 8350516326.4
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 2 0 1199922.1801757812 0
End of simulation:  Mini-batch time (usec) = 1424058
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 32586, max long fwd 32895; min long bwd 78677, max long bwd 79978
Time taken by simulation: 37 microseconds

Stages 2
Micro-bs 32 Max mem: 5185528320.0
Predicted microbatch size for 2: 32
comm size 12845056
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 4 0 22892.793655395508 541471.8854995001
End of simulation:  Mini-batch time (usec) = 1466822
Min send: 10000000, max send 0
Min long send: 541803, max long send 554555
Min fwd: 21083, max fwd 25575; min bwd 48477, max bwd 54184
Min long fwd: 7473, max long fwd 14307; min long bwd 25716, max long bwd 30607
Time taken by simulation: 101 microseconds

Stages 3
Micro-bs 32 Max mem: 4313669017.6
Predicted microbatch size for 3: 32
comm size 25690112
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 7 0 7540.138721466064 929913.8118823369
End of simulation:  Mini-batch time (usec) = 4955939
Min send: 10000000, max send 0
Min long send: 930245, max long send 945608
Min fwd: 8775, max fwd 19684; min bwd 24478, max bwd 41849
Min long fwd: 2259, max long fwd 7334; min long bwd 12226, max long bwd 16590
Time taken by simulation: 230 microseconds

Stages 4
Micro-bs 32 Max mem: 3762429747.2
Predicted microbatch size for 4: 32
comm size 25690112
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 8 0 3659.188747406006 929913.8118823369
End of simulation:  Mini-batch time (usec) = 6836714
Min send: 10000000, max send 0
Min long send: 929995, max long send 954618
Min fwd: 4418, max fwd 15941; min bwd 13005, max bwd 30581
Min long fwd: 989, max long fwd 6784; min long bwd 7050, max long bwd 13429
Time taken by simulation: 372 microseconds

Stages 6
Micro-bs 32 Max mem: 3200148889.6
Predicted microbatch size for 6: 32
comm size 12845056
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 13 0 1801.1889457702637 541471.8854995001
End of simulation:  Mini-batch time (usec) = 7858281
Min send: 10000000, max send 0
Min long send: 541553, max long send 566176
Min fwd: 380, max fwd 12458; min bwd 8532, max bwd 24401
Min long fwd: 1017, max long fwd 4595; min long bwd 780, max long bwd 6417
Time taken by simulation: 911 microseconds

{1: 1.424058, 2: 1.466822, 3: 4.955939, 4: 6.836714, 6: 7.858281}
{1: 32, 2: 32, 3: 32, 4: 32, 6: 32}
best config is: 2 32
expected time is 1.466822
16 per stage
32 servers!
Config:
ranks: range(29, 30)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=29 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a vgg19 --varuna --lr 0.001 --epochs 1000 --resume s3://spot-checkpoints/vgg19
[2022-12-01 18:30:17.418789] => creating model 'vgg19'
[2, 4, 6, 8, 10, 12, 14, 16, 18, 21, 24]
Files already downloaded and verified
Num cutpoints is 11
dry run time 0.9489002227783203
SHARED WEIGHTS ARE
None
this rank  29 is part of pipeline replica  14
4 chunks
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
[2022-12-01 18:30:32.972050] Finished iteration 1, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 8787.067
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
[2022-12-01 18:30:35.479260] Finished iteration 2, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2506.915
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
[2022-12-01 18:30:38.292146] Finished iteration 3, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2812.850
[2022-12-01 18:30:40.898016] Finished iteration 4, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2605.839
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  65536.0
[2022-12-01 18:30:43.051898] Finished iteration 5, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2153.865
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  32768.0
[2022-12-01 18:30:44.341838] Finished iteration 6, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1289.989
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  16384.0
[2022-12-01 18:30:45.701467] Finished iteration 7, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1359.520
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  8192.0
[2022-12-01 18:30:46.854168] Finished iteration 8, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1152.664
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  4096.0
[2022-12-01 18:30:48.173521] Finished iteration 9, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1319.330
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  2048.0
[2022-12-01 18:30:24.147036] Epoch: [0][ 10/390]	Time  1.283 ( 2.527)	Data  0.005 ( 0.179)	Loss 8.8730e+00 (8.0899e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:30:49.457581] Finished iteration 10, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1284.003
[2022-12-01 18:30:50.963763] Finished iteration 11, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1506.155
[2022-12-01 18:30:52.730757] Finished iteration 12, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1766.956
[2022-12-01 18:30:54.148549] Finished iteration 13, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1417.749
[2022-12-01 18:30:55.646970] Finished iteration 14, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1498.461
[2022-12-01 18:30:57.226919] Finished iteration 15, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1579.844
[2022-12-01 18:30:58.923221] Finished iteration 16, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1696.264
[2022-12-01 18:31:00.431241] Finished iteration 17, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1507.984
[2022-12-01 18:31:01.822614] Finished iteration 18, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1391.332
[2022-12-01 18:31:03.201255] Finished iteration 19, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1378.600
[2022-12-01 18:30:24.147036] Epoch: [0][ 20/390]	Time  1.279 ( 2.014)	Data  0.006 ( 0.092)	Loss 4.9531e+00 (7.3463e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:31:04.479695] Finished iteration 20, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1278.400
[2022-12-01 18:31:06.431416] Finished iteration 21, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1951.694
[2022-12-01 18:31:07.907925] Finished iteration 22, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1476.476
[2022-12-01 18:31:09.506269] Finished iteration 23, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1598.295
[2022-12-01 18:31:10.827102] Finished iteration 24, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1320.812
[2022-12-01 18:31:12.092328] Finished iteration 25, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1265.174
[2022-12-01 18:31:14.017575] Finished iteration 26, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1925.211
[2022-12-01 18:31:15.625639] Finished iteration 27, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1608.038
[2022-12-01 18:31:16.955434] Finished iteration 28, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1329.749
[2022-12-01 18:31:18.446120] Finished iteration 29, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1490.667
[2022-12-01 18:30:24.147036] Epoch: [0][ 30/390]	Time  1.265 ( 1.851)	Data  0.005 ( 0.067)	Loss 4.6807e+00 (6.5508e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:31:19.711304] Finished iteration 30, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1265.120
[2022-12-01 18:31:21.035143] Finished iteration 31, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1323.825
[2022-12-01 18:31:22.576339] Finished iteration 32, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1541.152
[2022-12-01 18:31:23.974192] Finished iteration 33, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1397.808
[2022-12-01 18:31:25.439982] Finished iteration 34, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1465.744
[2022-12-01 18:31:26.712506] Finished iteration 35, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1272.499
[2022-12-01 18:31:28.239028] Finished iteration 36, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1526.474
[2022-12-01 18:31:29.382267] Finished iteration 37, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1143.198
[2022-12-01 18:31:30.771618] Finished iteration 38, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1389.418
[2022-12-01 18:31:32.217074] Finished iteration 39, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1445.328
[2022-12-01 18:30:24.147036] Epoch: [0][ 40/390]	Time  1.232 ( 1.731)	Data  0.006 ( 0.052)	Loss 4.7012e+00 (6.0831e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:31:33.449490] Finished iteration 40, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1232.358
[2022-12-01 18:31:34.923889] Finished iteration 41, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1474.378
[2022-12-01 18:31:36.248907] Finished iteration 42, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1325.022
[2022-12-01 18:31:37.731440] Finished iteration 43, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1482.482
[2022-12-01 18:31:39.074783] Finished iteration 44, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1343.281
[2022-12-01 18:31:40.639124] Finished iteration 45, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1564.326
[2022-12-01 18:31:42.245604] Finished iteration 46, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1606.422
[2022-12-01 18:31:43.840045] Finished iteration 47, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1594.409
[2022-12-01 18:31:45.078052] Finished iteration 48, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1237.979
[2022-12-01 18:31:46.663034] Finished iteration 49, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1584.924
[2022-12-01 18:30:24.147036] Epoch: [0][ 50/390]	Time  1.546 ( 1.680)	Data  0.006 ( 0.043)	Loss 4.6055e+00 (5.7967e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:31:48.208960] Finished iteration 50, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1545.923
[2022-12-01 18:31:49.486430] Finished iteration 51, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1277.411
[2022-12-01 18:31:51.030884] Finished iteration 52, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1544.413
[2022-12-01 18:31:52.471493] Finished iteration 53, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1440.568
[2022-12-01 18:31:54.043161] Finished iteration 54, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1571.634
[2022-12-01 18:31:55.808934] Finished iteration 55, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1765.782
[2022-12-01 18:31:57.234120] Finished iteration 56, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1425.102
[2022-12-01 18:31:58.856540] Finished iteration 57, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1622.379
[2022-12-01 18:32:00.182586] Finished iteration 58, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1326.013
[2022-12-01 18:32:01.591257] Finished iteration 59, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1408.633
[2022-12-01 18:30:24.147036] Epoch: [0][ 60/390]	Time  1.425 ( 1.647)	Data  0.005 ( 0.037)	Loss 4.6318e+00 (5.6012e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:32:03.016419] Finished iteration 60, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1425.117
[2022-12-01 18:32:04.696301] Finished iteration 61, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1679.857
[2022-12-01 18:32:06.209812] Finished iteration 62, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1513.501
[2022-12-01 18:32:07.609945] Finished iteration 63, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1400.063
[2022-12-01 18:32:09.296977] Finished iteration 64, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1687.087
[2022-12-01 18:32:10.730086] Finished iteration 65, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1432.975
[2022-12-01 18:32:11.806216] Finished iteration 66, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1076.097
[2022-12-01 18:32:13.481930] Finished iteration 67, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1675.685
[2022-12-01 18:32:14.898116] Finished iteration 68, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1416.143
[2022-12-01 18:32:16.330748] Finished iteration 69, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1432.592
[2022-12-01 18:30:24.147036] Epoch: [0][ 70/390]	Time  1.617 ( 1.625)	Data  0.007 ( 0.032)	Loss 4.5947e+00 (5.4615e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:32:17.948366] Finished iteration 70, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1617.578
[2022-12-01 18:32:19.278076] Finished iteration 71, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1329.690
[2022-12-01 18:32:20.930609] Finished iteration 72, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1652.491
[2022-12-01 18:32:22.419041] Finished iteration 73, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1488.438
[2022-12-01 18:32:23.842135] Finished iteration 74, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1423.014
[2022-12-01 18:32:25.331889] Finished iteration 75, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1489.715
[2022-12-01 18:32:26.783266] Finished iteration 76, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1451.344
[2022-12-01 18:32:28.234582] Finished iteration 77, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1451.277
[2022-12-01 18:32:29.691501] Finished iteration 78, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1456.878
[2022-12-01 18:32:31.273577] Finished iteration 79, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1582.048
[2022-12-01 18:30:24.147036] Epoch: [0][ 80/390]	Time  1.539 ( 1.608)	Data  0.005 ( 0.029)	Loss 4.6064e+00 (5.3565e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 18:32:32.812730] Finished iteration 80, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1539.097
[2022-12-01 18:32:34.392987] Finished iteration 81, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1580.281
[2022-12-01 18:32:35.937998] Finished iteration 82, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1544.934
[2022-12-01 18:32:37.423376] Finished iteration 83, CKPT_AND_STOP: False, flag: tensor([1], dtype=torch.int32), speed: 1485.357
Opt ckpt time 16.07333207130432
Process done with return code 0
Parent process ID: 144305 node: 172.31.24.208
12 cutpoints
Stages 1
Micro-bs 32 Max mem: 8350516326.4
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 3 0 1177577.3722733222 0
End of simulation:  Mini-batch time (usec) = 1518326
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 32586, max long fwd 33754; min long bwd 78677, max long bwd 82859
Time taken by simulation: 36 microseconds

Stages 2
Micro-bs 32 Max mem: 5185528320.0
Predicted microbatch size for 2: 32
comm size 12845056
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 5 0 12136.97624206543 541471.8854995001
End of simulation:  Mini-batch time (usec) = 1774283
Min send: 10000000, max send 0
Min long send: 541803, max long send 554555
Min fwd: 18455, max fwd 25575; min bwd 51079, max bwd 53581
Min long fwd: 8875, max long fwd 13712; min long bwd 25318, max long bwd 30607
Time taken by simulation: 116 microseconds

Stages 3
Micro-bs 32 Max mem: 4313669017.6
Predicted microbatch size for 3: 32
comm size 25690112
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 7 0 7540.138721466064 929913.8118823369
End of simulation:  Mini-batch time (usec) = 4955939
Min send: 10000000, max send 0
Min long send: 930245, max long send 945608
Min fwd: 8775, max fwd 19684; min bwd 24478, max bwd 41849
Min long fwd: 2259, max long fwd 7334; min long bwd 12226, max long bwd 16590
Time taken by simulation: 233 microseconds

Stages 4
Micro-bs 32 Max mem: 3762429747.2
Predicted microbatch size for 4: 32
comm size 25690112
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 10 0 3605.3318977355957 929913.8118823369
End of simulation:  Mini-batch time (usec) = 7727483
Min send: 10000000, max send 0
Min long send: 930101, max long send 952379
Min fwd: 4418, max fwd 15893; min bwd 14410, max bwd 31066
Min long fwd: 532, max long fwd 8412; min long bwd 9236, max long bwd 15394
Time taken by simulation: 461 microseconds

Stages 6
Micro-bs 32 Max mem: 3200148889.6
Predicted microbatch size for 6: 32
comm size 12845056
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 13 0 1801.1889457702637 541471.8854995001
End of simulation:  Mini-batch time (usec) = 7858281
Min send: 10000000, max send 0
Min long send: 541553, max long send 566176
Min fwd: 380, max fwd 12458; min bwd 8532, max bwd 24401
Min long fwd: 1017, max long fwd 4595; min long bwd 780, max long bwd 6417
Time taken by simulation: 929 microseconds

{1: 1.518326, 2: 1.774283, 3: 4.955939, 4: 7.727483, 6: 7.858281}
{1: 32, 2: 32, 3: 32, 4: 32, 6: 32}
best config is: 2 32
expected time is 1.774283
15 per stage
30 servers!
Config:
ranks: range(29, 30)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 15
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29;
World size is 30
/opt/conda/envs/varuna/bin/python -u main.py --rank=29 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29; --batch-size=160 data -a vgg19 --varuna --lr 0.001 --epochs 1000 --resume s3://spot-checkpoints/vgg19 --resume_step 606
[2022-12-01 19:01:30.764480] => creating model 'vgg19'
[2, 4, 6, 8, 10, 12, 14, 16, 18, 21, 24]
Files already downloaded and verified
Num cutpoints is 11
dry run time 1.0092711448669434
SHARED WEIGHTS ARE
None
this rank  29 is part of pipeline replica  14
5 chunks
>>>>> [2022-12-01 19:02:05.522504] Time taken to load checkpoint: 28.020s
2022-12-01 19:02:18.716676 Begin to exit
Process done with return code 0
Parent process ID: 144995 node: 172.31.24.208
12 cutpoints
Stages 1
Micro-bs 32 Max mem: 8350516326.4
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 2 0 1199922.1801757812 0
End of simulation:  Mini-batch time (usec) = 1424058
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 32586, max long fwd 32895; min long bwd 78677, max long bwd 79978
Time taken by simulation: 34 microseconds

Stages 2
Micro-bs 32 Max mem: 5185528320.0
Predicted microbatch size for 2: 32
comm size 12845056
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 4 0 22892.793655395508 541471.8854995001
End of simulation:  Mini-batch time (usec) = 1466822
Min send: 10000000, max send 0
Min long send: 541803, max long send 554555
Min fwd: 21083, max fwd 25575; min bwd 48477, max bwd 54184
Min long fwd: 7473, max long fwd 14307; min long bwd 25716, max long bwd 30607
Time taken by simulation: 95 microseconds

Stages 3
Micro-bs 32 Max mem: 4313669017.6
Predicted microbatch size for 3: 32
comm size 25690112
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 7 0 7540.138721466064 929913.8118823369
End of simulation:  Mini-batch time (usec) = 4955939
Min send: 10000000, max send 0
Min long send: 930245, max long send 945608
Min fwd: 8775, max fwd 19684; min bwd 24478, max bwd 41849
Min long fwd: 2259, max long fwd 7334; min long bwd 12226, max long bwd 16590
Time taken by simulation: 235 microseconds

Stages 4
Micro-bs 32 Max mem: 3762429747.2
Predicted microbatch size for 4: 32
comm size 25690112
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 8 0 3659.188747406006 929913.8118823369
End of simulation:  Mini-batch time (usec) = 6836714
Min send: 10000000, max send 0
Min long send: 929995, max long send 954618
Min fwd: 4418, max fwd 15941; min bwd 13005, max bwd 30581
Min long fwd: 989, max long fwd 6784; min long bwd 7050, max long bwd 13429
Time taken by simulation: 434 microseconds

Stages 6
Micro-bs 32 Max mem: 3200148889.6
Predicted microbatch size for 6: 32
comm size 12845056
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 13 0 1801.1889457702637 541471.8854995001
End of simulation:  Mini-batch time (usec) = 7858281
Min send: 10000000, max send 0
Min long send: 541553, max long send 566176
Min fwd: 380, max fwd 12458; min bwd 8532, max bwd 24401
Min long fwd: 1017, max long fwd 4595; min long bwd 780, max long bwd 6417
Time taken by simulation: 904 microseconds

{1: 1.424058, 2: 1.466822, 3: 4.955939, 4: 6.836714, 6: 7.858281}
{1: 32, 2: 32, 3: 32, 4: 32, 6: 32}
best config is: 2 32
expected time is 1.466822
16 per stage
32 servers!
Config:
ranks: range(29, 30)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=29 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a vgg19 --varuna --lr 0.001 --epochs 1000 --resume s3://spot-checkpoints/vgg19 --resume_step 606
[2022-12-01 19:02:35.008985] => creating model 'vgg19'
[2, 4, 6, 8, 10, 12, 14, 16, 18, 21, 24]
Files already downloaded and verified
Num cutpoints is 11
dry run time 0.9559247493743896
SHARED WEIGHTS ARE
None
this rank  29 is part of pipeline replica  14
4 chunks
>>>>> [2022-12-01 19:03:08.580611] Time taken to load checkpoint: 26.867s
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
[2022-12-01 19:03:23.242378] Finished iteration 607, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 8604.144
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
[2022-12-01 19:03:25.686602] Finished iteration 608, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2443.978
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  131072.0
[2022-12-01 19:03:28.000558] Finished iteration 609, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2313.896
[2022-12-01 19:03:08.580862] Epoch: [0][610/390]	Time  3.510 ( 3.959)	Data  1.037 ( 0.790)	Loss 4.6172e+00 (4.6108e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:03:30.482879] Finished iteration 610, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2482.298
[2022-12-01 19:03:33.051774] Finished iteration 611, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2568.840
[2022-12-01 19:03:34.529876] Finished iteration 612, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1478.071
[2022-12-01 19:03:36.120284] Finished iteration 613, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1590.367
[2022-12-01 19:03:37.612481] Finished iteration 614, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1492.158
[2022-12-01 19:03:38.728756] Finished iteration 615, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1116.283
[2022-12-01 19:03:40.223842] Finished iteration 616, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1495.009
[2022-12-01 19:03:41.716439] Finished iteration 617, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1492.563
[2022-12-01 19:03:43.000315] Finished iteration 618, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1283.834
[2022-12-01 19:03:44.240436] Finished iteration 619, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1240.097
[2022-12-01 19:03:08.580862] Epoch: [0][620/390]	Time  1.323 ( 2.209)	Data  0.006 ( 0.231)	Loss 4.6143e+00 (4.6099e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:03:45.563248] Finished iteration 620, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1322.763
[2022-12-01 19:03:47.037627] Finished iteration 621, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1474.356
[2022-12-01 19:03:48.853120] Finished iteration 622, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1815.474
[2022-12-01 19:03:50.574022] Finished iteration 623, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1720.867
[2022-12-01 19:03:51.924346] Finished iteration 624, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1350.283
[2022-12-01 19:03:53.453304] Finished iteration 625, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1528.898
[2022-12-01 19:03:54.958489] Finished iteration 626, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1505.150
[2022-12-01 19:03:56.237280] Finished iteration 627, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1278.755
[2022-12-01 19:03:57.561375] Finished iteration 628, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1324.056
[2022-12-01 19:03:59.048434] Finished iteration 629, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1487.018
[2022-12-01 19:03:08.580862] Epoch: [0][630/390]	Time  1.492 ( 1.912)	Data  0.008 ( 0.137)	Loss 4.6045e+00 (4.6097e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:04:00.538366] Finished iteration 630, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1489.894
[2022-12-01 19:04:01.999746] Finished iteration 631, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1461.364
[2022-12-01 19:04:03.267357] Finished iteration 632, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1267.562
[2022-12-01 19:04:05.026007] Finished iteration 633, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1758.615
[2022-12-01 19:04:06.540321] Finished iteration 634, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1514.275
[2022-12-01 19:04:08.030533] Finished iteration 635, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1490.183
[2022-12-01 19:04:09.537059] Finished iteration 636, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1506.492
[2022-12-01 19:04:10.964853] Finished iteration 637, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1427.791
[2022-12-01 19:04:12.339309] Finished iteration 638, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1374.375
[2022-12-01 19:04:14.117647] Finished iteration 639, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1778.294
[2022-12-01 19:03:08.580862] Epoch: [0][640/390]	Time  1.494 ( 1.793)	Data  0.005 ( 0.098)	Loss 4.6094e+00 (4.6095e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:04:15.611722] Finished iteration 640, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1494.033
[2022-12-01 19:04:16.943918] Finished iteration 641, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1332.175
[2022-12-01 19:04:18.271928] Finished iteration 642, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1327.975
[2022-12-01 19:04:19.811198] Finished iteration 643, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1539.228
[2022-12-01 19:04:21.137499] Finished iteration 644, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1326.264
[2022-12-01 19:04:22.495981] Finished iteration 645, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1358.440
[2022-12-01 19:04:24.183079] Finished iteration 646, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1687.056
[2022-12-01 19:04:25.559152] Finished iteration 647, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1376.037
[2022-12-01 19:04:27.048821] Finished iteration 648, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1489.670
[2022-12-01 19:04:28.392422] Finished iteration 649, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1343.510
[2022-12-01 19:03:08.580862] Epoch: [0][650/390]	Time  1.365 ( 1.707)	Data  0.005 ( 0.077)	Loss 4.5811e+00 (4.6088e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:04:29.758600] Finished iteration 650, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1366.143
[2022-12-01 19:04:31.089022] Finished iteration 651, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1330.399
[2022-12-01 19:04:32.409912] Finished iteration 652, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1320.869
[2022-12-01 19:04:33.710162] Finished iteration 653, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1300.192
[2022-12-01 19:04:35.039451] Finished iteration 654, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1329.251
[2022-12-01 19:04:36.578370] Finished iteration 655, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1538.896
[2022-12-01 19:04:37.879735] Finished iteration 656, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1301.312
[2022-12-01 19:04:39.116926] Finished iteration 657, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1237.190
[2022-12-01 19:04:40.683333] Finished iteration 658, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1566.330
[2022-12-01 19:04:42.000196] Finished iteration 659, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1316.831
[2022-12-01 19:03:08.580862] Epoch: [0][660/390]	Time  1.529 ( 1.646)	Data  0.005 ( 0.064)	Loss 4.6172e+00 (4.6095e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:04:43.528793] Finished iteration 660, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1528.585
[2022-12-01 19:04:45.014376] Finished iteration 661, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1485.519
[2022-12-01 19:04:46.319895] Finished iteration 662, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1305.477
[2022-12-01 19:04:47.811330] Finished iteration 663, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1491.418
[2022-12-01 19:04:49.615598] Finished iteration 664, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1804.234
[2022-12-01 19:04:50.906195] Finished iteration 665, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1290.540
[2022-12-01 19:04:52.181427] Finished iteration 666, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1275.188
[2022-12-01 19:04:53.858692] Finished iteration 667, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1677.234
[2022-12-01 19:04:55.324150] Finished iteration 668, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1465.405
[2022-12-01 19:04:57.205615] Finished iteration 669, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1881.428
[2022-12-01 19:03:08.580862] Epoch: [0][670/390]	Time  1.550 ( 1.627)	Data  0.005 ( 0.055)	Loss 4.6104e+00 (4.6094e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:04:58.755275] Finished iteration 670, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1549.615
[2022-12-01 19:05:00.257925] Finished iteration 671, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1502.628
[2022-12-01 19:05:01.527043] Finished iteration 672, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1269.078
[2022-12-01 19:05:02.773666] Finished iteration 673, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1246.576
[2022-12-01 19:05:04.572624] Finished iteration 674, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1798.924
[2022-12-01 19:05:05.861879] Finished iteration 675, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1289.217
[2022-12-01 19:05:06.987021] Finished iteration 676, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1125.107
[2022-12-01 19:05:08.250739] Finished iteration 677, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1263.671
[2022-12-01 19:05:09.530461] Finished iteration 678, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1279.684
[2022-12-01 19:05:10.845181] Finished iteration 679, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1314.675
[2022-12-01 19:03:08.580862] Epoch: [0][680/390]	Time  1.433 ( 1.589)	Data  0.058 ( 0.049)	Loss 4.6074e+00 (4.6088e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:05:12.227599] Finished iteration 680, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1382.375
[2022-12-01 19:05:13.731691] Finished iteration 681, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1504.071
[2022-12-01 19:05:15.096417] Finished iteration 682, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1364.685
[2022-12-01 19:05:16.190143] Finished iteration 683, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1093.686
[2022-12-01 19:05:17.542070] Finished iteration 684, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1351.885
[2022-12-01 19:05:18.874385] Finished iteration 685, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1332.274
[2022-12-01 19:05:20.430779] Finished iteration 686, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1556.359
[2022-12-01 19:05:21.965030] Finished iteration 687, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1534.214
[2022-12-01 19:05:23.445862] Finished iteration 688, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1480.798
[2022-12-01 19:05:24.780083] Finished iteration 689, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1334.181
[2022-12-01 19:03:08.580862] Epoch: [0][690/390]	Time  1.344 ( 1.565)	Data  0.006 ( 0.044)	Loss 4.6182e+00 (4.6092e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:05:26.124010] Finished iteration 690, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1343.889
[2022-12-01 19:05:27.730712] Finished iteration 691, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1606.693
[2022-12-01 19:05:29.420740] Finished iteration 692, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1689.998
[2022-12-01 19:05:31.134759] Finished iteration 693, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1713.959
[2022-12-01 19:05:32.453640] Finished iteration 694, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1318.846
[2022-12-01 19:05:34.028283] Finished iteration 695, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1574.608
[2022-12-01 19:05:35.362823] Finished iteration 696, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1334.495
[2022-12-01 19:05:36.626948] Finished iteration 697, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1264.090
[2022-12-01 19:05:38.130118] Finished iteration 698, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1503.127
[2022-12-01 19:05:39.927621] Finished iteration 699, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1797.470
[2022-12-01 19:03:08.580862] Epoch: [0][700/390]	Time  1.522 ( 1.562)	Data  0.005 ( 0.040)	Loss 4.6094e+00 (4.6092e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:05:41.449686] Finished iteration 700, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1522.010
[2022-12-01 19:05:42.593571] Finished iteration 701, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1143.864
[2022-12-01 19:05:44.031281] Finished iteration 702, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1437.673
[2022-12-01 19:05:45.386344] Finished iteration 703, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1355.025
[2022-12-01 19:05:46.702656] Finished iteration 704, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1316.267
[2022-12-01 19:05:47.979693] Finished iteration 705, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1276.998
[2022-12-01 19:05:49.340321] Finished iteration 706, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1360.592
[2022-12-01 19:05:50.889402] Finished iteration 707, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1549.050
[2022-12-01 19:05:52.159083] Finished iteration 708, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1269.634
[2022-12-01 19:05:53.482608] Finished iteration 709, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1323.513
[2022-12-01 19:03:08.580862] Epoch: [0][710/390]	Time  1.643 ( 1.543)	Data  0.005 ( 0.036)	Loss 4.6035e+00 (4.6093e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:05:55.125618] Finished iteration 710, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1642.945
[2022-12-01 19:05:56.714780] Finished iteration 711, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1589.148
[2022-12-01 19:05:58.173173] Finished iteration 712, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1458.421
[2022-12-01 19:05:59.811046] Finished iteration 713, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1637.937
[2022-12-01 19:06:01.296331] Finished iteration 714, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1485.027
[2022-12-01 19:06:02.604301] Finished iteration 715, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1307.926
[2022-12-01 19:06:04.249721] Finished iteration 716, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1645.393
[2022-12-01 19:06:05.399166] Finished iteration 717, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1149.384
[2022-12-01 19:06:06.905233] Finished iteration 718, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1506.033
[2022-12-01 19:06:08.160481] Finished iteration 719, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1255.203
[2022-12-01 19:03:08.580862] Epoch: [0][720/390]	Time  1.259 ( 1.533)	Data  0.005 ( 0.035)	Loss 4.6143e+00 (4.6094e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:06:09.419554] Finished iteration 720, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1259.027
[2022-12-01 19:06:10.919330] Finished iteration 721, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1499.753
[2022-12-01 19:06:12.625601] Finished iteration 722, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1706.234
[2022-12-01 19:06:14.135202] Finished iteration 723, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1509.559
[2022-12-01 19:06:15.256294] Finished iteration 724, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1121.078
[2022-12-01 19:06:16.775106] Finished iteration 725, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1518.754
[2022-12-01 19:06:18.311637] Finished iteration 726, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1536.486
[2022-12-01 19:06:19.822168] Finished iteration 727, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1510.496
[2022-12-01 19:06:21.278452] Finished iteration 728, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1456.241
[2022-12-01 19:06:22.719902] Finished iteration 729, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1441.410
[2022-12-01 19:03:08.580862] Epoch: [0][730/390]	Time  1.258 ( 1.527)	Data  0.006 ( 0.032)	Loss 4.6055e+00 (4.6094e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:06:23.976417] Finished iteration 730, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1256.491
[2022-12-01 19:06:25.247245] Finished iteration 731, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1270.784
[2022-12-01 19:06:26.956776] Finished iteration 732, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1709.537
[2022-12-01 19:06:28.256366] Finished iteration 733, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1299.516
[2022-12-01 19:06:29.959873] Finished iteration 734, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1703.470
[2022-12-01 19:06:31.476428] Finished iteration 735, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1516.525
[2022-12-01 19:06:33.089721] Finished iteration 736, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1613.244
[2022-12-01 19:06:34.422989] Finished iteration 737, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1333.226
[2022-12-01 19:06:35.917867] Finished iteration 738, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1494.848
[2022-12-01 19:06:37.173868] Finished iteration 739, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1255.963
[2022-12-01 19:03:08.580862] Epoch: [0][740/390]	Time  1.456 ( 1.522)	Data  0.005 ( 0.030)	Loss 4.6133e+00 (4.6097e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:06:38.629895] Finished iteration 740, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1455.984
[2022-12-01 19:06:40.130895] Finished iteration 741, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1500.975
[2022-12-01 19:06:41.704379] Finished iteration 742, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1573.448
[2022-12-01 19:06:43.200236] Finished iteration 743, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1495.833
[2022-12-01 19:06:44.861310] Finished iteration 744, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1661.035
[2022-12-01 19:06:46.109168] Finished iteration 745, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1247.806
[2022-12-01 19:06:47.440604] Finished iteration 746, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1331.418
[2022-12-01 19:06:48.934411] Finished iteration 747, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1493.754
[2022-12-01 19:06:50.544979] Finished iteration 748, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1610.551
[2022-12-01 19:06:52.009520] Finished iteration 749, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1464.510
[2022-12-01 19:03:08.580862] Epoch: [0][750/390]	Time  1.725 ( 1.521)	Data  0.005 ( 0.029)	Loss 4.6094e+00 (4.6095e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:06:53.734350] Finished iteration 750, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1724.768
[2022-12-01 19:06:55.058687] Finished iteration 751, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1324.306
[2022-12-01 19:06:56.356744] Finished iteration 752, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1298.064
[2022-12-01 19:06:58.092088] Finished iteration 753, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1735.275
[2022-12-01 19:06:59.818010] Finished iteration 754, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1725.881
[2022-12-01 19:07:01.604174] Finished iteration 755, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1786.135
[2022-12-01 19:07:03.134646] Finished iteration 756, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1530.420
[2022-12-01 19:07:04.650082] Finished iteration 757, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1515.424
[2022-12-01 19:07:06.223249] Finished iteration 758, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1573.101
[2022-12-01 19:07:07.670230] Finished iteration 759, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1446.943
[2022-12-01 19:03:08.580862] Epoch: [0][760/390]	Time  1.104 ( 1.520)	Data  0.006 ( 0.027)	Loss 4.6133e+00 (4.6094e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:07:08.774265] Finished iteration 760, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1104.000
[2022-12-01 19:07:10.236338] Finished iteration 761, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1462.039
[2022-12-01 19:07:11.537233] Finished iteration 762, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1300.886
[2022-12-01 19:07:13.169920] Finished iteration 763, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1632.630
[2022-12-01 19:07:14.695290] Finished iteration 764, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1525.325
[2022-12-01 19:07:16.240307] Finished iteration 765, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1544.968
[2022-12-01 19:07:18.289306] Finished iteration 766, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2048.968
[2022-12-01 19:07:19.793958] Finished iteration 767, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1504.610
[2022-12-01 19:07:21.252250] Finished iteration 768, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1458.262
[2022-12-01 19:07:22.924766] Finished iteration 769, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1672.528
[2022-12-01 19:03:08.580862] Epoch: [0][770/390]	Time  1.626 ( 1.524)	Data  0.005 ( 0.026)	Loss 4.6055e+00 (4.6096e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:07:24.550117] Finished iteration 770, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1625.254
[2022-12-01 19:07:25.924215] Finished iteration 771, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1374.091
[2022-12-01 19:07:27.620981] Finished iteration 772, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1696.716
[2022-12-01 19:07:29.011262] Finished iteration 773, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1390.239
[2022-12-01 19:07:30.535853] Finished iteration 774, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1524.556
[2022-12-01 19:07:32.094014] Finished iteration 775, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1558.124
[2022-12-01 19:07:33.595796] Finished iteration 776, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1501.753
[2022-12-01 19:07:35.054627] Finished iteration 777, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1458.788
[2022-12-01 19:07:36.640631] Finished iteration 778, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1585.970
[2022-12-01 19:07:37.896150] Finished iteration 779, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1255.472
[2022-12-01 19:03:08.580862] Epoch: [0][780/390]	Time  1.496 ( 1.522)	Data  0.005 ( 0.025)	Loss 4.6143e+00 (4.6096e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:07:39.392699] Finished iteration 780, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1496.509
[2022-12-01 19:07:40.726990] Finished iteration 781, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1334.238
[2022-12-01 19:07:42.048186] Finished iteration 782, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1321.159
[2022-12-01 19:07:43.369037] Finished iteration 783, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1320.824
[2022-12-01 19:07:44.889248] Finished iteration 784, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1520.173
[2022-12-01 19:07:46.125452] Finished iteration 785, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1236.170
[2022-12-01 19:07:47.370438] Finished iteration 786, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1244.954
[2022-12-01 19:07:48.744366] Finished iteration 787, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1373.876
[2022-12-01 19:07:50.283297] Finished iteration 788, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1538.889
[2022-12-01 19:07:51.790358] Finished iteration 789, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1507.025
[2022-12-01 19:03:08.580862] Epoch: [0][790/390]	Time  1.444 ( 1.514)	Data  0.005 ( 0.024)	Loss 4.6064e+00 (4.6096e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:07:53.235278] Finished iteration 790, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1444.875
[2022-12-01 19:07:54.773364] Finished iteration 791, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1538.072
[2022-12-01 19:07:56.426989] Finished iteration 792, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1653.577
[2022-12-01 19:07:57.859785] Finished iteration 793, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1432.766
[2022-12-01 19:07:59.337290] Finished iteration 794, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1477.467
[2022-12-01 19:08:00.712318] Finished iteration 795, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1374.988
[2022-12-01 19:08:02.105709] Finished iteration 796, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1393.353
[2022-12-01 19:08:04.056714] Finished iteration 797, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1951.013
[2022-12-01 19:08:05.350695] Finished iteration 798, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1293.895
[2022-12-01 19:08:06.634028] Finished iteration 799, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1283.291
[2022-12-01 19:03:08.580862] Epoch: [0][800/390]	Time  1.461 ( 1.513)	Data  0.005 ( 0.023)	Loss 4.6006e+00 (4.6094e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:08:08.095283] Finished iteration 800, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1461.207
[2022-12-01 19:08:09.424424] Finished iteration 801, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1329.117
[2022-12-01 19:08:10.907150] Finished iteration 802, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1482.697
[2022-12-01 19:08:12.357296] Finished iteration 803, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1450.099
[2022-12-01 19:08:13.741762] Finished iteration 804, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1384.430
[2022-12-01 19:08:15.551301] Finished iteration 805, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1809.494
[2022-12-01 19:08:17.078861] Finished iteration 806, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1527.525
[2022-12-01 19:08:18.494272] Finished iteration 807, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1415.393
[2022-12-01 19:08:20.214532] Finished iteration 808, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1720.233
[2022-12-01 19:08:21.702727] Finished iteration 809, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1488.147
[2022-12-01 19:03:08.580862] Epoch: [0][810/390]	Time  1.334 ( 1.512)	Data  0.005 ( 0.022)	Loss 4.6074e+00 (4.6093e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:08:23.037914] Finished iteration 810, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1335.130
[2022-12-01 19:08:24.879110] Finished iteration 811, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1841.189
[2022-12-01 19:08:26.184709] Finished iteration 812, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1305.533
[2022-12-01 19:08:27.653668] Finished iteration 813, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1468.890
[2022-12-01 19:08:28.934123] Finished iteration 814, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1280.417
[2022-12-01 19:08:30.237374] Finished iteration 815, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1303.219
[2022-12-01 19:08:31.874833] Finished iteration 816, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1637.434
[2022-12-01 19:08:33.357388] Finished iteration 817, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1482.494
[2022-12-01 19:08:34.957466] Finished iteration 818, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1600.040
[2022-12-01 19:08:36.410262] Finished iteration 819, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1452.757
[2022-12-01 19:03:08.580862] Epoch: [0][820/390]	Time  1.449 ( 1.510)	Data  0.005 ( 0.021)	Loss 4.6045e+00 (4.6094e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:08:37.858988] Finished iteration 820, CKPT_AND_STOP: False, flag: tensor([3], dtype=torch.int32), speed: 1448.712
Opt ckpt time 14.612531900405884
Process done with return code 0
Parent process ID: 155341 node: 172.31.19.112
12 cutpoints
Stages 1
Micro-bs 32 Max mem: 8350516326.4
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 3 0 1188930.0075556464 0
End of simulation:  Mini-batch time (usec) = 1529679
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 32586, max long fwd 33754; min long bwd 78677, max long bwd 82859
Time taken by simulation: 42 microseconds

Stages 2
Micro-bs 32 Max mem: 5185528320.0
Predicted microbatch size for 2: 32
comm size 12845056
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 5 0 12136.97624206543 541471.8854995001
End of simulation:  Mini-batch time (usec) = 1774283
Min send: 10000000, max send 0
Min long send: 541803, max long send 554555
Min fwd: 18455, max fwd 25575; min bwd 51079, max bwd 53581
Min long fwd: 8875, max long fwd 13712; min long bwd 25318, max long bwd 30607
Time taken by simulation: 118 microseconds

Stages 3
Micro-bs 32 Max mem: 4313669017.6
Predicted microbatch size for 3: 32
comm size 25690112
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 7 0 7540.138721466064 929913.8118823369
End of simulation:  Mini-batch time (usec) = 4955939
Min send: 10000000, max send 0
Min long send: 930245, max long send 945608
Min fwd: 8775, max fwd 19684; min bwd 24478, max bwd 41849
Min long fwd: 2259, max long fwd 7334; min long bwd 12226, max long bwd 16590
Time taken by simulation: 324 microseconds

Stages 4
Micro-bs 32 Max mem: 3762429747.2
Predicted microbatch size for 4: 32
comm size 25690112
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 10 0 3605.3318977355957 929913.8118823369
End of simulation:  Mini-batch time (usec) = 7727483
Min send: 10000000, max send 0
Min long send: 930101, max long send 952379
Min fwd: 4418, max fwd 15893; min bwd 14410, max bwd 31066
Min long fwd: 532, max long fwd 8412; min long bwd 9236, max long bwd 15394
Time taken by simulation: 456 microseconds

Stages 6
Micro-bs 32 Max mem: 3200148889.6
Predicted microbatch size for 6: 32
comm size 12845056
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 13 0 1801.1889457702637 541471.8854995001
End of simulation:  Mini-batch time (usec) = 7858281
Min send: 10000000, max send 0
Min long send: 541553, max long send 566176
Min fwd: 380, max fwd 12458; min bwd 8532, max bwd 24401
Min long fwd: 1017, max long fwd 4595; min long bwd 780, max long bwd 6417
Time taken by simulation: 908 microseconds

{1: 1.529679, 2: 1.774283, 3: 4.955939, 4: 7.727483, 6: 7.858281}
{1: 32, 2: 32, 3: 32, 4: 32, 6: 32}
best config is: 2 32
expected time is 1.774283
15 per stage
30 servers!
Config:
ranks: range(29, 30)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 15
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29;
World size is 30
/opt/conda/envs/varuna/bin/python -u main.py --rank=29 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29; --batch-size=160 data -a vgg19 --varuna --lr 0.001 --epochs 1000 --resume s3://spot-checkpoints/vgg19 --resume_step 820
[2022-12-01 19:09:36.802836] => creating model 'vgg19'
[2, 4, 6, 8, 10, 12, 14, 16, 18, 21, 24]
Files already downloaded and verified
Num cutpoints is 11
dry run time 0.9807310104370117
SHARED WEIGHTS ARE
None
this rank  29 is part of pipeline replica  14
5 chunks
>>>>> [2022-12-01 19:10:17.439325] Time taken to load checkpoint: 34.008s
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  524288.0
[2022-12-01 19:10:43.412500] Finished iteration 821, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 8918.591
29 Overflow !!
29 : update_scale(): _has_overflow, dynamic. _loss_scale =  262144.0
[2022-12-01 19:10:45.564627] Finished iteration 822, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2151.905
[2022-12-01 19:10:47.804240] Finished iteration 823, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2239.583
[2022-12-01 19:10:48.991716] Finished iteration 824, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1187.429
[2022-12-01 19:10:51.187118] Finished iteration 825, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 2195.445
[2022-12-01 19:10:52.377822] Finished iteration 826, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1190.581
[2022-12-01 19:10:53.645749] Finished iteration 827, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1267.889
[2022-12-01 19:10:54.829948] Finished iteration 828, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1184.156
[2022-12-01 19:10:56.008444] Finished iteration 829, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1178.474
[2022-12-01 19:10:17.439552] Epoch: [0][830/312]	Time  1.218 ( 2.272)	Data  0.008 ( 0.399)	Loss 4.5984e+00 (4.6092e+00)	Acc@1   0.00 (  0.00)	Acc@5   0.00 (  0.00)
[2022-12-01 19:10:57.227626] Finished iteration 830, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1219.124
[2022-12-01 19:10:58.439945] Finished iteration 831, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1212.300
[2022-12-01 19:10:59.657694] Finished iteration 832, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1217.707
[2022-12-01 19:11:00.838473] Finished iteration 833, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1180.775
[2022-12-01 19:11:02.076717] Finished iteration 834, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1238.177
[2022-12-01 19:11:03.296195] Finished iteration 835, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1219.472
[2022-12-01 19:11:04.522010] Finished iteration 836, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1225.759
[2022-12-01 19:11:05.735064] Finished iteration 837, CKPT_AND_STOP: False, flag: tensor([0], dtype=torch.int32), speed: 1213.039
[2022-12-01 19:11:06.938061] Finished iteration 838, CKPT_AND_STOP: False, flag: tensor([1], dtype=torch.int32), speed: 1202.931
Opt ckpt time 15.671653509140015
Process done with return code 0
Parent process ID: 156249 node: 172.31.19.112
12 cutpoints
Stages 1
Micro-bs 32 Max mem: 8350516326.4
Predicted microbatch size for 1: 32
comm size 0
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 1 2 0 1199922.1801757812 0
End of simulation:  Mini-batch time (usec) = 1424058
Min send: 10000000, max send 0
Min long send: 10000000, max long send 0
Min fwd: 10000000, max fwd 0; min bwd 10000000, max bwd 0
Min long fwd: 32586, max long fwd 32895; min long bwd 78677, max long bwd 79978
Time taken by simulation: 38 microseconds

Stages 2
Micro-bs 32 Max mem: 5185528320.0
Predicted microbatch size for 2: 32
comm size 12845056
WARNING: no send time found, 2 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 2 4 0 22892.793655395508 541471.8854995001
End of simulation:  Mini-batch time (usec) = 1466822
Min send: 10000000, max send 0
Min long send: 541803, max long send 554555
Min fwd: 21083, max fwd 25575; min bwd 48477, max bwd 54184
Min long fwd: 7473, max long fwd 14307; min long bwd 25716, max long bwd 30607
Time taken by simulation: 97 microseconds

Stages 3
Micro-bs 32 Max mem: 4313669017.6
Predicted microbatch size for 3: 32
comm size 25690112
WARNING: no send time found, 3 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 3 7 0 7540.138721466064 929913.8118823369
End of simulation:  Mini-batch time (usec) = 4955939
Min send: 10000000, max send 0
Min long send: 930245, max long send 945608
Min fwd: 8775, max fwd 19684; min bwd 24478, max bwd 41849
Min long fwd: 2259, max long fwd 7334; min long bwd 12226, max long bwd 16590
Time taken by simulation: 238 microseconds

Stages 4
Micro-bs 32 Max mem: 3762429747.2
Predicted microbatch size for 4: 32
comm size 25690112
WARNING: no send time found, 4 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 4 8 0 3659.188747406006 929913.8118823369
End of simulation:  Mini-batch time (usec) = 6836714
Min send: 10000000, max send 0
Min long send: 929995, max long send 954618
Min fwd: 4418, max fwd 15941; min bwd 13005, max bwd 30581
Min long fwd: 989, max long fwd 6784; min long bwd 7050, max long bwd 13429
Time taken by simulation: 367 microseconds

Stages 6
Micro-bs 32 Max mem: 3200148889.6
Predicted microbatch size for 6: 32
comm size 12845056
WARNING: no send time found, 6 partitions
GPUS_PER_VM=1 /home/ubuntu/varuna/tools/simulator/simulate-varuna 6 13 0 1801.1889457702637 541471.8854995001
End of simulation:  Mini-batch time (usec) = 7858281
Min send: 10000000, max send 0
Min long send: 541553, max long send 566176
Min fwd: 380, max fwd 12458; min bwd 8532, max bwd 24401
Min long fwd: 1017, max long fwd 4595; min long bwd 780, max long bwd 6417
Time taken by simulation: 914 microseconds

{1: 1.424058, 2: 1.466822, 3: 4.955939, 4: 6.836714, 6: 7.858281}
{1: 32, 2: 32, 3: 32, 4: 32, 6: 32}
best config is: 2 32
expected time is 1.466822
16 per stage
32 servers!
Config:
ranks: range(29, 30)
train batch size: 2048
partitions: 2
chunk_size: 32
data depth: 16
stage to rank map: 0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31;
World size is 32
/opt/conda/envs/varuna/bin/python -u main.py --rank=29 --chunk_size=32 --local_rank=0 --stage_to_rank_map=0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30;1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31; --batch-size=128 data -a vgg19 --varuna --lr 0.001 --epochs 1000 --resume s3://spot-checkpoints/vgg19 --resume_step 838
Signal handler called with signal 10


 STOPPING VARUNA !!



